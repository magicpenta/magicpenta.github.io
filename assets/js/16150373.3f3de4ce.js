"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6296],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>u});var n=a(7294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var o=n.createContext({}),k=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=k(e.components);return n.createElement(o.Provider,{value:t},e.children)},s="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,r=e.originalType,o=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),s=k(a),c=l,u=s["".concat(o,".").concat(c)]||s[c]||m[c]||r;return a?n.createElement(u,i(i({ref:t},d),{},{components:a})):n.createElement(u,i({ref:t},d))}));function u(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=a.length,i=new Array(r);i[0]=c;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p[s]="string"==typeof e?e:l,i[1]=p;for(var k=2;k<r;k++)i[k]=a[k];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},605:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>s,frontMatter:()=>r,metadata:()=>p,toc:()=>k});var n=a(7462),l=(a(7294),a(3905));const r={sidebar_position:6},i="Spark \u4efb\u52a1\u8c03\u5ea6",p={unversionedId:"spark/Spark \u4efb\u52a1\u8c03\u5ea6",id:"spark/Spark \u4efb\u52a1\u8c03\u5ea6",title:"Spark \u4efb\u52a1\u8c03\u5ea6",description:"\u4efb\u52a1\u8c03\u5ea6\u6982\u8ff0",source:"@site/docs/spark/Spark \u4efb\u52a1\u8c03\u5ea6.md",sourceDirName:"spark",slug:"/spark/Spark \u4efb\u52a1\u8c03\u5ea6",permalink:"/docs/spark/Spark \u4efb\u52a1\u8c03\u5ea6",draft:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"defaultSidebar",previous:{title:"Spark \u5171\u4eab\u53d8\u91cf",permalink:"/docs/spark/Spark \u5171\u4eab\u53d8\u91cf"},next:{title:"Spark Shuffle",permalink:"/docs/spark/Spark Shuffle"}},o={},k=[{value:"\u4efb\u52a1\u8c03\u5ea6\u6982\u8ff0",id:"\u4efb\u52a1\u8c03\u5ea6\u6982\u8ff0",level:2},{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:3},{value:"\u8c03\u5ea6\u6d41\u7a0b",id:"\u8c03\u5ea6\u6d41\u7a0b",level:3},{value:"Stage \u5212\u5206",id:"stage-\u5212\u5206",level:2},{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5-1",level:3},{value:"\u5212\u5206\u89c4\u5219",id:"\u5212\u5206\u89c4\u5219",level:3},{value:"\u4ee3\u7801\u5b9e\u73b0",id:"\u4ee3\u7801\u5b9e\u73b0",level:3},{value:"RPC \u6a21\u5757",id:"rpc-\u6a21\u5757",level:2},{value:"\u6838\u5fc3\u6982\u5ff5",id:"\u6838\u5fc3\u6982\u5ff5",level:3},{value:"\u901a\u4fe1\u8fc7\u7a0b",id:"\u901a\u4fe1\u8fc7\u7a0b",level:3},{value:"Task \u8c03\u5ea6",id:"task-\u8c03\u5ea6",level:2},{value:"\u521d\u59cb\u5316\u9636\u6bb5",id:"\u521d\u59cb\u5316\u9636\u6bb5",level:3},{value:"\u63d0\u4ea4\u9636\u6bb5",id:"\u63d0\u4ea4\u9636\u6bb5",level:3},{value:"\u542f\u52a8\u9636\u6bb5",id:"\u542f\u52a8\u9636\u6bb5",level:3},{value:"\u6267\u884c\u9636\u6bb5",id:"\u6267\u884c\u9636\u6bb5",level:3},{value:"\u56de\u6536\u9636\u6bb5",id:"\u56de\u6536\u9636\u6bb5",level:3}],d={toc:k};function s(e){let{components:t,...r}=e;return(0,l.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"spark-\u4efb\u52a1\u8c03\u5ea6"},"Spark \u4efb\u52a1\u8c03\u5ea6"),(0,l.kt)("h2",{id:"\u4efb\u52a1\u8c03\u5ea6\u6982\u8ff0"},"\u4efb\u52a1\u8c03\u5ea6\u6982\u8ff0"),(0,l.kt)("p",null,"\u4efb\u52a1\u8c03\u5ea6\u5e76\u975e Spark Core \u4e2d\u7684\u5fc5\u4fee\u5185\u5bb9\uff0c\u4f46\u638c\u63e1\u4efb\u52a1\u8c03\u5ea6\u7684\u539f\u7406\u5bf9\u4e8e ",(0,l.kt)("strong",{parentName:"p"},"\u63d0\u5347\u5f00\u53d1\u4eba\u5458\u5728 Spark \u5e94\u7528\u7a0b\u5e8f\u4e0a\u7684\u6545\u969c\u6392\u67e5\u548c\u6027\u80fd\u8c03\u4f18\u7684\u80fd\u529b")," \u5927\u6709\u88e8\u76ca\u3002"),(0,l.kt)("p",null,"\u5f53\u7136\uff0c\u638c\u63e1\u4efb\u52a1\u8c03\u5ea6\u539f\u7406\u7edd\u975e\u6613\u4e8b\u3002\u4e00\u65b9\u9762\uff0c\u4f5c\u4e3a\u5927\u578b\u5206\u5e03\u5f0f\u8ba1\u7b97\u6846\u67b6\uff0cSpark \u7684\u4efb\u52a1\u8c03\u5ea6\u903b\u8f91\u6bd4\u8f83\u590d\u6742\uff1b\u53e6\u4e00\u65b9\u9762\uff0c\u73b0\u6709\u7684 Spark \u6559\u7a0b\u5bf9\u4e8e\u4efb\u52a1\u8c03\u5ea6\u90e8\u5206\u5927\u591a\u6570\u662f\u6d45\u5c1d\u8f84\u6b62\uff0c\u6ca1\u6709\u8fc7\u591a\u5c55\u5f00\u3002\u56e0\u6b64\uff0c\u5b66\u4e60 Spark \u4efb\u52a1\u8c03\u5ea6\u539f\u7406\uff0c\u66f4\u591a\u7684\u8fd8\u9700\u8981\u4f9d\u9760\u81ea\u8eab\u53bb\u9605\u8bfb\u6e90\u7801\u3002"),(0,l.kt)("h3",{id:"\u57fa\u672c\u6982\u5ff5"},"\u57fa\u672c\u6982\u5ff5"),(0,l.kt)("p",null,"\u672c\u6587\u57fa\u4e8e ",(0,l.kt)("strong",{parentName:"p"},"Spark 3.1.2")," \u7248\u672c\u6765\u8c08\u8c08 Spark \u7684\u4efb\u52a1\u8c03\u5ea6\u6d41\u7a0b\uff0c\u53d7\u9650\u4e8e\u5f53\u524d\u7684\u80fd\u529b\u548c\u6c34\u5e73\uff0c\u53ea\u80fd\u4ece\u8f83\u7c97\u7684\u7c92\u5ea6\u6765\u4ecb\u7ecd\u8fd9\u90e8\u5206\u5185\u5bb9\uff0c\u4f46\u5176\u4e2d\u6d89\u53ca\u5230\u7684\u6a21\u5757\u548c\u7ec4\u4ef6\uff0c\u4f1a\u5c3d\u53ef\u80fd\u5730\u4ecb\u7ecd\u5230\u3002"),(0,l.kt)("p",null,"\u5728\u5c55\u5f00\u4ecb\u7ecd\u524d\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u638c\u63e1\u4e24\u65b9\u9762\u7684\u6982\u5ff5\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7b2c\u4e00\u65b9\u9762\uff0c\u662f\u7406\u6e05 Application\u3001Job\u3001Stage\u3001Task \u7684\u542b\u4e49\u53ca\u5173\u8054\u3002")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u540d\u79f0")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u542b\u4e49")))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Application"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6307\u7528\u6237\u63d0\u4ea4\u7684 Spark \u5e94\u7528\u7a0b\u5e8f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Job"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6307 Spark \u4f5c\u4e1a\uff0c\u662f Application \u7684\u5b50\u96c6\uff0c\u7531\u884c\u52a8\u7b97\u5b50\uff08action\uff09\u89e6\u53d1")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Stage"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6307 Spark \u9636\u6bb5\uff0c\u662f Job \u7684\u5b50\u96c6\uff0c\u4ee5 RDD \u7684\u5bbd\u4f9d\u8d56\u4e3a\u754c")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Task"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6307 Spark \u4efb\u52a1\uff0c\u662f Stage \u7684\u5b50\u96c6\uff0cSpark \u4e2d\u6700\u57fa\u672c\u7684\u4efb\u52a1\u6267\u884c\u5355\u5143\uff0c\u5bf9\u5e94\u5355\u4e2a\u7ebf\u7a0b\uff0c\u4f1a\u88ab\u5c01\u88c5\u6210 TaskDescription \u5bf9\u8c61\u63d0\u4ea4\u5230 Executor \u7684\u7ebf\u7a0b\u6c60\u4e2d\u6267\u884c")))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7b2c\u4e8c\u65b9\u9762\uff0c\u662f\u4e86\u89e3 Driver \u548c Executor \u5728\u4efb\u52a1\u8c03\u5ea6\u4e2d\u626e\u6f14\u7684\u89d2\u8272\u3002")),(0,l.kt)("p",null,"Driver \u662f\u8fd0\u884c\u7528\u6237\u7a0b\u5e8f ",(0,l.kt)("inlineCode",{parentName:"p"},"main()")," \u51fd\u6570\u5e76\u521b\u5efa SparkContext \u7684\u5b9e\u4f8b\uff0c\u662f\u4efb\u52a1\u8c03\u5ea6\u4e2d\u6700\u4e3a\u5173\u952e\u7684\u90e8\u5206\u3002"),(0,l.kt)("p",null,"\u5728\u4e00\u4e2a\u5b8c\u6574\u7684\u4efb\u52a1\u8c03\u5ea6\u4e2d\uff0c\u7528\u6237\u63d0\u4ea4\u7684\u7a0b\u5e8f\u4f1a\u7ecf\u5386 ",(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"Application \u2192 Job \u2192 Stage \u2192 Task"))," \u7684\u8f6c\u5316\u8fc7\u7a0b\uff0c\u800c\u8fd9\u6574\u4e2a\u8f6c\u5316\u8fc7\u7a0b\uff0c\u7531 Driver \u7684 3 \u5927\u6838\u5fc3\u6a21\u5757\u5171\u540c\u5b8c\u6210\uff0c\u5b83\u4eec\u7684\u540d\u79f0\u4e0e\u804c\u8d23\u5982\u4e0b\u8868\u6240\u793a\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u6a21\u5757\u540d\u79f0")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u6a21\u5757\u804c\u8d23")))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"DAGScheduler"),(0,l.kt)("td",{parentName:"tr",align:null},"DAG \u8c03\u5ea6\u5668\uff0c\u8d1f\u8d23\u9636\u6bb5\uff08Stage\uff09\u7684\u5212\u5206\u5e76\u751f\u6210 TaskSet \u4f20\u9012\u7ed9 TaskScheduler")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"TaskScheduler"),(0,l.kt)("td",{parentName:"tr",align:null},"Task \u8c03\u5ea6\u5668\uff0c\u51b3\u5b9a\u4efb\u52a1\u6c60\u8c03\u5ea6\u7b56\u7565\uff0c\u8d1f\u8d23 Task \u7684\u7ba1\u7406\uff08\u5305\u62ec Task \u7684\u63d0\u4ea4\u4e0e\u9500\u6bc1\uff09")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"SchedulerBackend"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8c03\u5ea6\u540e\u7aef\uff0c\u7ef4\u6301\u4e0e Executor \u7684\u901a\u4fe1\uff0c\u5e76\u8d1f\u8d23\u5c06 Task \u63d0\u4ea4\u5230 Executor")))),(0,l.kt)("p",null,"Executor \u662f\u6267\u884c\u5b9e\u9645\u8ba1\u7b97\u4efb\u52a1\u7684\u5b9e\u4f8b\uff0c\u662f\u4efb\u52a1\u8c03\u5ea6\u7684\u7ec8\u70b9\uff0c\u5b83\u5305\u542b\u4ee5\u4e0b\u6838\u5fc3\u6a21\u5757\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u6a21\u5757\u540d\u79f0")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u6a21\u5757\u529f\u80fd")))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ThreadPool"),(0,l.kt)("td",{parentName:"tr",align:null},"\u4efb\u52a1\u6267\u884c\u7ebf\u7a0b\u6c60\uff0c\u7528\u4e8e\u6267\u884c Driver \u63d0\u4ea4\u8fc7\u6765\u7684 Task")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"BlockManager"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5b58\u50a8\u7ba1\u7406\u5668\uff0c\u4e3a RDD \u63d0\u4f9b\u7f13\u5b58\u670d\u52a1\uff0c\u53ef\u63d0\u9ad8\u8ba1\u7b97\u901f\u7387")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ExecutorBackend"),(0,l.kt)("td",{parentName:"tr",align:null},"Executor \u8c03\u5ea6\u540e\u7aef\uff0c\u7ef4\u6301\u4e0e Driver \u7684\u901a\u4fe1\uff0c\u5e76\u8d1f\u8d23\u5c06\u4efb\u52a1\u6267\u884c\u7ed3\u679c\u53cd\u9988\u7ed9 Driver")))),(0,l.kt)("h3",{id:"\u8c03\u5ea6\u6d41\u7a0b"},"\u8c03\u5ea6\u6d41\u7a0b"),(0,l.kt)("p",null,"Spark \u4efb\u52a1\u8c03\u5ea6\u57fa\u672c\u4e0a\u4f1a\u7ecf\u5386 ",(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"\u63d0\u4ea4 \u2192 Stage \u5212\u5206 \u2192 Task \u8c03\u5ea6 \u2192 Task \u6267\u884c")),"\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5927\u81f4\u53ef\u4ee5\u63cf\u8ff0\u4e3a\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u7528\u6237\u63d0\u4ea4\u4e00\u4e2a\u8ba1\u7b97\u5e94\u7528\uff08Application\uff09"),(0,l.kt)("li",{parentName:"ol"},"Driver \u6267\u884c\u7528\u6237\u7a0b\u5e8f\u4e2d\u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"main()")," \u65b9\u6cd5\uff0c\u6839\u636e\u884c\u52a8\u7b97\u5b50\u63d0\u53d6\u4f5c\u4e1a\uff08Job\uff09"),(0,l.kt)("li",{parentName:"ol"},"DAGScheduler \u89e3\u6790\u5404\u4e2a\u4f5c\u4e1a\u7684 DAG \u8fdb\u884c\u9636\u6bb5\uff08Stage\uff09\u5212\u5206\u548c\u4efb\u52a1\u96c6\uff08TaskSet\uff09\u7ec4\u88c5"),(0,l.kt)("li",{parentName:"ol"},"TaskScheduler \u5c06\u4efb\u52a1\u96c6\u53d1\u9001\u81f3\u4efb\u52a1\u961f\u5217 rootPool"),(0,l.kt)("li",{parentName:"ol"},"SchedulerBackend \u901a\u8fc7 Cluster Manager \u83b7\u53d6 Executor \u8d44\u6e90\uff0c\u5e76\u5c06\u4efb\u52a1\uff08Task\uff09\u53d1\u9001\u7ed9 Executor"),(0,l.kt)("li",{parentName:"ol"},"Executor \u6267\u884c\u8ba1\u7b97\u5e76\u7ba1\u7406\u5b58\u50a8\u5757\uff08Block\uff09"),(0,l.kt)("li",{parentName:"ol"},"Driver \u6700\u7ec8\u4ece Executor \u83b7\u5f97\u8ba1\u7b97\u7ed3\u679c\uff0c\u6c47\u603b\u540e\u8fd4\u56de\u7ed9\u7528\u6237")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"DAG\uff08Directed Acyclic Graph\uff09\u662f\u4e00\u4e2a\u6709\u5411\u65e0\u73af\u56fe\uff0c\u7531\u70b9\u548c\u7ebf\u7ec4\u6210\uff0c\u8be5\u56fe\u5177\u6709\u65b9\u5411\uff0c\u4e0d\u4f1a\u95ed\u73af\u3002")),(0,l.kt)("p",null,"\u8be5\u8fc7\u7a0b\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6d41\u7a0b\u56fe\u6765\u8868\u793a\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(4151).Z,width:"2212",height:"785"})),(0,l.kt)("p",null,"\u5f53\u7136\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u63cf\u8ff0\u662f\u6bd4\u8f83\u7c97\u7c92\u5ea6\u7684\uff0c\u65e0\u6cd5\u5e2e\u52a9\u6211\u4eec\u4e86\u89e3\u91cc\u9762\u7684\u5b9e\u73b0\u7ec6\u8282\u3002\u6bd4\u5982\u8bf4\uff0cStage \u662f\u600e\u4e48\u5212\u5206\u7684\uff1fTask \u662f\u600e\u4e48\u8fdb\u884c\u8c03\u5ea6\u7684\uff1fTask \u662f\u600e\u4e48\u6267\u884c\u7684\uff1f\u4f46\u662f\uff0c\u53ea\u8981\u80fd\u5e2e\u52a9\u6211\u4eec\u4e86\u89e3\u5927\u81f4\u7684\u8fc7\u7a0b\uff0c\u4ee5\u53ca\u8fd9\u4e2a\u8fc7\u7a0b\u51fa\u73b0\u7684\u6a21\u5757\u53ca\u7ec4\u4ef6\uff0c\u90a3\u4e48\u5b83\u7684\u4efb\u52a1\u4fbf\u7b97\u5b8c\u6210\u4e86\u3002\u5177\u4f53\u7684\u5b9e\u73b0\u539f\u7406\u548c\u8fc7\u7a0b\uff0c\u5c06\u5728\u4e0b\u6587\u9010\u4e00\u4ecb\u7ecd\u3002"),(0,l.kt)("h2",{id:"stage-\u5212\u5206"},"Stage \u5212\u5206"),(0,l.kt)("p",null,"Stage \u5212\u5206\u662f\u4efb\u52a1\u8c03\u5ea6\u7684\u7b2c\u4e00\u6b65\uff0c\u7531 DAGScheduler \u5b8c\u6210\uff0c\u5b83\u51b3\u5b9a\u4e86 ",(0,l.kt)("strong",{parentName:"p"},"\u4e00\u4e2a Job \u5c06\u88ab\u5212\u5206\u4e3a\u591a\u5c11\u4e2a TaskSet"),"\u3002"),(0,l.kt)("p",null,"\u672c\u8282\u5c06\u4ecb\u7ecd Stage \u7684\u57fa\u672c\u6982\u5ff5\u4ee5\u53ca\u5212\u5206\u89c4\u5219\uff0c\u5e76\u5bf9\u5176\u4ee3\u7801\u5b9e\u73b0\u5c55\u5f00\u7b80\u5355\u63cf\u8ff0\u3002"),(0,l.kt)("h3",{id:"\u57fa\u672c\u6982\u5ff5-1"},"\u57fa\u672c\u6982\u5ff5"),(0,l.kt)("p",null,"\u76f8\u8f83\u4e8e Task\uff0cStage \u7684\u5b9a\u4e49\u663e\u5f97\u96be\u4ee5\u7406\u89e3\u3002\u5728\u5b98\u65b9\u5b9a\u4e49\u4e0a\uff0c",(0,l.kt)("strong",{parentName:"p"},"Stage \u662f\u4e00\u4e2a\u5e76\u884c\u4efb\u52a1\uff08Task\uff09\u7684\u96c6\u5408\uff0c\u8fd9\u4e2a\u96c6\u5408\u4e0a\u7684 Task\uff0c\u90fd\u6765\u6e90\u4e8e\u540c\u4e00\u4e2a Job\uff0c\u5177\u6709\u76f8\u540c\u7684\u8ba1\u7b97\u903b\u8f91\u3002")),(0,l.kt)("p",null,"\u5bf9\u4e8e\u90e8\u5206\u521d\u5b66\u8005\u6765\u8bf4\uff0c\u770b\u5230 Stage \u7684\u6982\u5ff5\u53ef\u80fd\u6709\u6b64\u56f0\u60d1\uff1a\u5df2\u77e5 Task \u662f\u5b9e\u9645\u6267\u884c\u8ba1\u7b97\u4efb\u52a1\u7684\u5355\u5143\uff0c\u4e3a\u4f55\u8fd8\u9700\u8981 Stage \u8fd9\u4e2a\u96c6\u5408\u7684\u6982\u5ff5\uff1f\u5c06 Job \u76f4\u63a5\u62c6\u5206\u6210\u4e00\u7cfb\u5217 Task \u7136\u540e\u63d0\u4ea4\u6267\u884c\u4e0d\u5c31\u597d\u4e86\u5417\uff1f\u5b9e\u9645\u4e0a\uff0c\u4e00\u4e2a\u8ba1\u7b97\u4f5c\u4e1a\u7684\u6267\u884c\u7edd\u4e0d\u662f\u7b80\u5355\u5730\u62c6\u5206\u3001\u63d0\u4ea4 Task \u90a3\u4e48\u7b80\u5355\uff0c\u5b83\u8fd8\u9700\u8981\u8003\u8651 Task \u4e4b\u95f4\u7684\u6267\u884c\u987a\u5e8f\u3001\u6570\u636e\u6d41\u8f6c\u7b49\u95ee\u9898\u3002"),(0,l.kt)("p",null,"\u4ee5 WordCount \u4e3a\u4f8b\uff0c\u8ba1\u7b97\u9700\u8981\u7ecf\u5386 ",(0,l.kt)("inlineCode",{parentName:"p"},"flatMap")," \u2192  ",(0,l.kt)("inlineCode",{parentName:"p"},"map")," \u2192 ",(0,l.kt)("inlineCode",{parentName:"p"},"reduceByKey")," \u7684\u8fc7\u7a0b\uff0c\u5176\u4e2d ",(0,l.kt)("inlineCode",{parentName:"p"},"reduceByKey")," \u9700\u8981\u5728\u83b7\u53d6\u524d\u5e8f\u9636\u6bb5\u7684\u6240\u6709\u8ba1\u7b97\u7ed3\u679c\u540e\u624d\u53ef\u4ee5\u8fd0\u884c\u3002\u5728\u5206\u5e03\u5f0f\u8ba1\u7b97\u4e2d\uff0c\u7531\u4e8e\u6570\u636e\u662f\u5206\u6563\u5728\u591a\u4e2a\u8282\u70b9\u7684\uff0c\u8ba1\u7b97\u4efb\u52a1\u4f1a\u88ab\u5206\u53d1\u5230\u5404\u8282\u70b9\u6267\u884c\uff0c\u5982\u679c\u4e0d\u8003\u8651 Task \u6267\u884c\u987a\u5e8f\u7684\u8bdd\uff0c\u90a3\u4e48\u4e00\u65e6 ",(0,l.kt)("inlineCode",{parentName:"p"},"reduceByKey")," \u63d0\u524d\u8fd0\u884c\uff0c\u7528\u6237\u5c06\u5f97\u5230\u9519\u8bef\u7684\u7ed3\u679c\u3002\u56e0\u6b64\uff0c\u5fc5\u987b\u6709\u4e00\u4e2a Task \u8c03\u5ea6\u673a\u5236\uff0c\u544a\u8bc9 Spark \u96c6\u7fa4\u54ea\u4e9b Task \u5148\u6267\u884c\u3001\u54ea\u4e9b Task \u540e\u6267\u884c\u3002\u800c\u8fd9\uff0c\u4fbf\u662f Stage \u5b58\u5728\u7684\u610f\u4e49\uff0c\u662f\u5b83\u5e2e\u52a9 Spark \u4efb\u52a1\u8c03\u5ea6\u6784\u5efa\u4e86\u84dd\u56fe\u3002"),(0,l.kt)("h3",{id:"\u5212\u5206\u89c4\u5219"},"\u5212\u5206\u89c4\u5219"),(0,l.kt)("p",null,"Stage \u7684\u5212\u5206\u65b9\u5f0f\u53ef\u4ee5\u7b80\u8ff0\u4e3a\uff1a",(0,l.kt)("strong",{parentName:"p"},"\u5728 DAG \u4e2d\u8fdb\u884c\u53cd\u5411\u89e3\u6790\uff0c\u9047\u5230\u5bbd\u4f9d\u8d56\u5c31\u65ad\u5f00\uff0c\u9047\u5230\u7a84\u4f9d\u8d56\u5c31\u628a\u5f53\u524d\u7684 RDD \u52a0\u5165\u5230\u5f53\u524d\u7684\u9636\u6bb5\u4e2d\u3002"),"\u4e4b\u6240\u4ee5\u8fd9\u6837\u5212\u5206\uff0c\u662f\u56e0\u4e3a\u5bbd\u4f9d\u8d56\u7684\u4f4d\u7f6e\u610f\u5473\u7740 Shuffle \u7684\u53d1\u751f\uff0c\u8868\u793a\u8fd9\u4e2a\u4f4d\u7f6e\u540e\u7684 RDD \u9700\u8981\u7b49\u5f85\u524d\u5e8f RDD \u8ba1\u7b97\u5b8c\u6210\u540e\u624d\u53ef\u4ee5\u5f00\u59cb\u8ba1\u7b97\u3002"),(0,l.kt)("p",null,"\u4e0b\u56fe\u4e3a Stage \u5212\u5206\u7684\u793a\u4f8b\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(4839).Z,width:"1660",height:"1370"})),(0,l.kt)("p",null,"\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0cDAGScheduler \u53cd\u5411\u89e3\u6790\uff0c\u5728 ",(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"RDD B \u2192 RDD A"))," \u548c ",(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"RDD G \u2192 RDD F"))," \u95f4\u53d1\u73b0 ",(0,l.kt)("strong",{parentName:"p"},"ShuffleDependency"),"\uff0c\u4e8e\u662f\u5728\u8fd9\u4e24\u4e2a\u4f4d\u7f6e\u8fdb\u884c\u9636\u6bb5\u5212\u5206\uff0c\u5206\u522b\u5f97\u5230 Stage 01\u3001Stage 02 \u548c Stage 03\u3002\u5176\u4e2d\uff0cStage 01 \u548c Stage 02 \u7684\u7c7b\u578b\u4e3a ",(0,l.kt)("strong",{parentName:"p"},"ShuffleMapStage"),"\uff0c\u800c Stage 03 \u7684\u7c7b\u578b\u4e3a ",(0,l.kt)("strong",{parentName:"p"},"ResultStage"),"\u3002 "),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"ShuffleDependency \u4fdd\u5b58\u5728 Shuffle \u540e\u9762\u7684 RDD \u4e2d\uff0c\u4f46\u662f\u5728\u9636\u6bb5\u5212\u5206\u65f6\uff0c\u4f1a\u8d4b\u4e88 Shuffle \u524d\u7684 Stage\u3002\u4f8b\u5982\uff0cRDD B \u7684 ShuffleDependency \u4f1a\u8d4b\u4e88 Stage 01 \u7684 ShuffleMapStage\uff0c\u4ee5\u4fbf\u4e8e ShuffleMapTask \u53ef\u4ee5\u83b7\u53d6\u5230 ShuffleDependency \u4e2d\u7684\u91cd\u8981\u4fe1\u606f\u3002\u8fd9\u4e00\u70b9\uff0c\u5728\u540e\u7eed\u7684 Shuffle \u6559\u7a0b\u4e2d\u5f97\u4ee5\u4f53\u73b0\u3002")),(0,l.kt)("h3",{id:"\u4ee3\u7801\u5b9e\u73b0"},"\u4ee3\u7801\u5b9e\u73b0"),(0,l.kt)("p",null,"Stage \u5212\u5206\u7684\u4ee3\u7801\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003\u4e0b\u56fe\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(4383).Z,width:"1232",height:"602"})),(0,l.kt)("p",null,"\u8be5\u56fe\u4e3a DAGScheduler \u4e2d\u5173\u4e8e\u9636\u6bb5\u5212\u5206\u7684\u6e90\u7801\u5b9e\u73b0\uff0c\u7b80\u5355\u6765\u8bf4\u5c31\u662f\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u7528\u6237\u63d0\u4ea4\u4f5c\u4e1a\uff0c",(0,l.kt)("inlineCode",{parentName:"li"},"handleJobSubmitted")," \u65b9\u6cd5\u901a\u8fc7\u6700\u540e\u4e00\u4e2a RDD \u89e3\u6790\u51fa ResultStage\u5e76\u63d0\u4ea4\u7ed9 ",(0,l.kt)("inlineCode",{parentName:"li"},"submitStage")," \u65b9\u6cd5"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"submitStage")," \u65b9\u6cd5\u8c03\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"getMissingParentStages")," \u53cd\u5411\u89e3\u6790\uff0c\u63d0\u53d6 ResultStage \u7684 Parent Stage"),(0,l.kt)("li",{parentName:"ol"},"\u82e5\u65e0 Parent Stage\uff0c\u76f4\u63a5\u8c03\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"submitMissingTasks")," \u65b9\u6cd5\uff0c\u751f\u6210\u8be5\u9636\u6bb5\u4e0b\u7684 TaskSet"),(0,l.kt)("li",{parentName:"ol"},"\u82e5\u5b58\u5728 Parent Stage\uff0c\u5c06\u5176\u6dfb\u52a0\u5230\u5230\u961f\u5217 ",(0,l.kt)("inlineCode",{parentName:"li"},"waitingStages")," \u4e2d"),(0,l.kt)("li",{parentName:"ol"},"\u5f53\u524d\u5e8f\u4efb\u52a1\u5b8c\u6210\uff0c",(0,l.kt)("inlineCode",{parentName:"li"},"handleTaskCompletion")," \u4f1a\u4ece ",(0,l.kt)("inlineCode",{parentName:"li"},"waitingStages")," \u53d6\u51fa\u5269\u4f59\u7684 Stage\uff08\u53ef\u80fd\u65e2\u6709 ShuffleMapStage \u548c ResultStage\uff09\u5e76\u63d0\u4ea4\uff0c\u76f4\u81f3\u751f\u6210\u6240\u6709\u9636\u6bb5\u7684 TaskSet")),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u53ef\u4ee5\u770b\u51fa\uff0cStage \u5212\u5206\u7684\u6700\u7ec8\u4ea7\u7269\u662f TaskSet\uff0c\u5b83\u662f\u4e00\u7ec4 Task \u5e8f\u5217\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u4e0e Stage \u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u5173\u7cfb"),"\uff0c\u5176\u4e2d\u7684 Task \u5747\u6765\u81ea\u4e8e\u540c\u4e00\u4e2a Stage\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u4e14 Task \u6570\u91cf\u4e0e Stage \u4e2d\u6700\u540e\u4e00\u4e2a RDD \u7684\u5206\u533a\u6570\u4e00\u81f4\u3002"))),(0,l.kt)("h2",{id:"rpc-\u6a21\u5757"},"RPC \u6a21\u5757"),(0,l.kt)("p",null,"\u901a\u8fc7 Stage \u5212\u5206\uff0c\u6211\u4eec\u5df2\u7ecf\u83b7\u5f97\u4e86\u4efb\u52a1\u96c6 TaskSet\uff0c\u53ef\u4ee5\u8fdb\u5165\u5230 Task \u8c03\u5ea6\u9636\u6bb5\u3002\u4f46\u662f\uff0cTask \u8c03\u5ea6\u9636\u6bb5\u4e2d\u5305\u542b\u4e86\u5927\u91cf RPC \u4ea4\u4e92\u8fc7\u7a0b\uff0c\u56e0\u6b64\u6211\u4eec\u6709\u5fc5\u8981\u63d0\u524d\u4e86\u89e3\u4e00\u4e0b Spark \u7684 RPC \u6a21\u5757\u3002"),(0,l.kt)("h3",{id:"\u6838\u5fc3\u6982\u5ff5"},"\u6838\u5fc3\u6982\u5ff5"),(0,l.kt)("p",null,"Spark \u7684 RPC \u6a21\u5757\u4e3b\u8981\u8d1f\u8d23 Spark \u96c6\u7fa4\u4e2d\u5404\u8282\u70b9\u95f4\uff08\u6bd4\u5982 Driver \u4e0e Executor\uff09\u901a\u4fe1\u529f\u80fd\u7684\u5b9e\u73b0\u3002"),(0,l.kt)("p",null,"\u81ea 2.x \u7248\u672c\u540e\uff0cSpark \u5265\u79bb\u4e86 RPC \u6846\u67b6 Akka\uff0c\u5e76\u57fa\u4e8e Netty \u5b9e\u73b0\u4e86\u65b0\u7684 RPC \u6846\u67b6\u3002\u5c3d\u7ba1 Akka \u5df2\u7ecf\u88ab\u5265\u79bb\uff0c\u4f46\u65b0\u7248\u7684 RPC \u6846\u67b6\u4ecd\u7136\u501f\u9274\u4e86 Akka \u7684 Actor \u6a21\u578b\u7684\u8bbe\u8ba1\u601d\u60f3\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u4ee5 RpcEnv\u3001RpcEndpoint\u3001RpcEndpointRef \u5206\u522b\u66ff\u4ee3 Actor \u4e2d\u7684 ActorSystem\u3001Actor\u3001ActorRef\u3002")),(0,l.kt)("hr",null),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"RpcEnv")),(0,l.kt)("p",null,"RPC \u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u8d1f\u8d23 RpcEndpoint \u6574\u4e2a\u751f\u547d\u5468\u671f\u7684\u7ba1\u7406\uff08\u5305\u62ec RpcEndpoint \u7684\u6ce8\u518c\u3001\u505c\u6b62\u7b49\uff09\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"RpcEndpoint")),(0,l.kt)("p",null,"\u8fdb\u884c\u6d88\u606f\u5904\u7406\u7684\u901a\u4fe1\u7ec8\u7aef\uff08\u53ef\u4f4d\u4e8e Master\u3001Worker\u3001Driver \u7b49\uff09\uff0c\u5b83\u7684\u751f\u547d\u5468\u671f\u5305\u542b\u5982\u4e0b\u8fc7\u7a0b\uff1a"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"constructor \u2192 onStart \u2192 receive")," \u2192 onStop*")),(0,l.kt)("p",null,"\u5176\u4e2d\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"receive*")," \u5206\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"receive")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"receiveAndReply")," \u4e24\u79cd\u65b9\u6cd5\uff0c\u524d\u8005\u7528\u4e8e\u54cd\u5e94 RpcEndpointRef \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"send")," \u8bf7\u6c42\uff0c\u540e\u8005\u7528\u4e8e\u54cd\u5e94 RpcEndpointRef \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"ask")," \u8bf7\u6c42\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"RpcEndpointRef")),(0,l.kt)("p",null,"RpcEndpoint \u7684\u4e00\u4e2a\u5f15\u7528\uff0c\u5305\u542b\u4e86\u8fdc\u7a0b\u5730\u5740 ",(0,l.kt)("inlineCode",{parentName:"p"},"RpcAddress"),"\uff0c\u53ef\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"send")," \u6216 ",(0,l.kt)("inlineCode",{parentName:"p"},"ask")," \u5411 RpcEndpoint \u53d1\u9001\u6d88\u606f\u3002"),(0,l.kt)("h3",{id:"\u901a\u4fe1\u8fc7\u7a0b"},"\u901a\u4fe1\u8fc7\u7a0b"),(0,l.kt)("p",null,"RpcEnv\u3001RpcEndpoint\u3001RpcEndpointRef \u95f4\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(751).Z,width:"1476",height:"983"})),(0,l.kt)("p",null,"\u901a\u8fc7\u8be5\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u63cf\u8ff0 RPC \u6a21\u5757\u7684\u901a\u4fe1\u8fc7\u7a0b\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u5728 RpcEnv \u4e2d\u6ce8\u518c RpcEndpoint"),(0,l.kt)("li",{parentName:"ol"},"\u542f\u52a8 RpcEndpoint\uff0c\u83b7\u53d6\u4e00\u4e2a RpcEndpoint \u7684\u5f15\u7528 RpcEndpointRef"),(0,l.kt)("li",{parentName:"ol"},"RpcEndpointRef \u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"send")," \u6216 ",(0,l.kt)("inlineCode",{parentName:"li"},"ask")," \u65b9\u6cd5\u5f80 OutBoxes \u5199\u5165\u6d88\u606f"),(0,l.kt)("li",{parentName:"ol"},"RpcEndpoint \u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"receive*")," \u65b9\u6cd5\u4ece InBox \u8bfb\u53d6\u6d88\u606f\u5e76\u5904\u7406")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"InBox \u53ef\u4ee5\u4e3a RpcEndpoint \u7f13\u5b58\u548c\u4f20\u9012\u53d1\u9001\u7ed9\u5b83\u7684\u6d88\u606f\uff0cOutBox \u53ef\u4ee5\u5411\u5176\u4ed6 RpcEndpoint \u53d1\u9001\u6d88\u606f\u3002\u6bcf\u4e2a RpcEndpoint \u5bf9\u5e94 1 \u4e2a InBox \u548c N \u4e2a OutBox\uff08N \u2265 1\uff09\u3002")),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u5b9e\u9645\u4e0a\uff0cRPC \u7684\u901a\u4fe1\u8fc7\u7a0b\u590d\u6742\u5f97\u591a\uff0c\u8fd8\u6d89\u53ca\u5230 Dispatcher\u3001MessageLoop \u7b49\u7ec4\u4ef6\u3002\u672c\u8282\u53ea\u4e3a\u7b80\u5355\u5730\u9610\u8ff0\u4e00\u4e0b\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u4e3a\u540e\u7eed\u5b66\u4e60 Task \u8c03\u5ea6\u6253\u597d\u7406\u8bba\u57fa\u7840\uff0c\u5e76\u4e0d\u5bf9\u8be5\u90e8\u5206\u5c55\u5f00\u8be6\u7ec6\u4ecb\u7ecd\u3002")),(0,l.kt)("h2",{id:"task-\u8c03\u5ea6"},"Task \u8c03\u5ea6"),(0,l.kt)("p",null,"Task \u8c03\u5ea6\u662f\u672c\u6587\u6700\u540e\u4e00\u8282\u4e5f\u662f\u6700\u4e3a\u6838\u5fc3\u7684\u90e8\u5206\u3002\u5b83\u662f\u4e00\u4e2a\u975e\u5e38\u590d\u6742\u7684\u8fc7\u7a0b\uff0c\u6d89\u53ca\u5230 DAGScheduler\u3001TaskScheduler\u3001SchedulerBackend\u3001ExecutorBackend\u3001Executor \u7b49\u591a\u4e2a\u6a21\u5757\u3002"),(0,l.kt)("p",null,"\u4e00\u4e2a\u76f8\u5bf9\u5b8c\u6574\u7684 Task \u8c03\u5ea6\u6d41\u8f6c\u56fe\u5982\u4e0b\u6240\u793a\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(9607).Z,width:"2746",height:"1528"})),(0,l.kt)("p",null,"\u5728\u8fd9\u4e2a\u6d41\u8f6c\u56fe\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 Task \u8c03\u5ea6\u5927\u81f4\u5206\u4e3a 5 \u4e2a\u9636\u6bb5\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316\u9636\u6bb5\uff1a\u521d\u59cb\u5316 TaskScheduler \u548c SchedulerBackend \u7684\u9636\u6bb5"),(0,l.kt)("li",{parentName:"ul"},"\u63d0\u4ea4\u9636\u6bb5\uff1a\u4efb\u52a1\u63d0\u4ea4\u5230\u4efb\u52a1\u6c60 rootPool \u7684\u9636\u6bb5"),(0,l.kt)("li",{parentName:"ul"},"\u542f\u52a8\u9636\u6bb5\uff1a\u4ece\u4efb\u52a1\u6c60 rootPool \u53d6\u51fa\u4efb\u52a1\u5e76\u53d1\u5e03\u5230 Executor \u7684\u9636\u6bb5"),(0,l.kt)("li",{parentName:"ul"},"\u6267\u884c\u9636\u6bb5\uff1aExecutor \u6267\u884c\u8ba1\u7b97\u4efb\u52a1\u5e76\u5b58\u50a8\u8ba1\u7b97\u7ed3\u679c\u7684\u9636\u6bb5"),(0,l.kt)("li",{parentName:"ul"},"\u56de\u6536\u9636\u6bb5\uff1a\u4efb\u52a1\u56de\u6536\u3001\u72b6\u6001\u66f4\u65b0\u4e0e\u8d44\u6e90\u91ca\u653e\u7684\u9636\u6bb5")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u8c03\u5ea6\u6d41\u7a0b\u56fe\u6839\u636e Standalone \u6a21\u5f0f\u4e0b\u7684\u6d41\u8f6c\u60c5\u51b5\u8fdb\u884c\u7ed8\u5236\uff0cLocal\u3001Yarn \u7b49\u6a21\u5f0f\u4e0b\u7684\u6d41\u8f6c\u8fc7\u7a0b\u4f1a\u6709\u4e9b\u8bb8\u533a\u522b\u3002")),(0,l.kt)("h3",{id:"\u521d\u59cb\u5316\u9636\u6bb5"},"\u521d\u59cb\u5316\u9636\u6bb5"),(0,l.kt)("p",null,"\u5728\u524d\u9762\uff0c\u6211\u4eec\u63d0\u5230\u8fc7\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"TaskScheduler \u662f Task \u8c03\u5ea6\u5668\uff0c\u8d1f\u8d23 Task \u7684\u7ba1\u7406\uff0c\u5305\u62ec\u63d0\u4ea4\uff08\u63d0\u4ea4\u7ed9\u4efb\u52a1\u6c60 rootPool\uff09\u3001\u56de\u6536\u3001\u9500\u6bc1\u7b49"),(0,l.kt)("li",{parentName:"ul"},"SchedulerBackend \u662f\u8c03\u5ea6\u540e\u7aef\uff0c\u8d1f\u8d23\u4e0e Executor \u4fdd\u6301\u901a\u4fe1\uff0c\u5e76\u8d1f\u8d23 Task \u7684\u63d0\u4ea4\uff08\u63d0\u4ea4\u7ed9 Executor\uff09")),(0,l.kt)("p",null,"\u6240\u8c13\u521d\u59cb\u5316\u9636\u6bb5\u4fbf\u662f SparkContext \u8c03\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"createTaskScheduler")," \u65b9\u6cd5\u521b\u5efa TaskScheduler \u548c SchedulerBackend \u5b9e\u4f8b\u5e76\u5b8c\u6210\u521d\u59cb\u5316\u7684\u8fc7\u7a0b\uff0c\u5176\u6d41\u7a0b\u56fe\u5982\u4e0b\u6240\u793a\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(4747).Z,width:"1473",height:"1043"})),(0,l.kt)("p",null,"\u5728\u521d\u59cb\u5316\u9636\u6bb5\uff0cTaskScheduler \u4e3b\u8981\u5b8c\u6210\u4ee5\u4e0b\u5de5\u4f5c\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316 SchedulableBuilder\uff0c\u51b3\u5b9a\u4efb\u52a1\u8c03\u5ea6\u7b56\u7565\uff0c\u521b\u5efa\u4efb\u52a1\u6c60 rootPool"),(0,l.kt)("li",{parentName:"ul"},"\u542f\u52a8 SchedulerBackend")),(0,l.kt)("p",null,"SchedulerBackend \u4e3b\u8981\u5b8c\u6210\u4ee5\u4e0b\u5de5\u4f5c\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u521b\u5efa\u5e76\u7ef4\u6301\u4e0e Executor \u95f4\u7684 RPC \u8fde\u63a5"),(0,l.kt)("li",{parentName:"ul"},"\u7533\u8bf7 Executor \u8d44\u6e90")),(0,l.kt)("p",null,"\u4e0e TaskScheduler \u57fa\u672c\u53ea\u6709 TaskSchedulerImpl \u4e00\u4e2a\u5b9e\u73b0\u7c7b\u4e0d\u540c\uff0cSchedulerBackend \u7684\u5b9e\u73b0\u7c7b\u975e\u5e38\u591a\uff0c\u5927\u4f53\u5982\u4e0b\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(115).Z,width:"1983",height:"743"})),(0,l.kt)("p",null,"\u5b9e\u9645\u4e0a\uff0cSchedulerBackend \u5bf9 Executor \u7684\u8d44\u6e90\u7533\u8bf7\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\u662f\u7531 Cluster Manager \uff08Yarn\u3001Mesos \u7b49\uff09\u5b8c\u6210\u7684\uff0c\u4e5f\u6b63\u662f\u56e0\u4e3a\u8fd9\u4e2a\u539f\u56e0\uff0cSchedulerBackend \u62e5\u6709\u7740\u975e\u5e38\u591a\u7684\u5b9e\u73b0\u7c7b\u3002"),(0,l.kt)("p",null,"\u53d7\u9650\u4e8e\u7bc7\u5e45\uff0c\u672c\u6587\u4ec5\u4ecb\u7ecd Standalone \u6a21\u5f0f\u4e0b\u7533\u8bf7 Executor \u7684\u8fc7\u7a0b\uff0c\u5bf9\u5176\u4ed6\u6a21\u5f0f\u4e0d\u5c55\u5f00\u4ecb\u7ecd\uff0c\u5176\u8fc7\u7a0b\u5982\u4e0b\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(6535).Z,width:"3762",height:"1582"})),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u5728 Driver\u3001Master\u3001Worker \u95f4\u5b58\u5728\u591a\u4e2a RPC \u7ec8\u7aef\uff08RpcEndPoint\uff09\uff0c\u4e3a\u907f\u514d\u56fe\u4f8b\u8fc7\u957f\uff0c\u7701\u7565\u4e86\u6b64\u90e8\u5206\u5185\u5bb9\u3002")),(0,l.kt)("p",null,"\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0cExecutor \u7684\u521b\u5efa\u53d1\u751f\u5728 CoarseGrainedExecutorBackend\u3002\u5b83\u662f Executor \u7684\u8c03\u5ea6\u540e\u7aef\uff0c\u4f1a\u5efa\u7acb\u4e0e Driver \u7684\u901a\u4fe1\u8fde\u63a5\uff0c\u7136\u540e\u521b\u5efa Executor \u5b9e\u4f8b\u5e76\u5c06 Executor \u7684\u4fe1\u606f\u4f20\u9012\u7ed9 Driver\u3002\u63a5\u6536\u5230 Executor \u8d44\u6e90\u540e\uff0cDriver \u7aef\u7684SchedulerBackend \u4f1a\u5c06 Executor \u8d44\u6e90\u653e\u5165 ",(0,l.kt)("inlineCode",{parentName:"p"},"executorDataMap"),"\uff0c\u7b49\u5f85 Task \u8c03\u5ea6\u65f6\u63d0\u53d6\u3002"),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"CoarseGrainedExecutorBackend \u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u8fdb\u7a0b\uff0c\u7531 ExecuteRunner \u8c03\u7528 Java \u7684 Process \u7c7b\u5e93\u542f\u52a8\uff0c\u5e76\u975e\u662f Worker \u8fdb\u7a0b\u7684\u4e00\u90e8\u5206\u3002")),(0,l.kt)("admonition",{type:"danger"},(0,l.kt)("p",{parentName:"admonition"},"Executor \u7684\u7533\u8bf7\u662f\u4e00\u4e2a\u5f02\u6b65\u7684\u8fc7\u7a0b\uff0c\u5e76\u4e0d\u4f1a\u963b\u585e Driver \u7a0b\u5e8f\u7684\u8fd0\u884c\u3002\u8fd9\u91cc\u5f15\u51fa\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c Executor \u56e0\u4e3a\u79cd\u79cd\u539f\u56e0\u8fdf\u8fdf\u7533\u8bf7\u4e0d\u4e0b\u6765\uff08\u5728 Yarn \u6a21\u5f0f\u4e0b\u8fd9\u79cd\u60c5\u51b5\u5f88\u5e38\u89c1\uff09\uff0c\u90a3\u4e48 Driver \u7a0b\u5e8f\u53d1\u5e03\u7684\u4efb\u52a1\u662f\u5426\u4f1a\u56e0\u4e3a\u83b7\u53d6\u4e0d\u5230 Executor \u800c\u5931\u8d25\uff1f\u8fd9\u4e00\u70b9\u6211\u4eec\u5c06\u5728 ",(0,l.kt)("strong",{parentName:"p"},"\u542f\u52a8\u9636\u6bb5")," \u7ed9\u51fa\u7b54\u6848\u3002")),(0,l.kt)("h3",{id:"\u63d0\u4ea4\u9636\u6bb5"},"\u63d0\u4ea4\u9636\u6bb5"),(0,l.kt)("p",null,"\u63d0\u4ea4\u9636\u6bb5\u7531 TaskScheduler \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"submitTasks")," \u65b9\u6cd5\u89e6\u53d1\uff0c\u5b83\u4e3b\u8981\u5b8c\u6210\u4ee5\u4e0b\u5de5\u4f5c\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u521b\u5efa TaskSetManager"),(0,l.kt)("li",{parentName:"ul"},"\u5c06 TaskSetManager \u6dfb\u52a0\u81f3\u4efb\u52a1\u6c60 rootPool")),(0,l.kt)("p",null,"\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u5b58\u5728\u7740\u4e24\u4e2a\u6838\u5fc3\u89d2\u8272\uff1aTaskSetManager \u548c SchedulableBuilder\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"TaskSetManager")),(0,l.kt)("p",null,"TaskSetManager \u7531 TaskScheduler \u5c01\u88c5 TaskSet \u800c\u6765\uff0c\u662f TaskScheduler \u8fdb\u884c\u4efb\u52a1\u8c03\u5ea6\u7684\u57fa\u672c\u5355\u5143\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(3068).Z,width:"1402",height:"422"})),(0,l.kt)("p",null,"TaskSetManager \u8d1f\u8d23\u76d1\u63a7\u548c\u7ba1\u7406\u540c\u4e00\u4e2a Stage \u4e2d\u7684\u4efb\u52a1\u96c6\uff08\u5305\u62ec Executor \u8d44\u6e90\u7684\u5339\u914d\u3001\u4efb\u52a1\u6267\u884c\u7ed3\u679c\u7684\u5904\u7406\u7b49\uff09\uff0c\u540c\u65f6\u4e5f\u8d1f\u8d23\u7ba1\u7406\u672c\u5730\u5316\u8c03\u5ea6\u7ea7\u522b TaskLocality\u3002"),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u672c\u5730\u5316\u8c03\u5ea6\u662f\u201c\u79fb\u52a8\u8ba1\u7b97\u201d\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u662f\u5f71\u54cd Spark \u6027\u80fd\u7684\u5173\u952e\u90e8\u5206\uff0c\u6211\u4eec\u5c06\u5728\u542f\u52a8\u9636\u6bb5\u8fdb\u884c\u8be6\u7ec6\u4ecb\u7ecd\u3002")),(0,l.kt)("p",null,"TaskSetManager \u6709 3 \u4e2a\u6838\u5fc3\u65b9\u6cd5\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u65b9\u6cd5\u540d")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u529f\u80fd\u63cf\u8ff0")))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"resourceOffer"),"(",(0,l.kt)("em",{parentName:"td"},"execId"),", ",(0,l.kt)("em",{parentName:"td"},"host"),", ",(0,l.kt)("em",{parentName:"td"},"maxLocality"),", ",(0,l.kt)("em",{parentName:"td"},"taskResourceAssignments"),")"),(0,l.kt)("td",{parentName:"tr",align:null},"\u4e3a\u4e00\u4e2a\u4efb\u52a1\u5206\u914d\u4e00\u4e2a Executor \u8d44\u6e90\uff0c\u4ee5\u63cf\u8ff0\u7b26 TaskDescription \u8fd4\u56de\uff0c\u8be5\u63cf\u8ff0\u7b26\u5305\u542b\u4e86 Task\u3001Executor \u53ca\u4f9d\u8d56\u5305\u7b49\u4fe1\u606f")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"handleSuccessfulTask"),"(",(0,l.kt)("em",{parentName:"td"},"tid"),", ",(0,l.kt)("em",{parentName:"td"},"result"),")"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6807\u8bb0\u4efb\u52a1\u4e3a\u6210\u529f\u72b6\u6001\uff0c\u5e76\u901a\u77e5 DAGScheduler \u8be5\u4efb\u52a1\u5df2\u5b8c\u6210")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"handleFailedTask"),"(",(0,l.kt)("em",{parentName:"td"},"tid"),", ",(0,l.kt)("em",{parentName:"td"},"state"),", ",(0,l.kt)("em",{parentName:"td"},"reason"),")"),(0,l.kt)("td",{parentName:"tr",align:null},"\u6807\u8bb0\u4efb\u52a1\u4e3a\u5931\u8d25\u72b6\u6001\uff0c\u5e76\u91cd\u65b0\u52a0\u5165\u8c03\u5ea6\u961f\u5217")))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"SchedulableBuilder")),(0,l.kt)("p",null,"SchedulableBuilder \u8d1f\u8d23\u5c06 TaskSetManager \u6dfb\u52a0\u5230\u4efb\u52a1\u6c60 rootPool\uff0c\u5b83\u6709\u4e24\u79cd\u5b9e\u73b0\u7c7b\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"FIFOSchedulableBuilder\uff1a\u5bf9\u5e94 FIFO \u8c03\u5ea6\u7b56\u7565\uff0c\u4ee5\u5148\u8fdb\u5148\u51fa\u7684\u987a\u5e8f\u6dfb\u52a0 TaskSetManager"),(0,l.kt)("li",{parentName:"ul"},"FairSchedulableBuilder \uff1a\u5bf9\u5e94 Fair \u8c03\u5ea6\u7b56\u7565\uff0c\u53ef\u901a\u8fc7\u914d\u7f6e\u63a7\u5236\u5165\u961f\u4f18\u5148\u7ea7")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"Fair \u8c03\u5ea6\u7b56\u7565\u7684\u5b9e\u73b0\u65b9\u5f0f\u6bd4\u8f83\u7e41\u7410\uff0c\u6d89\u53ca\u5b50 Pool \u7684\u6784\u5efa\u4ee5\u53ca\u4f18\u5148\u7ea7\u7684\u6392\u5e8f\u7b49\uff0c\u672c\u6587\u4e0d\u5bf9\u6b64\u90e8\u5206\u5185\u5bb9\u5c55\u5f00\u4ecb\u7ecd\u3002")),(0,l.kt)("h3",{id:"\u542f\u52a8\u9636\u6bb5"},"\u542f\u52a8\u9636\u6bb5"),(0,l.kt)("p",null,"\u542f\u52a8\u9636\u6bb5\u6307\u4ece\u4efb\u52a1\u6c60 rootPool \u53d6\u51fa\u4efb\u52a1\u5e76\u53d1\u5e03\u5230 Executor \u7684\u8fc7\u7a0b\u3002"),(0,l.kt)("p",null,"\u76f8\u8f83\u4e8e\u63d0\u4ea4\u9636\u6bb5\uff0c\u542f\u52a8\u9636\u6bb5\u7684\u8c03\u5ea6\u903b\u8f91\u8981\u590d\u6742\u5f88\u591a\uff0c\u6d89\u53ca\u5230 ",(0,l.kt)("strong",{parentName:"p"},"RPC \u901a\u4fe1"),"\u3001",(0,l.kt)("strong",{parentName:"p"},"\u8d44\u6e90\u7684\u7b5b\u9009"),"\u3001",(0,l.kt)("strong",{parentName:"p"},"\u4efb\u52a1\u4e0e\u8d44\u6e90\u7684\u5339\u914d"),"\u3001",(0,l.kt)("strong",{parentName:"p"},"\u672c\u5730\u5316\u8c03\u5ea6")," \u7b49\u3002\u4ee5 Standalone \u6a21\u5f0f\u4e3a\u4f8b\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u53ef\u4ee5\u8868\u8ff0\u4e3a\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"StandaloneSchedulerBackend \u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"reviveOffers")," \u65b9\u6cd5\u5411 DriverEndPoint \u53d1\u8d77 ReviveOffers \u8bf7\u6c42"),(0,l.kt)("li",{parentName:"ol"},"DriverEndPoint \u63a5\u6536\u5230ReviveOffers \u8bf7\u6c42\uff0c\u89e6\u53d1 ",(0,l.kt)("inlineCode",{parentName:"li"},"makeOffers")," \u65b9\u6cd5\uff0c\u7b5b\u9009\u51fa\u6d3b\u8dc3\u7684 Executor \u8d44\u6e90\uff0c\u7136\u540e\u4ee5 Seq","[WorkerOffer]"," \u7684\u5f62\u5f0f\u53d1\u9001\u7ed9 TaskScheduler \u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"resourceOffers")," \u65b9\u6cd5"),(0,l.kt)("li",{parentName:"ol"},"TaskScheduler \u83b7\u53d6\u5230 Executor \u8d44\u6e90\u540e\uff0c\u4f1a\u5148\u884c\u8fc7\u6ee4\uff0c\u7136\u540e\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"Random.shuffle(offers)")," \u5c06 Executor \u8d44\u6e90\u968f\u673a\u6392\u5217\uff0c\u4ee5\u907f\u514d Task \u603b\u662f\u843d\u5230\u540c\u4e00\u4e2a Worker \u8282\u70b9"),(0,l.kt)("li",{parentName:"ol"},"\u6392\u5217\u597d\u8d44\u6e90\u540e\uff0cTaskScheduler \u4fbf\u4f1a\u4ece rootPool \u63d0\u53d6 TaskSetManager"),(0,l.kt)("li",{parentName:"ol"},"TaskSetManager \u6839\u636e TaskLocation\uff08\u7531 RDD \u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"preferredLocations")," \u65b9\u6cd5\u8ba1\u7b97\u800c\u6765\uff09\u521d\u59cb\u5316\u5f53\u524d\u4efb\u52a1\u96c6\u6240\u652f\u6301\u7684\u672c\u5730\u5316\u7ea7\u522b TaskLocality\uff0c\u5e76\u5c06\u4efb\u52a1\u6240\u671f\u671b\u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"executorId"),"\uff08Executor \u7684\u552f\u4e00\u6807\u8bc6\uff09\u53d1\u9001\u7ed9 PendingTasksByLocality"),(0,l.kt)("li",{parentName:"ol"},"TaskScheduler \u4ee5\u5f53\u524d\u652f\u6301\u7684\u6700\u5927\u672c\u5730\u5316\u7ea7\u522b\u5206\u914d Executor \u7ed9 Task"),(0,l.kt)("li",{parentName:"ol"},"\u82e5 Task \u5b58\u50a8\u5728 PendingTasksByLocality \u7684\u671f\u671b ",(0,l.kt)("inlineCode",{parentName:"li"},"executorId")," \u4e0e\u5206\u914d\u5230\u7684 Executor \u4e00\u81f4\uff0c\u5219\u8ba4\u4e3a\u5206\u914d\u6210\u529f\uff0c",(0,l.kt)("strong",{parentName:"li"},"\u5e76\u4ece PendingTasksByLocality \u4e2d\u79fb\u9664\u5df2\u914d\u5bf9\u6210\u529f\u7684 Task \u7684\u4e0b\u6807\uff0c\u4ee5\u907f\u514d\u91cd\u590d\u5206\u914d\u7684\u73b0\u8c61\u53d1\u751f")),(0,l.kt)("li",{parentName:"ol"},"\u82e5 Task \u5b58\u50a8\u5728 PendingTasksByLocality \u7684\u671f\u671b ",(0,l.kt)("inlineCode",{parentName:"li"},"executorId")," \u4e0e\u5206\u914d\u5230\u7684 Executor \u4e0d\u4e00\u81f4\uff0c\u5219\u8ba4\u4e3a\u5206\u914d\u5931\u8d25\uff0c\u6b64\u65f6\u9700\u8981\u964d\u4f4e\u5f53\u524d\u652f\u6301\u7684\u6700\u5927\u672c\u5730\u5316\u7ea7\u522b\uff0c\u5e76\u91cd\u65b0\u914d\u5bf9\uff0c\u76f4\u81f3\u914d\u5bf9\u6210\u529f"),(0,l.kt)("li",{parentName:"ol"},"\u5c06\u914d\u5bf9\u6210\u529f\u7684 Task \u4e0e Executor \u5c01\u88c5\u6210 TaskDescription \u5bf9\u8c61\uff0c\u8fd4\u56de\u7ed9 DriverEndPoint"),(0,l.kt)("li",{parentName:"ol"},"DriverEndPoint \u6839\u636e TaskDescription \u4e2d\u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"executorId")," \u4ece ",(0,l.kt)("inlineCode",{parentName:"li"},"executorDataMap")," \u53d6\u5f97 Executor \u7684\u901a\u4fe1\u5730\u5740\uff0c\u7136\u540e\u5c06\u5e8f\u5217\u5316\u540e\u7684 TaskDescription \u5bf9\u8c61\u53d1\u5e03\u7ed9 Executor\uff0c\u81f3\u6b64\u542f\u52a8\u9636\u6bb5\u7ed3\u675f")),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u82e5 Task \u7684 TaskLocation \u4e3a\u7a7a\uff0c\u5219 PendingTasksByLocality \u4f1a\u4ee5\u6570\u7ec4 ",(0,l.kt)("inlineCode",{parentName:"p"},"val noPrefs = new ArrayBuffer[Int]")," \u5b58\u50a8 Task \u7684\u4e0b\u6807\uff0c\u5e76\u9ed8\u8ba4\u4ee5 ",(0,l.kt)("inlineCode",{parentName:"p"},"PROCESS_LOCAL")," \u7ea7\u522b\u53bb\u5339\u914d Executor \u8d44\u6e90\u3002")),(0,l.kt)("hr",null),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"\u77e5\u8bc6\u6269\u5c55\uff1aExecutor \u7533\u8bf7\u6210\u529f\u7684\u65f6\u95f4\u665a\u4e8e ",(0,l.kt)("inlineCode",{parentName:"em"},"reviveOffers")," \u89e6\u53d1\u7684\u65f6\u95f4\uff0c\u4efb\u52a1\u4f1a\u53d1\u5e03\u5931\u8d25\u5417\uff1f"))),(0,l.kt)("p",null,"\u5728\u4e0a\u8ff0 ",(0,l.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 1 "),"\u548c ",(0,l.kt)("strong",{parentName:"p"},"\u6b65\u9aa4 2")," \u4e2d\uff0cExecutor \u53ef\u80fd\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"reviveOffers")," \u89e6\u53d1\u65f6\u8fd8\u6765\u4e0d\u53ca\u542f\u52a8\uff0c\u6b64\u65f6\u4f1a\u8fd4\u56de\u7a7a\u7684 WorkerOffer \u961f\u5217\u7ed9 TaskScheduler\u3002\u82e5\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff0c\u4efb\u52a1\u96be\u9053\u5c31\u76f4\u63a5\u5931\u8d25\u4e86\u5417\uff1f"),(0,l.kt)("p",null,"\u6211\u4eec\u5148\u6765\u770b\u770b DriverEndpoint \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"onStart")," \u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},"override def onStart(): Unit = {\n  // Periodically revive offers to allow delay scheduling to work\n  val reviveIntervalMs = conf.get(SCHEDULER_REVIVE_INTERVAL).getOrElse(1000L)\n\n  reviveThread.scheduleAtFixedRate(() => Utils.tryLogNonFatalError {\n    Option(self).foreach(_.send(ReviveOffers))\n  }, 0, reviveIntervalMs, TimeUnit.MILLISECONDS)\n}\n")),(0,l.kt)("p",null,"\u8be5\u65b9\u6cd5\u4f1a\u542f\u52a8\u4e00\u4e2a\u5b9a\u65f6\u5668\u7ebf\u7a0b\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6bcf\u9694 ",(0,l.kt)("inlineCode",{parentName:"p"},"1s")," \u4f1a\u5411 DriverEndPoint \u53d1\u8d77 1 \u4e2a ReviveOffers \u8bf7\u6c42\u3002"),(0,l.kt)("p",null,"\u770b\u5230\u8fd9\u91cc\uff0c\u60f3\u5fc5\u5927\u5bb6\u90fd\u5df2\u7ecf\u77e5\u9053\u7b54\u6848\u4e86\u3002",(0,l.kt)("strong",{parentName:"p"},"\u5373\u4fbfSchedulerBackend \u7684 ",(0,l.kt)("inlineCode",{parentName:"strong"},"reviveOffers")," \u89e6\u53d1\u65f6 Executor \u8fd8\u672a\u542f\u52a8\u6210\u529f\uff0c\u4e5f\u4e0d\u5f71\u54cd\u540e\u7eed\u4efb\u52a1\u7684\u53d1\u5e03\u3002")," \u56e0\u4e3a\u5b9a\u65f6\u5668\u7ebf\u7a0b\u7684\u5faa\u73af\u89e6\u53d1\u610f\u5473\u7740 TaskScheduler \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOffers")," \u65b9\u6cd5\u4f1a\u88ab\u5faa\u73af\u8c03\u7528\uff0c\u8fd9\u6837\u5728\u540e\u7eed Executor \u542f\u52a8\u6210\u529f\u540e\u5b83\u4e00\u5b9a\u6709\u673a\u4f1a\u83b7\u53d6\u5c01\u88c5\u4e86 Executor \u8d44\u6e90\u7684 WorkerOffer \u961f\u5217\u4ee5\u53d1\u5e03\u4efb\u52a1\u6c60\u4e2d\u7684 Task\u3002"),(0,l.kt)("hr",null),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"\u77e5\u8bc6\u6269\u5c55\uff1aExecutor \u662f\u4e00\u6b21\u6027\u5206\u914d\u7ed9\u6240\u6709 Task \u8fd8\u662f\u6839\u636e\u8d44\u6e90\u6570\u9010\u4e00\u5206\u914d\uff1f"))),(0,l.kt)("p",null,"\u4ece TaskScheduler \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOffers")," \u65b9\u6cd5\u4e2d\uff0c\u6211\u4eec\u622a\u53d6\u4e86\u4ee5\u4e0b\u4ee3\u7801\u7247\u6bb5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},"for (taskSet <- sortedTaskSets) {\n  \n  // ...\n  \n  // \u904d\u5386\u5f53\u524d\u652f\u6301\u7684\u672c\u5730\u5316\u8c03\u5ea6\u7ea7\u522b\n  for (currentMaxLocality <- taskSet.myLocalityLevels) {\n    // \u662f\u5426\u80fd\u5728\u5f53\u524d\u7684\u672c\u5730\u5316\u8c03\u5ea6\u7ea7\u522b\u4e0b\u6210\u529f\u5206\u914d Executor \u5e76\u542f\u52a8\u4efb\u52a1\n    var launchedTaskAtCurrentMaxLocality = false\n    do {\n      // \u5206\u914d Executor \u8d44\u6e90\u7ed9 TaskSet\n      val (noDelayScheduleReject, minLocality) = resourceOfferSingleTaskSet(\n        taskSet, currentMaxLocality, shuffledOffers, availableCpus,\n        availableResources, tasks, addressesWithDescs)\n      // \u82e5 minLocality \u4e3a\u7a7a\uff0c\u8bf4\u660e\u5206\u914d\u5931\u8d25\n      launchedTaskAtCurrentMaxLocality = minLocality.isDefined\n      launchedAnyTask |= launchedTaskAtCurrentMaxLocality\n      noDelaySchedulingRejects &= noDelayScheduleReject\n      globalMinLocality = minTaskLocality(globalMinLocality, minLocality)\n    } while (launchedTaskAtCurrentMaxLocality)\n  }\n  \n  // ...\n}\n")),(0,l.kt)("p",null,"\u4e4d\u770b\u4e4b\u4e0b\uff0c\u4f1a\u4ee5\u4e3a\u662f\u4e00\u6b21\u6027\u4e3a TaskSet \u4e2d\u7684\u6240\u6709\u4efb\u52a1\u5206\u914d Executor\uff0c\u5b9e\u9645\u4e0a\u5e76\u975e\u5982\u6b64\uff0c\u4e14\u770b ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOfferSingleTaskSet")," \u4e2d\u7684\u6838\u5fc3\u4ee3\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},"// \u904d\u5386 Executor \u8d44\u6e90\nfor (i <- 0 until shuffledOffers.size) {\n  val execId = shuffledOffers(i).executorId\n  val host = shuffledOffers(i).host\n  val taskSetRpID = taskSet.taskSet.resourceProfileId\n  if (taskSetRpID == shuffledOffers(i).resourceProfileId) {\n    // \u662f\u5426\u6709\u591a\u4f59\u7684 CPU \u8d44\u6e90\uff0c\u82e5\u6ca1\u6709\uff0c\u8df3\u8fc7\n    val taskResAssignmentsOpt = resourcesMeetTaskRequirements(taskSet, availableCpus(i), availableResources(i))\n    taskResAssignmentsOpt.foreach { taskResAssignments =>\n      try {\n        // ...\n        \n        // \u5206\u914d Executor \u7ed9\u67d0\u4e2a Task\uff0c\u82e5 Executor \u4e0e Task \u7684\u9884\u671f Executor \u4e0d\u5339\u914d\uff0c\u5219\u8fd4\u56de\u7a7a\n        val (taskDescOption, didReject) = taskSet.resourceOffer(execId, host, maxLocality, taskResAssignments)\n        \n        // ...\n      }\n    }\n  }\n}\n\n")),(0,l.kt)("p",null,"\u7b80\u5355\u9605\u8bfb\u540e\u53d1\u73b0\uff0c\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOfferSingleTaskSet")," \u4e2d\uff0c\u662f\u6839\u636e Executor \u7684\u6570\u91cf\u53ca\u5176\u7a7a\u95f2 CPU \u6570\u6765\u8fdb\u884c\u8d44\u6e90\u914d\u5bf9\u7684\u3002\u5047\u8bbe TaskSet \u4e2d\u6709 3 \u4e2a Task\uff0cExecutor \u6570\u4e3a 1 \u4e14\u53ef\u7528 CPU \u6838\u6570\u4e3a 1\uff0c\u90a3\u4e48 ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOfferSingleTaskSet"),"  \u53ea\u4f1a\u5206\u914d Executor \u7ed9 ",(0,l.kt)("inlineCode",{parentName:"p"},"tasks(0)"),"\uff0c\u5373 TaskSet \u4e2d\u7684\u7b2c\u4e00\u4e2a Task\u3002\u5206\u914d\u540e\uff0c\u7531\u4e8e\u6ca1\u6709\u53ef\u7528\u7684 CPU \u8d44\u6e90\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"resourcesMeetTaskRequirements")," \u65b9\u6cd5\u4f1a\u8fd4\u56de\u7a7a\uff0c\u4f7f\u5f97 ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOfferSingleTaskSet")," \u8fd4\u56de\u7a7a\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"minLocality")," \uff0c\u9020\u6210\u5faa\u73af\u8df3\u51fa\uff0c\u6700\u7ec8\u5bfc\u81f4\u5269\u4f59\u7684 2 \u4e2a Task \u5728\u672c\u6b21 ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOffers")," \u8c03\u5ea6\u4e2d\u4e0d\u4f1a\u5206\u914d\u5230 Executor\u3002"),(0,l.kt)("p",null,"\u770b\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u4e0d\u7981\u4ea7\u751f\u7591\u95ee\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOffers")," \u8c03\u7528\u7684 ",(0,l.kt)("strong",{parentName:"p"},"\u6e90\u5934\u4e4b\u4e00")," \u662f SchedulerBackend \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"reviveOffers()")," \u65b9\u6cd5\uff0c\u4e14\u8be5\u65b9\u6cd5\u53ea\u5728\u63d0\u4ea4\u9636\u6bb5\u7531 ",(0,l.kt)("inlineCode",{parentName:"p"},"sumbitTasks")," \u89e6\u53d1\u4e00\u6b21\uff0c\u90a3\u4e48\u5269\u4e0b\u7684 2 \u4e2a Task \u8981\u600e\u4e48\u53bb\u5339\u914d Executor \u8d44\u6e90\uff1f"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u5b9e\u9645\u4e0a\uff0cDriverEndPoint \u7684 ",(0,l.kt)("inlineCode",{parentName:"strong"},"receive")," \u65b9\u6cd5\u4e0d\u4ec5\u4ec5\u662f\u5728\u63a5\u6536\u5230 ReviveOffers \u8bf7\u6c42\u65f6\u4f1a\u89e6\u53d1 ",(0,l.kt)("inlineCode",{parentName:"strong"},"resourceOffers"),"\uff0c\u5728\u63a5\u6536\u5230 StatusUpdate \u4e5f\u53ef\u4ee5\u3002")," \u8fd9\u53e5\u8bdd\u7528\u4e00\u79cd\u66f4\u76f4\u89c2\u7684\u65b9\u5f0f\u8868\u8ff0\u5c31\u662f\uff0c\u5f53 Executor \u8d44\u6e90\u4e0d\u8db3\u65f6\uff0c\u4f1a\u5148\u5206\u914d\u7ed9\u5e8f\u53f7\u9760\u524d\u7684 Task\uff0c\u5f53\u8fd9\u4e9b Task \u5b8c\u6210\u540e\uff0c\u4f1a\u91ca\u653e\u5360\u7528\u7684 Executor \u6838\u6570\uff0c\u5e76\u5728\u901a\u77e5 DriverEndPoint \u4efb\u52a1\u5b8c\u6210\u7684\u540c\u65f6\u89e6\u53d1 ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOffers"),"\uff0c\u4f7f\u540e\u9762\u7684 Task \u53ef\u4ee5\u4eab\u7528\u5df2\u7ecf\u7a7a\u95f2\u7684 Executor\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a"),(0,l.kt)("p",null,(0,l.kt)("img",{src:a(3272).Z,width:"1843",height:"863"})),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u7531\u4e8e\u4e0a\u8ff0\u5b9a\u65f6\u5668\u7ebf\u7a0b\u7684\u5b58\u5728\uff0c\u5373\u4fbf DriverEndPoint \u5728\u63a5\u6536\u5230 StatusUpdate \u540e\u4e0d\u518d\u89e6\u53d1 ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOffers"),"\uff0c\u5269\u4f59\u7684\u4efb\u52a1\u4e5f\u4f9d\u65e7\u53ef\u4ee5\u53d1\u5e03\u51fa\u53bb\u3002\u81f3\u4e8e\u4e3a\u4ec0\u4e48 TaskScheduler \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOffers")," \u65b9\u6cd5\u4f1a\u5b58\u5728\u8fd9\u79cd\u91cd\u590d\u8c03\u7528\u7684\u60c5\u51b5\uff0c\u7b14\u8005\u731c\u6d4b\u662f\u4e3a\u4e86\u517c\u5bb9\u4e0d\u540c\u7684\u96c6\u7fa4\u90e8\u7f72\u6a21\u5f0f\u3002")),(0,l.kt)("hr",null),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"\u77e5\u8bc6\u6269\u5c55\uff1a\u672c\u5730\u5316\u8c03\u5ea6\u662f\u4ec0\u4e48\uff1f\u652f\u6301\u54ea\u4e9b\u7ea7\u522b\uff1f"))),(0,l.kt)("p",null,"\u201c\u79fb\u52a8\u8ba1\u7b97\u201d\uff0c\u5373\u5c06\u8ba1\u7b97\u4efb\u52a1\u79fb\u52a8\u5230\u6570\u636e\u6240\u5728\u8282\u70b9\uff0c\u662f\u5927\u6570\u636e\u8ba1\u7b97\u4e2d\u63d0\u5347\u6027\u80fd\u7684\u4e00\u79cd\u624b\u6bb5\u3002Spark \u4e2d\u7684\u672c\u5730\u5316\u8c03\u5ea6\u673a\u5236\uff0c\u5c31\u662f\u201c\u79fb\u52a8\u8ba1\u7b97\u201d\u7684\u5b9e\u73b0\u65b9\u6848\u3002"),(0,l.kt)("p",null,"\u4ece RDD \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"preferredLocations")," \u65b9\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u83b7\u5f97 Seq","[TaskLocation]","\uff0c\u5b83\u8868\u793a RDD \u5206\u533a\u6240\u5bf9\u5e94\u8ba1\u7b97\u4efb\u52a1\u5e94\u8be5\u6267\u884c\u7684\u4f4d\u7f6e\u3002\u7531\u4e8e TaskLocation \u6709\u591a\u79cd\u5b9e\u73b0\u7c7b\uff0c\u5176\u6307\u5411\u7684\u4f4d\u7f6e\u4e5f\u6709\u591a\u79cd\uff0c\u53ef\u80fd\u662f\u5728 ",(0,l.kt)("strong",{parentName:"p"},"\u5185\u5b58"),"\uff0c\u53ef\u80fd\u662f\u5728 ",(0,l.kt)("strong",{parentName:"p"},"\u78c1\u76d8"),"\uff0c\u4e5f\u53ef\u80fd\u662f\u5728 ",(0,l.kt)("strong",{parentName:"p"},"\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf")," \u4e2d\u3002\u5982\u679c\u662f\u5728\u5185\u5b58\uff0c\u6211\u4eec\u5e0c\u671b Task \u53d1\u5f80\u5185\u5b58\u4e2d\u542b\u6709\u8fd9\u4e2a\u6570\u636e\u7684 Executor\uff1b\u5982\u679c\u662f\u5728\u78c1\u76d8\uff0c\u6211\u4eec\u5e0c\u671b Task \u53d1\u5f80\u5b58\u50a8\u7740\u6570\u636e\u7684\u670d\u52a1\u5668\u8282\u70b9\u3002"),(0,l.kt)("p",null,"\u6839\u636e\u8fd9\u4e2a\u76ee\u6807\uff0cSpark \u652f\u6301\u4e86 5 \u79cd\u7ea7\u522b\u7684\u672c\u5730\u5316\u8c03\u5ea6\u65b9\u5f0f\uff0c\u6309\u4f18\u5148\u7ea7\u7531\u9ad8\u5230\u4f4e\u6392\u5e8f\u4f9d\u6b21\u4e3a\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u7ea7\u522b")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u542b\u4e49")))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"PROCESS_LOCAL"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8fdb\u7a0b\u672c\u5730\u5316\uff0cTask \u548c\u6570\u636e\u5728\u540c\u4e00\u4e2a Executor \u4e2d\uff0c\u6027\u80fd\u6700\u597d")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"NODE_LOCAL"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8282\u70b9\u672c\u5730\u5316\uff0cTask \u548c\u6570\u636e\u5728\u540c\u4e00\u4e2a\u8282\u70b9\u4f46\u662f\u4e0d\u5728\u540c\u4e00\u4e2a Executor\uff0c\u6570\u636e\u9700\u8981\u5728\u8fdb\u7a0b\u95f4\u8fdb\u884c\u4f20\u8f93")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"NO_PREF"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5bf9\u4e8e Task \u6765\u8bf4\uff0c\u4ece\u54ea\u91cc\u83b7\u53d6\u90fd\u4e00\u6837\uff0c\u6ca1\u6709\u597d\u574f\u4e4b\u5206")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"RACK_LOCAL"),(0,l.kt)("td",{parentName:"tr",align:null},"\u673a\u67b6\u672c\u5730\u5316\uff0cTask \u548c\u6570\u636e\u5728\u540c\u4e00\u4e2a\u673a\u67b6\u7684\u4e24\u4e2a\u8282\u70b9\u4e0a\uff0c\u6570\u636e\u9700\u8981\u901a\u8fc7\u7f51\u7edc\u5728\u8282\u70b9\u4e4b\u95f4\u8fdb\u884c\u4f20\u8f93")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ANY"),(0,l.kt)("td",{parentName:"tr",align:null},"Task \u548c\u6570\u636e\u53ef\u4ee5\u5728\u96c6\u7fa4\u7684\u4efb\u4f55\u5730\u65b9\uff0c\u751a\u81f3\u4e0d\u5728\u4e00\u4e2a\u673a\u67b6\u4e2d\uff0c\u6027\u80fd\u6700\u5dee")))),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u672c\u5730\u5316\u8c03\u5ea6\u7ea7\u522b\u6309\u679a\u4e3e\u503c\u4ece\u9ad8\u5230\u4f4e\u6392\u5e8f\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"ANY")," \u2192 ",(0,l.kt)("inlineCode",{parentName:"p"},"RACK_LOCAL")," \u2192 ",(0,l.kt)("inlineCode",{parentName:"p"},"NO_PREF")," \u2192 ",(0,l.kt)("inlineCode",{parentName:"p"},"NODE_LOCAL")," \u2192 ",(0,l.kt)("inlineCode",{parentName:"p"},"PROCESS_LOCAL"),"\u3002")),(0,l.kt)("hr",null),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"\u77e5\u8bc6\u6269\u5c55\uff1a\u672c\u5730\u5316\u8c03\u5ea6\u662f\u600e\u4e48\u201c\u79fb\u52a8\u8ba1\u7b97\u201d\u7684\uff1f\u8c03\u5ea6\u5931\u8d25\u4f1a\u5982\u4f55\uff1f"))),(0,l.kt)("p",null,"\u201c\u79fb\u52a8\u8ba1\u7b97\u201d\u7684\u672c\u8d28\u662f\uff0c\u5df2\u77e5\u6570\u636e\u7684\u4f4d\u7f6e\uff0c\u5c06\u8ba1\u7b97\u4efb\u52a1\u79fb\u52a8\u81f3\u6570\u636e\u6240\u5728\u4f4d\u7f6e\u3002\u4e3a\u5b9e\u73b0\u8fd9\u4e2a\u76ee\u7684\uff0c\u672c\u5730\u5316\u8c03\u5ea6\u505a\u4e86\u4e24\u4ef6\u4e8b\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316 PendingTasksByLocality\uff0c\u8bb0\u5f55\u6bcf\u4e2a Task \u6240\u671f\u671b\u7684 Executor \u96c6\u5408"),(0,l.kt)("li",{parentName:"ul"},"\u6bd4\u5bf9 SchedulerBackend \u6240\u6301\u6709\u7684\u771f\u5b9e\u7684 Executor \u8d44\u6e90\uff0c\u82e5\u4e0e\u9884\u671f\u76f8\u7b26\uff0c\u5219\u5b8c\u6210\u5339\u914d\uff0c\u5426\u5219\u964d\u7ea7\u8c03\u5ea6")),(0,l.kt)("p",null,"\u5f53 TaskSetManager \u521b\u5efa\u65f6\uff0c\u4f1a\u521d\u59cb\u5316 PendingTasksByLocality\u3002PendingTasksByLocality \u4e2d\u542b\u6709 3 \u4e2a\u6838\u5fc3\u53d8\u91cf\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u53d8\u91cf\u540d\u79f0")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u542b\u4e49")))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"forExecutor"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5b58\u50a8\u6240\u6709\u4efb\u52a1\u671f\u671b\u7684\u7b26\u5408 PROCESS_LOCAL \u7ea7\u522b\u7684 ",(0,l.kt)("inlineCode",{parentName:"td"},"executorId"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"forHost"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5b58\u50a8\u6240\u6709\u4efb\u52a1\u671f\u671b\u7684\u7b26\u5408 NODE_LOCAL \u7ea7\u522b\u7684 ",(0,l.kt)("inlineCode",{parentName:"td"},"executorId"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"noPrefs"),(0,l.kt)("td",{parentName:"tr",align:null},"\u5b58\u50a8\u6240\u6709\u4efb\u52a1\u671f\u671b\u7684\u7b26\u5408 RACK_LOCAL \u7ea7\u522b\u7684 ",(0,l.kt)("inlineCode",{parentName:"td"},"executorId"))))),(0,l.kt)("p",null,"\u5176\u4e2d\uff0c\u5404\u53d8\u91cf\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\u53ef\u89c1\u6e90\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},'// \u904d\u5386 Seq[TaskLocation]\nfor (loc <- tasks(index).preferredLocations) {\n  // \u521d\u59cb\u5316 PROCESS_LOCAL \u7ea7\u522b\u7684 Executor \u96c6\u5408\n  loc match {\n    case e: ExecutorCacheTaskLocation =>\n      pendingTaskSetToAddTo.forExecutor.getOrElseUpdate(e.executorId, new ArrayBuffer) += index\n    case e: HDFSCacheTaskLocation =>\n      val exe = sched.getExecutorsAliveOnHost(loc.host)\n      exe match {\n        case Some(set) =>\n          for (e <- set) {\n            pendingTaskSetToAddTo.forExecutor.getOrElseUpdate(e, new ArrayBuffer) += index\n          }\n          logInfo(s"Pending task $index has a cached location at ${e.host} " +\n            ", where there are executors " + set.mkString(","))\n        case None => logDebug(s"Pending task $index has a cached location at ${e.host} " +\n          ", but there are no executors alive there.")\n      }\n    case _ =>\n  }\n  // \u521d\u59cb\u5316 NODE_LOCAL \u7ea7\u522b\u7684 Executor \u96c6\u5408\n  pendingTaskSetToAddTo.forHost.getOrElseUpdate(loc.host, new ArrayBuffer) += index\n\n  // \u521d\u59cb\u5316 RACK_LOCAL \u7ea7\u522b\u7684 Executor \u96c6\u5408\n  if (resolveRacks) {\n    sched.getRackForHost(loc.host).foreach { rack =>\n      pendingTaskSetToAddTo.forRack.getOrElseUpdate(rack, new ArrayBuffer) += index\n    }\n  }\n}\n\nif (tasks(index).preferredLocations == Nil) {\n  pendingTaskSetToAddTo.noPrefs += index\n}\n\npendingTaskSetToAddTo.all += index\n')),(0,l.kt)("p",null,"\u5f53 TaskScheduler \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOfferSingleTaskSet")," \u65b9\u6cd5\u4f9b\u7ed9 Executor \u8d44\u6e90\u65f6\uff0cTaskSetManager \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"resourceOffer")," \u65b9\u6cd5\u4f1a\u901a\u8fc7\u8c03\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"dequeueTaskHelper")," \u786e\u8ba4\u671f\u671b\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"executorId")," \u662f\u5426\u4e0e\u4f9b\u7ed9\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"executorId")," \u5339\u914d\uff0c\u82e5\u8ba4\u4e3a\u914d\u5bf9\u6210\u529f\uff0c\u4fbf\u8fd4\u56de TaskDescription \u5bf9\u8c61\uff0c\u5426\u5219\u91cd\u65b0\u5339\u914d\u3002\u5176\u6e90\u7801\u7684\u6838\u5fc3\u5185\u5bb9\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},"// forExecutor \u4e2d\u7684\u8d44\u6e90\u662f\u5426\u6709\u4e0e execId \u76f8\u5339\u914d\u7684\u8d44\u6e90\uff0c\u82e5\u6709\uff0c\u76f4\u63a5\u8fd4\u56de\ndequeue(pendingTaskSetToUse.forExecutor.getOrElse(execId, ArrayBuffer())).foreach { index =>\n  return Some((index, TaskLocality.PROCESS_LOCAL, speculative))\n}\n\n// \u5f53\u524d\u652f\u6301\u7684\u6700\u5927\u8c03\u5ea6\u7ea7\u522b\u7684\u679a\u4e3e\u503c\u662f\u5426\u5927\u4e8e NODE_LOCAL\n// maxLocality = NODE_LOCAL/NO_PREF/RACK_LOCAL/ANY \u65f6\u89e6\u53d1\nif (TaskLocality.isAllowed(maxLocality, TaskLocality.NODE_LOCAL)) {\n  // forHost \u4e2d\u7684\u8d44\u6e90\u662f\u5426\u6709\u4e0e execId \u76f8\u5339\u914d\u7684\u8d44\u6e90\uff0c\u82e5\u6709\uff0c\u76f4\u63a5\u8fd4\u56de\n  dequeue(pendingTaskSetToUse.forHost.getOrElse(host, ArrayBuffer())).foreach { index =>\n    return Some((index, TaskLocality.NODE_LOCAL, speculative))\n  }\n}\n\n// maxLocality = NO_PREF/RACK_LOCAL/ANY \u65f6\u89e6\u53d1\nif (TaskLocality.isAllowed(maxLocality, TaskLocality.NO_PREF)) {\n  dequeue(pendingTaskSetToUse.noPrefs).foreach { index =>\n    return Some((index, TaskLocality.PROCESS_LOCAL, speculative))\n  }\n}\n\n// maxLocality = RACK_LOCAL/ANY \u65f6\u89e6\u53d1\nif (TaskLocality.isAllowed(maxLocality, TaskLocality.RACK_LOCAL)) {\n  for {\n    rack <- sched.getRackForHost(host)\n    index <- dequeue(pendingTaskSetToUse.forRack.getOrElse(rack, ArrayBuffer()))\n  } {\n    return Some((index, TaskLocality.RACK_LOCAL, speculative))\n  }\n}\n\n// maxLocality = ANY \u65f6\u89e6\u53d1\nif (TaskLocality.isAllowed(maxLocality, TaskLocality.ANY)) {\n  dequeue(pendingTaskSetToUse.all).foreach { index =>\n    return Some((index, TaskLocality.ANY, speculative))\n  }\n}\nNone\n")),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"PendingTasksByLocality \u4e2d\u7684\u9884\u671f\u8d44\u6e90\u5728\u5339\u914d\u6210\u529f\u540e\u4f1a\u88ab\u79fb\u9664\uff0c\u4ee5\u907f\u514d\u53ef\u7528\u8d44\u6e90\u5145\u8db3\u7684\u60c5\u51b5\u4e0b\u53d1\u751f\u91cd\u590d\u5206\u914d\uff0c\u5177\u4f53\u53ef\u53c2\u8003 ",(0,l.kt)("inlineCode",{parentName:"p"},"dequeueTaskFromList")," \u65b9\u6cd5\u3002")),(0,l.kt)("p",null,"\u5f53\u7136\uff0c\u68a6\u60f3\u4e0d\u53ef\u80fd\u603b\u6210\u4e3a\u73b0\u5b9e\uff0c\u6709\u65f6\u5019\u671f\u671b\u7684 Executor \u8d44\u6e90\u65e0\u6cd5\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"spark.locality.wait")," \u6307\u5b9a\u7684\u65f6\u95f4\u8303\u56f4\u5185\u53ca\u65f6\u83b7\u53d6\uff0c\u6b64\u65f6\u4f1a\u89e6\u53d1\u672c\u5730\u5316\u8c03\u5ea6\u7ea7\u522b\u7684\u964d\u7ea7\u8fc7\u7a0b\uff1a",(0,l.kt)("strong",{parentName:"p"},"\u4ecd\u7136\u5c1d\u8bd5\u4ee5\u5f53\u524d\u672c\u5730\u5316\u8c03\u5ea6\u7ea7\u522b\u53d1\u5e03\u4efb\u52a1\uff0c\u82e5\u4f9d\u65e7\u5931\u8d25\uff0c\u5219\u964d\u4f4e\u7ea7\u522b\uff0c\u5c1d\u8bd5\u5c06\u671f\u671b\u7ea7\u522b\u8f83\u4f4e\u7684 Executor \u8d44\u6e90\u63d0\u4f9b\u7ed9 Task\uff0c\u76f4\u81f3\u6210\u529f\u3002")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u5982\u679c\u53d1\u73b0\u5927\u91cf\u8ba1\u7b97\u4efb\u52a1\u7684\u672c\u5730\u5316\u8c03\u5ea6\u7ea7\u522b\u8de8\u8282\u70b9\u751a\u81f3\u662f\u8de8\u673a\u67b6\uff0c\u53ef\u4ee5\u8003\u8651\u589e\u52a0 ",(0,l.kt)("inlineCode",{parentName:"p"},"spark.locality.wait")," \u7684\u503c\uff0c\u4ee5\u9002\u5f53\u63d0\u9ad8\u672c\u5730\u5316\u8c03\u5ea6\u7684\u7b49\u5f85\u65f6\u95f4\u3002\u4f46\u662f\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u503c ",(0,l.kt)("inlineCode",{parentName:"p"},"3s")," \u662f\u53ef\u4ee5\u6709\u6548\u8fd0\u4f5c\u7684\u3002")),(0,l.kt)("h3",{id:"\u6267\u884c\u9636\u6bb5"},"\u6267\u884c\u9636\u6bb5"),(0,l.kt)("p",null,"\u6267\u884c\u9636\u6bb5\u7531 Executor \u8d1f\u8d23\u3002"),(0,l.kt)("p",null,"\u5728 Standalone \u6a21\u5f0f\u4e0b\uff0cExecutor \u7531\u72ec\u7acb\u7684 JVM \u8fdb\u7a0b CoarseGrainedExecutorBackend \u521b\u5efa\u3002"),(0,l.kt)("p",null,"Executor \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"launchTask")," \u65b9\u6cd5\u4f1a\u542f\u52a8\u6267\u884c\u9636\u6bb5\uff0c\u5b83\u4f1a\u5c06 TaskDescription \u5c01\u88c5\u6210 TaskRunner\uff0c\u7136\u540e\u4ea4\u7531\u7ebf\u7a0b\u6c60\u6267\u884c\u3002\u5f53 TaskRunner \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"run")," \u65b9\u6cd5\u88ab\u7ebf\u7a0b\u6c60\u8c03\u5ea6\u540e\uff0c\u4e00\u4e2a\u8ba1\u7b97\u4efb\u52a1\u7684\u6267\u884c\u5c31\u6b63\u5f0f\u5f00\u59cb\u4e86\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"STEP 01\uff1a\u4f9d\u8d56\u5305\u4e0b\u8f7d")),(0,l.kt)("p",null,"Driver \u7aef\u5728\u53d1\u5e03\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u6240\u9700\u7684\u4f9d\u8d56\u4fe1\u606f\u6ce8\u5165\u5230 TaskDescription \u5bf9\u8c61\u4e2d\u3002\u5728 Executor \u6267\u884c\u8ba1\u7b97\u4e4b\u524d\uff0c\u9700\u8981\u5148\u8c03\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"updateDependencies")," \u65b9\u6cd5\u4e0b\u8f7d\u6240\u9700\u4f9d\u8d56\u5305\uff0c\u5e76\u5c06\u5176\u6dfb\u52a0\u81f3 ClassLoader \u4e2d\uff0c\u4ee5\u786e\u4fdd Executor \u5b8c\u5168\u5177\u5907\u6267\u884c Task \u7684\u80fd\u529b\uff0c\u5173\u952e\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},"// Fetch file with useCache mode, close cache for local mode.\nUtils.fetchFile(name, new File(SparkFiles.getRootDirectory()), conf, env.securityManager, \n  hadoopConf, timestamp, useCache = !isLocal)\n\n// ...\n\n// Add it to our class loader\nval url = new File(SparkFiles.getRootDirectory(), localName).toURI.toURL\nif (!urlClassLoader.getURLs().contains(url)) {\n  urlClassLoader.addURL(url)\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"STEP 02\uff1a\u6267\u884c\u8ba1\u7b97")),(0,l.kt)("p",null,"\u4e0b\u8f7d\u5b8c\u4f9d\u8d56\u540e\uff0cExecutor \u4f1a\u5c06 TaskDescription \u4e2d\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"serializedTask")," \u53cd\u5e8f\u5217\u5316\u4e3a Task \u5bf9\u8c61\uff0c\u7136\u540e\u901a\u8fc7 Task \u5bf9\u8c61\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"runTask")," \u65b9\u6cd5\u6267\u884c\u8ba1\u7b97\u3002",(0,l.kt)("inlineCode",{parentName:"p"},"runTask")," \u65b9\u6cd5\u662f\u62bd\u8c61\u7c7b\uff0c\u9700\u8981\u5b50\u7c7b\u8d1f\u8d23\u5b9e\u73b0\uff0c\u6240\u4ee5\u771f\u5b9e\u7684\u8ba1\u7b97\u903b\u8f91\u7531 Task \u7684\u5b50\u7c7b\u51b3\u5b9a\u3002"),(0,l.kt)("p",null,"\u5728 Spark \u4e2d\uff0cTask \u7684\u5b50\u7c7b\u6709 ShuffleMapTask \u548c ResultTask \u4e24\u79cd\u3002\u524d\u8005\u8868\u793a ShuffleMapStage \u4e2d\u7684\u4efb\u52a1\uff1b\u540e\u8005\u8868\u793a\u6700\u7ec8\u54cd\u5e94\u6570\u636e\u7ed9 Application \u7684\u4efb\u52a1\u3002"),(0,l.kt)("p",null,"\u82e5 Task \u4e3a ShuffleMapTask\uff0c\u5219 ",(0,l.kt)("inlineCode",{parentName:"p"},"runTask")," \u4e3b\u8981\u505a\u7684\u4e8b\u60c5\u4e3a\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u53cd\u5e8f\u5217\u5316\u5b57\u8282\u6570\u7ec4 ",(0,l.kt)("inlineCode",{parentName:"li"},"taskBinary"),"\uff0c\u83b7\u5f97 RDD \u548c ShuffleDependency \u5b9e\u4f8b"),(0,l.kt)("li",{parentName:"ul"},"\u4ece SparkEnv \u4e2d\u83b7\u53d6 ShuffleManager\uff0c\u5e76\u901a\u8fc7 ShuffleManager \u83b7\u53d6 ShuffleWriter \u5b9e\u4f8b"),(0,l.kt)("li",{parentName:"ul"},"\u8c03\u7528 RDD \u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"iterator")," \u65b9\u6cd5\u6267\u884c\u8ba1\u7b97\uff0c\u5e76\u4f7f\u7528 ShuffleWriter \u5c06\u8ba1\u7b97\u7ed3\u679c\u5199\u5165\u5230 Executor \u7aef\u7684\u5b58\u50a8\u7cfb\u7edf"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u8fd4\u56de MapStatus \u5bf9\u8c61"),"\uff0c\u8be5\u5bf9\u8c61\u5305\u542b\u4e86 Executor \u7aef\u7684 BlockManager \u5730\u5740")),(0,l.kt)("p",null,"\u82e5 Task \u4e3a ResultTask\uff0c\u5219 ",(0,l.kt)("inlineCode",{parentName:"p"},"runTask")," \u4e3b\u8981\u505a\u7684\u4e8b\u60c5\u4e3a\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u53cd\u5e8f\u5217\u5316\u5b57\u8282\u6570\u7ec4 ",(0,l.kt)("inlineCode",{parentName:"li"},"taskBinary"),"\uff0c\u83b7\u5f97 RDD \u5b9e\u4f8b\u548c\u7528\u6237\u51fd\u6570 ",(0,l.kt)("inlineCode",{parentName:"li"},"func")),(0,l.kt)("li",{parentName:"ul"},"\u8c03\u7528 RDD \u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"iterator")," \u65b9\u6cd5\u83b7\u53d6\u8fed\u4ee3\u5668\uff0c\u5c06\u5176\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u7528\u6237\u51fd\u6570 ",(0,l.kt)("inlineCode",{parentName:"li"},"func")," \u6267\u884c\u8ba1\u7b97\uff0c\u5e76 ",(0,l.kt)("strong",{parentName:"li"},"\u76f4\u63a5\u8fd4\u56de\u8ba1\u7b97\u540e\u7684\u7ed3\u679c"))),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("inlineCode",{parentName:"p"},"iterator")," \u65b9\u6cd5\u6700\u7ec8\u5b9e\u9645\u4e0a\u8c03\u7528\u7684\u4fbf\u662f RDD \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"compute")," \u65b9\u6cd5\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"compute")," \u65b9\u6cd5\u7684\u5177\u4f53\u5b9e\u73b0\u7531\u5b50\u7c7b\u51b3\u5b9a\u3002")),(0,l.kt)("hr",null),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u77e5\u8bc6\u6269\u5c55\uff1a\u7528\u6237\u51fd\u6570 ",(0,l.kt)("inlineCode",{parentName:"strong"},"func")," \u4e0e RDD \u7684 ",(0,l.kt)("inlineCode",{parentName:"strong"},"compute")," \u65b9\u6cd5\u662f\u4ec0\u4e48\u5173\u7cfb\uff1f\u54ea\u4e00\u4e2a\u662f\u8ba1\u7b97\u903b\u8f91\u7684\u6267\u884c\u8005\uff1f")),(0,l.kt)("p",null,"\u7528\u6237\u51fd\u6570 ",(0,l.kt)("inlineCode",{parentName:"p"},"func")," \u6307\u7684\u4fbf\u662f\u6211\u4eec\u7f16\u5199\u5728\u7b97\u5b50\u4e2d\u7684\u8ba1\u7b97\u903b\u8f91\uff0c\u4f8b\u5982\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},"// \u8f6c\u6362\u7b97\u5b50\u4e2d\u7684 func\nval wordMap: RDD[(String, Int)] = words.map(x => {\n  (x, 1)\n})\n\n// \u884c\u52a8\u7b97\u5b50\u4e2d\u7684 func\nrdd.foreach(x => {\n  println(new String(x.value(), StandardCharsets.UTF_8))\n})\n")),(0,l.kt)("p",null,"\u76f4\u89c9\u544a\u8bc9\u6211\u4eec\uff0c\u7528\u6237\u51fd\u6570 ",(0,l.kt)("inlineCode",{parentName:"p"},"func")," \u4f1a\u5728 RDD \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"compute")," \u65b9\u6cd5\u4e2d\u88ab\u8c03\u7528\uff0c\u56e0\u6b64\u4e24\u8005\u90fd\u53ef\u4ee5\u7b97\u4f5c\u8ba1\u7b97\u903b\u8f91\u7684\u6267\u884c\u8005\uff0c\u4f46\u5b9e\u9645\u4e0a\u771f\u7684\u662f\u5982\u6b64\u5417\uff1f"),(0,l.kt)("p",null,"\u4e3e\u4f8b\u8bf4\u660e\uff0c\u5982\u679c\u4ec5\u770b MapPartitionsRDD \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"compute")," \u65b9\u6cd5\uff0c\u90a3\u4e48\u4e0a\u9762\u7684\u7ed3\u8bba\u662f\u6b63\u786e\u7684\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},"override def compute(split: Partition, context: TaskContext): Iterator[U] =\n  f(context, split.index, firstParent[T].iterator(split, context))\n")),(0,l.kt)("p",null,"\u4f46\u5728 KafkaRDD \u4e2d\uff08\u4ee5 ",(0,l.kt)("inlineCode",{parentName:"p"},"0.8")," \u7248\u672c\u4e3a\u4f8b\uff09\uff0c\u8fd9\u4e2a\u7ed3\u8bba\u5374\u662f\u9519\u8bef\u7684\uff0c\u6211\u4eec\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"compute")," \u65b9\u6cd5\u770b\u4e0d\u5230\u7528\u6237\u51fd\u6570 ",(0,l.kt)("inlineCode",{parentName:"p"},"func")," \u7684\u8eab\u5f71\uff0c\u53ea\u80fd\u770b\u5230\u5b83\u8fd4\u56de\u4e86\u4e00\u4e2a\u6570\u636e\u96c6\u7684\u8fed\u4ee3\u5668\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},'override def compute(thePart: Partition, context: TaskContext): Iterator[R] = {\n  val part = thePart.asInstanceOf[KafkaRDDPartition]\n  assert(part.fromOffset <= part.untilOffset, errBeginAfterEnd(part))\n  if (part.fromOffset == part.untilOffset) {\n    log.info(s"Beginning offset ${part.fromOffset} is the same as ending offset " +\n      s"skipping ${part.topic} ${part.partition}")\n    Iterator.empty\n  } else {\n    new KafkaRDDIterator(part, context)\n  }\n}\n')),(0,l.kt)("p",null,"\u6240\u4ee5\u7ed3\u8bba\u662f\uff0c\u7528\u6237\u51fd\u6570 ",(0,l.kt)("inlineCode",{parentName:"p"},"func")," \u662f\u8ba1\u7b97\u903b\u8f91\u7684\u6267\u884c\u8005\uff0c\u800c RDD \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"compute")," \u65b9\u6cd5\u662f\u5426\u53c2\u4e0e\u4e86\u8ba1\u7b97\u7684\u6267\u884c\u8fd8\u9700\u8981\u770b\u5176\u5b50\u7c7b\u7684\u5177\u4f53\u5b9e\u73b0\u3002\u4f46\u6709\u4e00\u70b9\u662f\u80af\u5b9a\u7684\uff0c\u5bf9\u4e8e ResultTask \u800c\u8a00\uff0c\u7528\u6237\u51fd\u6570 ",(0,l.kt)("inlineCode",{parentName:"p"},"func")," \u548c RDD \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"compute")," \u65b9\u6cd5\u5171\u540c\u5b8c\u6210\u4e86\u8ba1\u7b97\u903b\u8f91\u7684\u6267\u884c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},"override def runTask(context: TaskContext): U = {\n  // Deserialize the RDD and the func using the broadcast variables.\n  // ...\n  val (rdd, func) = ser.deserialize[(RDD[T], (TaskContext, Iterator[T]) => U)](\n    ByteBuffer.wrap(taskBinary.value), Thread.currentThread.getContextClassLoader)\n  // ...\n  func(context, rdd.iterator(partition, context))\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"STEP 03\uff1a\u5904\u7406\u8ba1\u7b97\u7ed3\u679c")),(0,l.kt)("p",null,"\u6211\u4eec\u5148\u4e86\u89e3\u4e24\u4e2a\u4e0e\u8ba1\u7b97\u7ed3\u679c\u76f8\u5173\u7684\u7c7b\u7684\u6982\u5ff5\uff1a"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u7c7b\u540d\u79f0")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u542b\u4e49")))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"DirectTaskResult"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8868\u793a\u76f4\u63a5\u8ba1\u7b97\u7ed3\u679c\uff0c\u4ee5 ByteBuffer \u5b58\u50a8\u8ba1\u7b97\u540e\u7684\u7ed3\u679c")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"IndirectTaskResult"),(0,l.kt)("td",{parentName:"tr",align:null},"\u8868\u793a\u95f4\u63a5\u8ba1\u7b97\u7ed3\u679c\uff0c\u4ec5\u5b58\u50a8 DirectTaskResult \u5728 BlockManager \u7684\u5f15\u7528\u53ca\u5176\u5927\u5c0f")))),(0,l.kt)("p",null,"Executor \u5b8c\u6210\u8ba1\u7b97\u540e\uff0c\u9996\u5148\u4f1a\u5bf9\u8ba1\u7b97\u7ed3\u679c\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u5f97\u5230 DirectTaskResult \u5bf9\u8c61\uff0c\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},"val ser = env.closureSerializer.newInstance()\nval resultSer = env.serializer.newInstance()\n\nval valueBytes = resultSer.serialize(value)\n\nval directResult = new DirectTaskResult(valueBytes, accumUpdates, metricPeaks)\nval serializedDirectResult = ser.serialize(directResult)\n// \u5e8f\u5217\u5316\u7ed3\u679c\u7684\u5927\u5c0f\nval resultSize = serializedDirectResult.limit()\n\n")),(0,l.kt)("p",null,"\u6839\u636e ",(0,l.kt)("inlineCode",{parentName:"p"},"resultSize")," \u7684\u5927\u5c0f\uff0cExecutor \u91c7\u7528\u4e86 3 \u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u5904\u7406\u8ba1\u7b97\u7ed3\u679c\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u82e5 ",(0,l.kt)("inlineCode",{parentName:"li"},"resultSize")," > ",(0,l.kt)("inlineCode",{parentName:"li"},"maxResultSize"),"\uff0c\u76f4\u63a5\u4e22\u5f03\u5e76\u8f6c\u5316\u4e3a IndirectTaskResult \u56de\u4f20\u7ed9 Driver"),(0,l.kt)("li",{parentName:"ul"},"\u82e5 ",(0,l.kt)("inlineCode",{parentName:"li"},"resultSize")," > ",(0,l.kt)("inlineCode",{parentName:"li"},"maxDirectResultSize"),"\uff0c\u5b58\u50a8\u5230 BlockManager \u5e76\u8f6c\u5316\u4e3a IndirectTaskResult \u56de\u4f20\u7ed9 Driver"),(0,l.kt)("li",{parentName:"ul"},"\u82e5 ",(0,l.kt)("inlineCode",{parentName:"li"},"resultSize")," \u4e0d\u7b26\u5408\u4ee5\u4e0a\u4e24\u79cd\u60c5\u51b5\uff0c\u76f4\u63a5\u56de\u4f20\u7ed9 Driver")),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("inlineCode",{parentName:"p"},"maxResultSize")," \u8868\u793a\u6700\u5927\u7ed3\u679c\u5927\u5c0f\uff0c\u7531 Spark \u914d\u7f6e\u53c2\u6570 ",(0,l.kt)("inlineCode",{parentName:"p"},"spark.driver.maxResultSize")," \u6307\u5b9a\uff0c\u9ed8\u8ba4\u503c\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"1g"),"\uff1b",(0,l.kt)("inlineCode",{parentName:"p"},"maxDirectResultSize")," \u8868\u793a\u6700\u5927\u76f4\u63a5\u56de\u4f20\u7ed3\u679c\u5927\u5c0f\uff0c\u7531 Spark \u914d\u7f6e\u53c2\u6570 ",(0,l.kt)("inlineCode",{parentName:"p"},"spark.task.maxDirectResultSize")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"spark.rpc.message.maxSize")," \u4e2d\u7684\u6700\u5c0f\u503c\u51b3\u5b9a\uff0c\u524d\u8005\u9ed8\u8ba4\u503c\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"1MB"),"\uff0c\u540e\u8005\u9ed8\u8ba4\u503c\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"128MB"),"\u3002")),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u82e5\u4efb\u52a1\u7c7b\u578b\u4e3a ShuffleMapTask\uff0c\u5c3d\u7ba1\u8fd4\u56de\u7ed9 Driver \u7684\u7ed3\u679c\u4e5f\u662f DirectTaskResult\uff0c\u4f46\u5b9e\u9645\u4e0a\u5c01\u88c5\u7684\u662f MapStatus \u7684\u4fe1\u606f\uff0c\u5e76\u975e\u771f\u5b9e\u7684\u8ba1\u7b97\u7ed3\u679c\u3002")),(0,l.kt)("h3",{id:"\u56de\u6536\u9636\u6bb5"},"\u56de\u6536\u9636\u6bb5"),(0,l.kt)("p",null,"\u56de\u6536\u9636\u6bb5\u7531 ExecutorBackend \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"statusUpdate")," \u65b9\u6cd5\u53d1\u8d77\uff0c\u5728 Standalone \u6a21\u5f0f\u4e0b\uff0c\u4e3b\u8981\u8fc7\u7a0b\u4e3a\uff1a"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"\u6784\u9020 StatusUpdate \u5bf9\u8c61\uff08\u5305\u542b ",(0,l.kt)("inlineCode",{parentName:"li"},"executorId"),"\u3001",(0,l.kt)("inlineCode",{parentName:"li"},"taskId"),"\u3001",(0,l.kt)("inlineCode",{parentName:"li"},"state"),"\u3001",(0,l.kt)("inlineCode",{parentName:"li"},"data")," \u7b49\u5b57\u6bb5\uff09\uff0c\u53d1\u7ed9 DriverEndPoint"),(0,l.kt)("li",{parentName:"ol"},"DriverEndPoint \u63a5\u6536\u8bf7\u6c42\u540e\uff0c\u8c03\u7528 TaskScheduler \u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"statusUpdate")," \u65b9\u6cd5\u63a5\u6536\u56de\u6536\u4efb\u52a1"),(0,l.kt)("li",{parentName:"ol"},"\u82e5\u4efb\u52a1\u72b6\u6001\u4e3a ",(0,l.kt)("inlineCode",{parentName:"li"},"FINISHED"),"\uff0cTaskResultGetter \u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"enqueueSuccessfulTask")," \u65b9\u6cd5\u4f1a\u5bf9\u56de\u6536\u4efb\u52a1\u8fdb\u884c\u5f02\u6b65\u5904\u7406\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u82e5\u63a5\u6536\u7ed3\u679c\u4e3a DirectTaskResult\uff0c\u76f4\u63a5\u83b7\u53d6\u8ba1\u7b97\u7ed3\u679c\u8fd4\u56de\u503c"),(0,l.kt)("li",{parentName:"ul"},"\u82e5\u63a5\u6536\u7ed3\u679c\u4e3a IndirectTaskResult\uff0c\u5219\u5148\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"blockId")," \u627e\u5230 BlockManager\uff0c\u518d\u83b7\u53d6\u8ba1\u7b97\u7ed3\u679c\u8fd4\u56de\u503c"))),(0,l.kt)("li",{parentName:"ol"},"\u8c03\u7528 TaskSetManager \u7684 ",(0,l.kt)("inlineCode",{parentName:"li"},"handleSuccessfulTask")," \u65b9\u6cd5\uff0c\u6807\u8bb0\u4efb\u52a1\u6267\u884c\u7ed3\u679c\uff0c\u5e76\u901a\u77e5 DAGScheduler"),(0,l.kt)("li",{parentName:"ol"},"DAGScheduler \u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"li"},"handleTaskCompletion")," \u65b9\u6cd5\u5b8c\u6210\u6700\u7ec8\u7684\u56de\u6536\uff1a",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u82e5\u4efb\u52a1\u7c7b\u578b\u4e3a ShuffleMapTask\uff0c",(0,l.kt)("strong",{parentName:"li"},"\u5c06 MapStatus \u6ce8\u518c\u5230 MapOutputTracker"),"\uff0c\u7136\u540e\u7ee7\u7eed\u63d0\u4ea4\u961f\u5217\u4e2d\u7684\u4efb\u52a1"),(0,l.kt)("li",{parentName:"ul"},"\u82e5\u4efb\u52a1\u7c7b\u578b\u4e3a ResultTask\uff0c\u6807\u8bb0 Job \u4e3a\u7ed3\u675f\u72b6\u6001\uff0c",(0,l.kt)("strong",{parentName:"li"},"\u4e0a\u62a5\u8ba1\u7b97\u7ed3\u679c\u5230 JobWaiter \u5e76\u56de\u4f20\u7ed9 Application"))))),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u672c\u8282\u53ea\u5c55\u793a\u6210\u529f\u4efb\u52a1\u7684\u56de\u6536\u8fc7\u7a0b\uff0c\u4e0d\u63cf\u8ff0\u5931\u8d25\u4efb\u52a1\u7684\u56de\u6536\u53ca\u91cd\u53d1\u8fc7\u7a0b\u3002")),(0,l.kt)("p",null,"\u770b\u5230 JobWaiter\uff0c\u6709\u4e9b\u4eba\u53ef\u80fd\u4f1a\u6709\u4e9b\u964c\u751f\u3002\u5b9e\u9645\u4e0a\uff0c\u5b83\u4e0d\u4ec5\u662f\u4efb\u52a1\u8c03\u5ea6\u7684\u7ec8\u70b9\uff0c\u4e5f\u662f\u4efb\u52a1\u8c03\u5ea6\u7684\u8d77\u70b9\u3002\u56de\u987e\u4e00\u4e0b\uff0c\u6211\u4eec\u6700\u521d\u89e6\u53d1\u884c\u52a8\u7b97\u5b50\u65f6\uff0c\u4f1a\u8c03\u7528\u5230 SparkContext \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"runJob")," \u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},"def runJob[T, U: ClassTag](\n    rdd: RDD[T],\n    func: (TaskContext, Iterator[T]) => U,\n    partitions: Seq[Int]): Array[U] = {\n  val results = new Array[U](partitions.size)\n  runJob[T, U](rdd, func, partitions, (index, res) => results(index) = res)\n  results\n}\n")),(0,l.kt)("p",null,"\u5176\u4e2d\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"results")," \u5373\u4e3a\u8fd4\u56de\u7ed9 Application \u7684\u7ed3\u679c\uff0c\u5b83\u7684\u8d4b\u503c\u6700\u7ec8\u7531 JobWaiter \u5b8c\u6210\uff0c\u6574\u4e2a\u8fc7\u7a0b\u7684\u6838\u5fc3\u4ee3\u7801\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-scala"},"// DAGScheduler\nval waiter = submitJob(rdd, func, partitions, callSite, resultHandler, properties)\n\n// JobWaiter\noverride def taskSucceeded(index: Int, result: Any): Unit = {\n  synchronized {\n    resultHandler(index, result.asInstanceOf[T])\n  }\n  if (finishedTasks.incrementAndGet() == totalTasks) {\n    jobPromise.success(())\n  }\n}\n\n")),(0,l.kt)("p",null,"\u81f3\u6b64\uff0c\u6211\u4eec\u5b8c\u6210\u4e86\u5bf9 Spark \u4efb\u52a1\u8c03\u5ea6\u6574\u4e2a\u8fc7\u7a0b\u7684\u68b3\u7406\uff0c\u4f46\u662f\u4ed4\u7ec6\u601d\u7d22\u7684\u8bdd\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u8fd8\u6709\u4e00\u4e9b\u5f88\u91cd\u8981\u7684\u95ee\u9898\u6ca1\u6709\u5c55\u5f00\u8ba8\u8bba\uff0c\u90a3\u5c31\u662f\uff1a",(0,l.kt)("strong",{parentName:"p"},"ResultTask \u662f\u600e\u4e48\u83b7\u5f97 ShuffleMapTask \u4e2d\u7684\u8ba1\u7b97\u7ed3\u679c\u7684\uff1f\u4e24\u8005\u4e4b\u95f4\u7a76\u7adf\u662f\u901a\u8fc7\u4ec0\u4e48\u65b9\u5f0f\u5b8c\u6210\u6570\u636e\u4f20\u9012\uff1f")),(0,l.kt)("p",null,"\u8fd9\u4e00\u5207\uff0c\u90fd\u5c06\u5728\u6211\u4eec\u7684\u4e0b\u4e00\u7bc7\u6587\u7ae0\u300aSpark Shuffle\u300b\u4e2d\u5f97\u5230\u89e3\u7b54\u3002"))}s.isMDXComponent=!0},4747:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/initial-196ae5e8eb8cf5ae95025b136eb18baf.svg"},6535:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/request_executor-c00211cdc5ba1457c30261b8163a764c.svg"},3272:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/resource_offer-9b01b847231f4942a52f42170e776a63.svg"},751:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/rpc-9c14deeef19eeab068bb46e32e420481.svg"},4151:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/schedule-2b55552742ce32a978b8c370ff080f30.svg"},115:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/scheduler_backend-004f22a4fc4e3ffe305eb5a5f1e55383.svg"},4839:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/stage-757fe4092f6c4a8c87380f928f67d108.svg"},4383:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/stage_split-d51ed4c75485da05472ccbdb5ea7c64e.svg"},3068:(e,t,a)=>{a.d(t,{Z:()=>n});const n="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIxNDAycHgiIGhlaWdodD0iNDIycHgiIHZpZXdCb3g9Ii0wLjUgLTAuNSAxNDAyIDQyMiIgY29udGVudD0iJmx0O214ZmlsZSBzY2FsZT0mcXVvdDsyJnF1b3Q7IGJvcmRlcj0mcXVvdDszMCZxdW90OyZndDsmbHQ7ZGlhZ3JhbSBpZD0mcXVvdDswUWh0d3FNanBtY19BTy1NclJiNCZxdW90OyBuYW1lPSZxdW90O+esrCAxIOmhtSZxdW90OyZndDs3WmhObDVvd0ZJWi9EZHNlSUFSbFdUOW9ON095cDExbklBTTVFNGlOc1doL2ZTOXlFYUo0UnFlYzR3WTNrdmZtRXZJK041am9rR1Z4K0tiWk5uOVJLWmVPNzZZSGg2d2MzL2VvNjhOWHJSd2JaUjZTUnNpMFNMRlRKMnpFWDQ2aWkrcGVwSHhuZFRSS1NTTzJ0cGlvc3VTSnNUU210YXJzYm05SzJxTnVXY2F2aEUzQzVMWDZTNlFtUnpXa1FSZjR6a1dXNDlBK0lXRVRLVmpiRzZleXkxbXFxcDVFMWc1WmFxVk1jMVVjbGx6VzdyWEdOSG54amVqNXlUUXZ6VDBKTXpKclV2NHd1Y2ZwNFpPWll6dGZyZlpseXVzTTF5R0xLaGVHYjdZc3FhTVZFQVl0TjRXRWxnZVhiMExLcFpKS24zTEplaFg3Y1FENnptajF6dHRJcVVwSVgrRFlYQnQrdURrRDcrd0xWQlJYQlRmNkNGMHdJVUFuajNhejZzQ0VNOVR5SGhOdmppTERZc2pPZCs3c2dndDA3SVo3QVJuYlBWVWFMSGd2d0hiUHpmajB1ZVhtaGZVa29ENGw0N2hNWjErbzVmTjh3R2RDQjN6MjZRZytrL21BejZFMDZGQzlpQnRIUWYyOXJ4ZlA0aWZYS1N0Wko4QlZWbi8vWUx2M05oa0didktiMFAreEcyWlNBOFViRGdLMm1jWHhLZ3JEY1poRjlzcndXanc5Wk5IQXlxQmpMQXdTVGNBZUJuYitnWHNHc2ZiRk9SRjdnQmdoenlUbVRjUWUzeTdRWnhMekoyS2YySG84azFnd0hyRTI4YldQY01OTmorTHJaZCtQeUlLdDVoNThQVHdvTVNteUVwb0pZT0NnTDJwSUFnNDVYekZRaURTdGh4bXNGN3VpN3QyMWp2SEdwZlkrMUhPdk42TEJRRFg0bzFRREhhTWE0RnphV3RPSjdXNzk3cXA1Z2J0bUFHNHFuZ2MyV05IbE1ZWmVWNDlIQjQ0eG55Z2ZhSGJuK0ZPczkzY0lXZjhEJmx0Oy9kaWFncmFtJmd0OyZsdDsvbXhmaWxlJmd0OyI+PGRlZnMvPjxnPjxyZWN0IHg9IjMwIiB5PSIzMCIgd2lkdGg9IjEzNDAiIGhlaWdodD0iMzYwIiBmaWxsPSIjZWRmMmY0IiBzdHJva2U9Im5vbmUiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48cmVjdCB4PSI2NSIgeT0iMTEwIiB3aWR0aD0iMTI3MCIgaGVpZ2h0PSIyNTAiIGZpbGw9IiMzNDUyNTMiIHN0cm9rZT0ibm9uZSIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxyZWN0IHg9IjEzMCIgeT0iMjIwIiB3aWR0aD0iMTgwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2ZmZDk2NiIgc3Ryb2tlPSJub25lIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KXNjYWxlKDIpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiIHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogODhweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAxMzVweDsgbWFyZ2luLWxlZnQ6IDY2cHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDA7IHRleHQtYWxpZ246IGNlbnRlcjsgIj48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTRweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6ICMwMDAwMDA7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IGZvbnQtd2VpZ2h0OiBib2xkOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyB3b3JkLXdyYXA6IG5vcm1hbDsgIj48Zm9udCBmYWNlPSJWZXJkYW5hIj5UYXNrPC9mb250PjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIxMTAiIHk9IjEzOSIgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxNHB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXdlaWdodD0iYm9sZCI+VGFzazwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgeD0iMzcwIiB5PSIyMjAiIHdpZHRoPSIxODAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZmZkOTY2IiBzdHJva2U9Im5vbmUiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpc2NhbGUoMikiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiA4OHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDEzNXB4OyBtYXJnaW4tbGVmdDogMTg2cHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDA7IHRleHQtYWxpZ246IGNlbnRlcjsgIj48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTRweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6ICMwMDAwMDA7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IGZvbnQtd2VpZ2h0OiBib2xkOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyB3b3JkLXdyYXA6IG5vcm1hbDsgIj48Zm9udCBmYWNlPSJWZXJkYW5hIj5UYXNrPC9mb250PjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIyMzAiIHk9IjEzOSIgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxNHB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXdlaWdodD0iYm9sZCI+VGFzazwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgeD0iNjEwIiB5PSIyMjAiIHdpZHRoPSIxODAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZmZkOTY2IiBzdHJva2U9Im5vbmUiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpc2NhbGUoMikiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiA4OHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDEzNXB4OyBtYXJnaW4tbGVmdDogMzA2cHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDA7IHRleHQtYWxpZ246IGNlbnRlcjsgIj48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTRweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6ICMwMDAwMDA7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IGZvbnQtd2VpZ2h0OiBib2xkOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyB3b3JkLXdyYXA6IG5vcm1hbDsgIj48Zm9udCBmYWNlPSJWZXJkYW5hIj5UYXNrPC9mb250PjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSIzNTAiIHk9IjEzOSIgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxNHB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXdlaWdodD0iYm9sZCI+VGFzazwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgeD0iODUwIiB5PSIyMjAiIHdpZHRoPSIxODAiIGhlaWdodD0iMTAwIiBmaWxsPSIjZmZkOTY2IiBzdHJva2U9Im5vbmUiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpc2NhbGUoMikiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiA4OHB4OyBoZWlnaHQ6IDFweDsgcGFkZGluZy10b3A6IDEzNXB4OyBtYXJnaW4tbGVmdDogNDI2cHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDA7IHRleHQtYWxpZ246IGNlbnRlcjsgIj48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTRweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6ICMwMDAwMDA7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IGZvbnQtd2VpZ2h0OiBib2xkOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyB3b3JkLXdyYXA6IG5vcm1hbDsgIj48Zm9udCBmYWNlPSJWZXJkYW5hIj5UYXNrPC9mb250PjwvZGl2PjwvZGl2PjwvZGl2PjwvZm9yZWlnbk9iamVjdD48dGV4dCB4PSI0NzAiIHk9IjEzOSIgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxNHB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXdlaWdodD0iYm9sZCI+VGFzazwvdGV4dD48L3N3aXRjaD48L2c+PHJlY3QgeD0iMTA5MCIgeT0iMjIwIiB3aWR0aD0iMTgwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2ZmZDk2NiIgc3Ryb2tlPSJub25lIiBwb2ludGVyLWV2ZW50cz0iYWxsIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNSAtMC41KXNjYWxlKDIpIj48c3dpdGNoPjxmb3JlaWduT2JqZWN0IHN0eWxlPSJvdmVyZmxvdzogdmlzaWJsZTsgdGV4dC1hbGlnbjogbGVmdDsiIHBvaW50ZXItZXZlbnRzPSJub25lIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiByZXF1aXJlZEZlYXR1cmVzPSJodHRwOi8vd3d3LnczLm9yZy9UUi9TVkcxMS9mZWF0dXJlI0V4dGVuc2liaWxpdHkiPjxkaXYgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIHN0eWxlPSJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogdW5zYWZlIGNlbnRlcjsganVzdGlmeS1jb250ZW50OiB1bnNhZmUgY2VudGVyOyB3aWR0aDogODhweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAxMzVweDsgbWFyZ2luLWxlZnQ6IDU0NnB4OyI+PGRpdiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwOyB0ZXh0LWFsaWduOiBjZW50ZXI7ICI+PGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDE0cHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiAjMDAwMDAwOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyBmb250LXdlaWdodDogYm9sZDsgd2hpdGUtc3BhY2U6IG5vcm1hbDsgd29yZC13cmFwOiBub3JtYWw7ICI+PGZvbnQgZmFjZT0iVmVyZGFuYSI+VGFzazwvZm9udD48L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iNTkwIiB5PSIxMzkiIGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTRweCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC13ZWlnaHQ9ImJvbGQiPlRhc2s8L3RleHQ+PC9zd2l0Y2g+PC9nPjxyZWN0IHg9IjY2MCIgeT0iMTUwIiB3aWR0aD0iODAiIGhlaWdodD0iNDAiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgcG9pbnRlci1ldmVudHM9ImFsbCIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjUgLTAuNSlzY2FsZSgyKSI+PHN3aXRjaD48Zm9yZWlnbk9iamVjdCBzdHlsZT0ib3ZlcmZsb3c6IHZpc2libGU7IHRleHQtYWxpZ246IGxlZnQ7IiBwb2ludGVyLWV2ZW50cz0ibm9uZSIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgcmVxdWlyZWRGZWF0dXJlcz0iaHR0cDovL3d3dy53My5vcmcvVFIvU1ZHMTEvZmVhdHVyZSNFeHRlbnNpYmlsaXR5Ij48ZGl2IHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBzdHlsZT0iZGlzcGxheTogZmxleDsgYWxpZ24taXRlbXM6IHVuc2FmZSBjZW50ZXI7IGp1c3RpZnktY29udGVudDogdW5zYWZlIGNlbnRlcjsgd2lkdGg6IDM4cHg7IGhlaWdodDogMXB4OyBwYWRkaW5nLXRvcDogODVweDsgbWFyZ2luLWxlZnQ6IDMzMXB4OyI+PGRpdiBzdHlsZT0iYm94LXNpemluZzogYm9yZGVyLWJveDsgZm9udC1zaXplOiAwOyB0ZXh0LWFsaWduOiBjZW50ZXI7ICI+PGRpdiBzdHlsZT0iZGlzcGxheTogaW5saW5lLWJsb2NrOyBmb250LXNpemU6IDE0cHg7IGZvbnQtZmFtaWx5OiBIZWx2ZXRpY2E7IGNvbG9yOiAjRkZGRkZGOyBsaW5lLWhlaWdodDogMS4yOyBwb2ludGVyLWV2ZW50czogYWxsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyB3b3JkLXdyYXA6IG5vcm1hbDsgIj48Zm9udCBmYWNlPSJWZXJkYW5hIj48Yj5UYXNrU2V0PC9iPjwvZm9udD48L2Rpdj48L2Rpdj48L2Rpdj48L2ZvcmVpZ25PYmplY3Q+PHRleHQgeD0iMzUwIiB5PSI4OSIgZmlsbD0iI0ZGRkZGRiIgZm9udC1mYW1pbHk9IkhlbHZldGljYSIgZm9udC1zaXplPSIxNHB4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5UYXNrU2V0PC90ZXh0Pjwvc3dpdGNoPjwvZz48cmVjdCB4PSI1NDUiIHk9IjUwIiB3aWR0aD0iMzEwIiBoZWlnaHQ9IjQwIiBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiIHBvaW50ZXItZXZlbnRzPSJhbGwiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC41IC0wLjUpc2NhbGUoMikiPjxzd2l0Y2g+PGZvcmVpZ25PYmplY3Qgc3R5bGU9Im92ZXJmbG93OiB2aXNpYmxlOyB0ZXh0LWFsaWduOiBsZWZ0OyIgcG9pbnRlci1ldmVudHM9Im5vbmUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSI+PGRpdiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiB1bnNhZmUgY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IHVuc2FmZSBjZW50ZXI7IHdpZHRoOiAxNTNweDsgaGVpZ2h0OiAxcHg7IHBhZGRpbmctdG9wOiAzNXB4OyBtYXJnaW4tbGVmdDogMjc0cHg7Ij48ZGl2IHN0eWxlPSJib3gtc2l6aW5nOiBib3JkZXItYm94OyBmb250LXNpemU6IDA7IHRleHQtYWxpZ246IGNlbnRlcjsgIj48ZGl2IHN0eWxlPSJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGZvbnQtc2l6ZTogMTRweDsgZm9udC1mYW1pbHk6IEhlbHZldGljYTsgY29sb3I6ICNGRkZGRkY7IGxpbmUtaGVpZ2h0OiAxLjI7IHBvaW50ZXItZXZlbnRzOiBhbGw7IHdoaXRlLXNwYWNlOiBub3JtYWw7IHdvcmQtd3JhcDogbm9ybWFsOyAiPjxmb250IGZhY2U9IlZlcmRhbmEiIGNvbG9yPSIjMzQ1MjUzIj48Yj5UYXNrU2V0TWFuYWdlcjwvYj48L2ZvbnQ+PC9kaXY+PC9kaXY+PC9kaXY+PC9mb3JlaWduT2JqZWN0Pjx0ZXh0IHg9IjM1MCIgeT0iMzkiIGZpbGw9IiNGRkZGRkYiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EiIGZvbnQtc2l6ZT0iMTRweCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+VGFza1NldE1hbmFnZXI8L3RleHQ+PC9zd2l0Y2g+PC9nPjwvZz48c3dpdGNoPjxnIHJlcXVpcmVkRmVhdHVyZXM9Imh0dHA6Ly93d3cudzMub3JnL1RSL1NWRzExL2ZlYXR1cmUjRXh0ZW5zaWJpbGl0eSIvPjxhIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsLTUpIiB4bGluazpocmVmPSJodHRwczovL3d3dy5kaWFncmFtcy5uZXQvZG9jL2ZhcS9zdmctZXhwb3J0LXRleHQtcHJvYmxlbXMiIHRhcmdldD0iX2JsYW5rIj48dGV4dCB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjEwcHgiIHg9IjUwJSIgeT0iMTAwJSI+Vmlld2VyIGRvZXMgbm90IHN1cHBvcnQgZnVsbCBTVkcgMS4xPC90ZXh0PjwvYT48L3N3aXRjaD48L3N2Zz4="},9607:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/total_schedule-d72ae4cd2c18c55f98e234a9ae613875.svg"}}]);