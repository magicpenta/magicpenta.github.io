"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9466],{3905:(e,t,a)=>{a.d(t,{Zo:()=>k,kt:()=>d});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),u=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},k=function(e){var t=u(e.components);return n.createElement(p.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},s=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,k=o(e,["components","mdxType","originalType","parentName"]),c=u(a),s=r,d=c["".concat(p,".").concat(s)]||c[s]||m[s]||l;return a?n.createElement(d,i(i({ref:t},k),{},{components:a})):n.createElement(d,i({ref:t},k))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=s;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[c]="string"==typeof e?e:r,i[1]=o;for(var u=2;u<l;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}s.displayName="MDXCreateElement"},1889:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>l,metadata:()=>o,toc:()=>u});var n=a(7462),r=(a(7294),a(3905));const l={sidebar_position:3},i="Flink DataStream API",o={unversionedId:"flink/Flink DataStream API",id:"flink/Flink DataStream API",title:"Flink DataStream API",description:"Flink \u6839\u636e\u62bd\u8c61\u7a0b\u5ea6\u5206\u5c42\uff0c\u63d0\u4f9b\u4e86\u4e09\u79cd\u4e0d\u540c\u7684 API\u3002\u6bcf\u4e00\u79cd API \u5728\u7b80\u6d01\u6027\u548c\u8868\u8fbe\u529b\u4e0a\u6709\u7740\u4e0d\u540c\u7684\u4fa7\u91cd\uff0c\u5e76\u4e14\u9488\u5bf9\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\u3002",source:"@site/docs/flink/Flink DataStream API.md",sourceDirName:"flink",slug:"/flink/Flink DataStream API",permalink:"/docs/flink/Flink DataStream API",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"defaultSidebar",previous:{title:"Flink \u5de5\u4f5c\u6d41\u7a0b\u5256\u6790",permalink:"/docs/flink/Flink \u5de5\u4f5c\u6d41\u7a0b\u5256\u6790"},next:{title:"Flink Window",permalink:"/docs/flink/Flink Window"}},p={},u=[{value:"Source",id:"source",level:2},{value:"File-based",id:"file-based",level:3},{value:"Socket-based",id:"socket-based",level:3},{value:"Collection-based",id:"collection-based",level:3},{value:"Kafka",id:"kafka",level:3},{value:"Transformation",id:"transformation",level:2},{value:"Map",id:"map",level:3},{value:"FlatMap",id:"flatmap",level:3},{value:"Filter",id:"filter",level:3},{value:"KeyBy",id:"keyby",level:3},{value:"Reduce",id:"reduce",level:3},{value:"Union",id:"union",level:3},{value:"Connect",id:"connect",level:3},{value:"CoMap",id:"comap",level:3},{value:"CoFlatMap",id:"coflatmap",level:3},{value:"Partitioner",id:"partitioner",level:2},{value:"Custom",id:"custom",level:3},{value:"Random",id:"random",level:3},{value:"Rebalance",id:"rebalance",level:3},{value:"Rescale",id:"rescale",level:3},{value:"Broadcast",id:"broadcast",level:3},{value:"Sink",id:"sink",level:2},{value:"Print",id:"print",level:3},{value:"PrintToErr",id:"printtoerr",level:3},{value:"Kafka",id:"kafka-1",level:3},{value:"Redis",id:"redis",level:3}],k={toc:u};function c(e){let{components:t,...l}=e;return(0,r.kt)("wrapper",(0,n.Z)({},k,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"flink-datastream-api"},"Flink DataStream API"),(0,r.kt)("p",null,"Flink \u6839\u636e\u62bd\u8c61\u7a0b\u5ea6\u5206\u5c42\uff0c\u63d0\u4f9b\u4e86\u4e09\u79cd\u4e0d\u540c\u7684 API\u3002\u6bcf\u4e00\u79cd API \u5728\u7b80\u6d01\u6027\u548c\u8868\u8fbe\u529b\u4e0a\u6709\u7740\u4e0d\u540c\u7684\u4fa7\u91cd\uff0c\u5e76\u4e14\u9488\u5bf9\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(6552).Z,width:"2074",height:"708"})),(0,r.kt)("p",null,"DataStream API \u662f Flink \u4e2d\u7528\u4e8e\u7f16\u5199\u6d41\u5904\u7406\u4f5c\u4e1a\u7684 API\uff0c\u4e3a\u8bb8\u591a\u901a\u7528\u7684\u6d41\u5904\u7406\u64cd\u4f5c\u63d0\u4f9b\u4e86\u5904\u7406\u539f\u8bed\u3002\u5b83\u652f\u6301 Java \u548c Scala \u8bed\u8a00\uff0c\u9884\u5148\u5b9a\u4e49\u4e86\u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"map()"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"reduce()"),"\u3001",(0,r.kt)("inlineCode",{parentName:"p"},"aggregate()")," \u7b49\u51fd\u6570\u3002"),(0,r.kt)("p",null,"\u5728 DataStream API \u4e2d\uff0cFlink \u5e94\u7528\u7a0b\u5e8f\u540c\u6837\u5305\u542b\u4ee5\u4e0b\u6b65\u9aa4\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u83b7\u53d6 execution environment"),(0,r.kt)("li",{parentName:"ol"},"\u5b9a\u4e49\u6570\u636e\u6e90"),(0,r.kt)("li",{parentName:"ol"},"\u6267\u884c\u8f6c\u6362\u64cd\u4f5c"),(0,r.kt)("li",{parentName:"ol"},"\u8f93\u51fa\u5230\u6307\u5b9a\u5730\u70b9"),(0,r.kt)("li",{parentName:"ol"},"\u89e6\u53d1\u6267\u884c")),(0,r.kt)("p",null,"\u672c\u6587\u5c06\u4e3b\u8981\u4ecb\u7ecd\u5176\u4e2d\u7684\u4e09\u5927\u90e8\u5206\uff0c\u5206\u522b\u662f\u5b9a\u4e49\u6570\u636e\u6e90\u7684 Source\u3001\u6267\u884c\u8f6c\u6362\u64cd\u4f5c\u7684 Transformation\u3001\u8f93\u51fa\u8ba1\u7b97\u7ed3\u679c\u7684 Sink\u3002"),(0,r.kt)("h2",{id:"source"},"Source"),(0,r.kt)("p",null,"Source \u5c42\u8d1f\u8d23\u6570\u636e\u6d41\u7684\u8bfb\u53d6\u3002Flink \u5b98\u65b9\u5df2\u63d0\u4f9b\u591a\u79cd\u6570\u636e\u6e90 Connector\uff0c\u5982 File\u3001Socket\u3001Kafka\u3001RabbitMQ \u7b49\u3002\u540c\u65f6\uff0cFlink \u4e5f\u652f\u6301\u7528\u6237\u81ea\u5b9a\u4e49 Source\u3002"),(0,r.kt)("h3",{id:"file-based"},"File-based"),(0,r.kt)("p",null,"File-based Source \u652f\u6301\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'DataStreamSource<String> source = env.readTextFile("data/xxx.log");\n')),(0,r.kt)("h3",{id:"socket-based"},"Socket-based"),(0,r.kt)("p",null,"Socket-based Source \u652f\u6301\u4ece Socket \u8fde\u63a5\u4e2d\u8bfb\u53d6\u6570\u636e\uff1a",(0,r.kt)("br",null)),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'DataStreamSource<String> source = env.socketTextStream("xxx.xxx.xxx.xxx", 9999);\n')),(0,r.kt)("h3",{id:"collection-based"},"Collection-based"),(0,r.kt)("p",null,"Collection-based Source \u652f\u6301\u4ece\u96c6\u5408\u4e2d\u8bfb\u53d6\u6570\u636e\uff1a",(0,r.kt)("br",null)),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"DataStreamSource<String> source = env.fromCollection(collection);\n")),(0,r.kt)("h3",{id:"kafka"},"Kafka"),(0,r.kt)("p",null,"\u5bf9\u4e8e Kafka \u6570\u636e\u6e90\uff0c\u5b98\u65b9\u63d0\u4f9b\u4e86\u4e24\u79cd\u5b9e\u73b0\uff0c\u5206\u522b\u4e3a Kafka Source \u548c Kafka Consumer\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Kafka Source \u793a\u4f8b\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'KafkaSource<String> kafkaSource = KafkaSource.<String>builder()\n    .setBootstrapServers(KAFKA_BROKER_SERVERS)\n    .setTopics("test")\n    .setGroupId("panda")\n    .setStartingOffsets(OffsetsInitializer.earliest())\n    .setValueOnlyDeserializer(new SimpleStringSchema())\n    .build();\n\nDataStreamSource<String> source =\n    env.fromSource(kafkaSource, WatermarkStrategy.noWatermarks(), "Kafka Source");\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Kafka Consumer \u793a\u4f8b\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Properties consumerProperties = new Properties();\nconsumerProperties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, KAFKA_BROKER_SERVERS);\nconsumerProperties.put(ConsumerConfig.GROUP_ID_CONFIG, "panda");\nDataStreamSource<String> source =\n    env.addSource(new FlinkKafkaConsumer<>("test", new SimpleStringSchema(), consumerProperties));\n')),(0,r.kt)("h2",{id:"transformation"},"Transformation"),(0,r.kt)("p",null,"Transformation\uff0c\u53c8\u79f0\u7b97\u5b50\uff0c\u5b83\u53ef\u4ee5\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u7684 DataStream \u8f6c\u6362\u4e3a\u65b0\u7684 DataStream\u3002\u901a\u5e38\uff0c\u4e00\u4e2a Flink \u5e94\u7528\u4f5c\u4e1a\u4f1a\u5305\u542b\u591a\u4e2a\u7b97\u5b50\u3002",(0,r.kt)("br",null)),(0,r.kt)("p",null,"\u672c\u8282\uff0c\u6211\u4eec\u5c06\u6839\u636e\u5b98\u65b9\u6587\u6863\uff0c\u4ecb\u7ecd\u4e00\u4e9b\u57fa\u7840\u7684\u7b97\u5b50\u3002"),(0,r.kt)("h3",{id:"map"},"Map"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"DataStream -> DataStream")),(0,r.kt)("p",null,"Map \u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("strong",{parentName:"p"},"1")," \u4e2a\u5143\u7d20\u4ea7\u751f ",(0,r.kt)("strong",{parentName:"p"},"1")," \u4e2a\u65b0\u5143\u7d20\u3002"),(0,r.kt)("p",null,"\u672c\u4f8b\u4e2d\uff0cMap \u4f1a\u5c06\u8f93\u5165\u6d41\u7684\u5143\u7d20\u52a0\u500d\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"DataStream<Integer> dataStream = //...\ndataStream.map(new MapFunction<Integer, Integer>() {\n    @Override\n    public Integer map(Integer value) throws Exception {\n        return 2 * value;\n    }\n});\n")),(0,r.kt)("h3",{id:"flatmap"},"FlatMap"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"DataStream -> DataStream")),(0,r.kt)("p",null,"FlatMap \u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("strong",{parentName:"p"},"1")," \u4e2a\u5143\u7d20\u4ea7\u751f ",(0,r.kt)("strong",{parentName:"p"},"0\u30011 \u6216\u66f4\u591a")," \u7684\u65b0\u5143\u7d20\u3002"),(0,r.kt)("p",null,"\u672c\u4f8b\u4e2d\uff0cFlatMap \u4f1a\u5c06\u8f93\u5165\u7684\u53e5\u5b50\u8fdb\u884c\u62c6\u5206\uff0c\u83b7\u5f97\u4e00\u4e2a\u5355\u8bcd\u96c6\u5408\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'dataStream.flatMap(new FlatMapFunction<String, String>() {\n    @Override\n    public void flatMap(String value, Collector<String> out) throws Exception {\n        for(String word: value.split(" ")){\n            out.collect(word);\n        }\n    }\n});\n')),(0,r.kt)("h3",{id:"filter"},"Filter"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"DataStream -> DataStream")),(0,r.kt)("p",null,"Filter \u53ef\u4ee5\u6839\u636e\u7528\u6237\u8bbe\u7f6e\u7684\u6761\u4ef6\u7b5b\u9009\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u5143\u7d20\u3002",(0,r.kt)("br",null)),(0,r.kt)("p",null,"\u672c\u4f8b\u4e2d\uff0cFilter \u4f1a\u4fdd\u7559\u8f93\u5165\u6d41\u4e2d\u503c\u4e0d\u4e3a 0 \u7684\u5143\u7d20\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"dataStream.filter(new FilterFunction<Integer>() {\n    @Override\n    public boolean filter(Integer value) throws Exception {\n        return value != 0;\n    }\n});\n")),(0,r.kt)("h3",{id:"keyby"},"KeyBy"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"DataStream -> KeyedStream")),(0,r.kt)("p",null,"KeyBy \u4f1a\u5c06 key \u503c\u76f8\u540c\u7684\u8bb0\u5f55\u5206\u914d\u5230\u76f8\u540c\u7684\u5206\u533a\u4e2d\uff0c\u5176\u4f5c\u7528\u7c7b\u4f3c SQL \u4e2d\u7684 group by\u3002",(0,r.kt)("br",null)),(0,r.kt)("p",null,"\u5728\u5185\u90e8\uff0cKeyBy \u662f\u901a\u8fc7\u54c8\u5e0c\u5206\u533a\u5b9e\u73b0\u7684\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"dataStream.keyBy(value -> value.getSomeKey());\ndataStream.keyBy(value -> value.f0);\n")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u7684\u7c7b\u578b ",(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u80fd\u6210\u4e3a key"),"\uff1aPOJO \u7c7b\u578b\uff0c\u4f46\u4e0d\u8986\u5199 ",(0,r.kt)("inlineCode",{parentName:"p"},"hashCode()")," \u65b9\u6cd5\u4e14\u4f9d\u8d56\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"Object.hashCode()")," \u5b9e\u73b0\uff1b\u4efb\u4f55\u7c7b\u578b\u7684\u6570\u7ec4\u3002")),(0,r.kt)("h3",{id:"reduce"},"Reduce"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"KeyedStream -> DataStream")),(0,r.kt)("p",null,"Reduce \u4f1a\u5c06\u6570\u636e\u6d41\u4e2d\u7684\u5143\u7d20\u4e0e\u4e0a\u4e00\u4e2a Reduce \u540e\u7684\u5143\u7d20\u8fdb\u884c\u5408\u5e76\u4e14\u4ea7\u751f\u4e00\u4e2a\u65b0\u503c\u3002\u8fd9\u4e2a\u5408\u5e76\u53d1\u751f\u5728\u6bcf\u6b21\u6570\u636e\u6d41\u5165\u65f6\uff0c\u5373\u6bcf\u6d41\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u90fd\u4f1a\u6709\u4e00\u6b21\u5408\u5e76\u64cd\u4f5c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"keyedStream.reduce(new ReduceFunction<Integer>() {\n    @Override\n    public Integer reduce(Integer value1, Integer value2) throws Exception {\n        return value1 + value2;\n    }\n});\n")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Reduce \u4e0d\u80fd\u7528\u4e8e\u65e0\u754c\u6d41\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u65e0\u754c\u6d41\u6765\u8bf4\uff0c\u5408\u5e76\u662f\u6ca1\u6709\u610f\u4e49\u7684\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0cReduce \u4f5c\u7528\u4e8e\u5206\u7ec4\u6216\u7a97\u53e3\u5904\u7406\u540e\u7684\u6709\u754c\u6570\u636e\u6d41\u3002")),(0,r.kt)("h3",{id:"union"},"Union"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"DataStream","*"," -> DataStream")),(0,r.kt)("p",null,"Union \u53ef\u4ee5\u5c06 ",(0,r.kt)("strong",{parentName:"p"},"\u4e24\u4e2a\u6216\u4ee5\u4e0a")," \u7684\u6570\u636e\u6d41\u5408\u5e76\u6210\u4e00\u4e2a\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"dataStream.union(otherStream1, otherStream2, ...);\n")),(0,r.kt)("h3",{id:"connect"},"Connect"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"DataStream, DataStream -> ConnectedStream")),(0,r.kt)("p",null,"Connect \u53ef\u4ee5\u8fde\u63a5 ",(0,r.kt)("strong",{parentName:"p"},"\u4e24\u4e2a")," \u6570\u636e\u6d41\uff0c\u5e76\u5141\u8bb8\u5728\u4e24\u4e2a\u6d41\u4e4b\u95f4\u5171\u4eab\u72b6\u6001\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"DataStream<Integer> someStream = //...\nDataStream<String> otherStream = //...\n\nConnectedStreams<Integer, String> connectedStreams = someStream.connect(otherStream);\n")),(0,r.kt)("p",null,"Union \u548c Connect \u90fd\u6709\u8fde\u63a5\u3001\u5408\u5e76\u7684\u4f5c\u7528\uff0c\u4f46\u5b9e\u9645\u4e0a\u4e24\u8005\u662f\u6709\u533a\u522b\u7684\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Union \u662f\u591a\u6d41\u5408\u5e76\uff0cConnect \u662f\u53cc\u6d41\u5408\u5e76"),(0,r.kt)("li",{parentName:"ul"},"Union \u8981\u6c42\u5404\u4e2a\u6d41\u7684\u6570\u636e\u7c7b\u578b\u8981\u4e00\u81f4\uff0cConnect \u5141\u8bb8\u4e24\u4e2a\u6d41\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u540c"),(0,r.kt)("li",{parentName:"ul"},"Connect \u5bf9\u88ab\u5408\u5e76\u7684\u6d41\u53ef\u4ee5\u6709\u4e0d\u540c\u7684\u5904\u7406\u903b\u8f91\uff08\u53c2\u8003 CoMap/CoFlatMap\uff09\uff0c\u66f4\u52a0\u7075\u6d3b")),(0,r.kt)("h3",{id:"comap"},"CoMap"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"ConnectedStream -> DataStream")),(0,r.kt)("p",null,"CoMap \u7684\u4f5c\u7528\u540c Map\uff0c\u4f46\u5b83\u662f\u4f5c\u7528\u5728 ConnectedStream \u4e0a\u7684\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"connectedStreams.map(new CoMapFunction<Integer, String, Boolean>() {\n    @Override\n    public Boolean map1(Integer value) {\n        return true;\n    }\n\n    @Override\n    public Boolean map2(String value) {\n        return false;\n    }\n});\n")),(0,r.kt)("h3",{id:"coflatmap"},"CoFlatMap"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"ConnectedStream -> DataStream")),(0,r.kt)("p",null,"CoFlatMap \u7684\u4f5c\u7528\u540c FlatMap\uff0c\u4f46\u5b83\u662f\u4f5c\u7528\u5728 ConnectedStream \u4e0a\u7684\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'connectedStreams.flatMap(new CoFlatMapFunction<Integer, String, String>() {\n   @Override\n   public void flatMap1(Integer value, Collector<String> out) {\n       out.collect(value.toString());\n   }\n\n   @Override\n   public void flatMap2(String value, Collector<String> out) {\n       for (String word: value.split(" ")) {\n         out.collect(word);\n       }\n   }\n});\n')),(0,r.kt)("h2",{id:"partitioner"},"Partitioner"),(0,r.kt)("p",null,"Flink \u5bf9\u6570\u636e\u6d41\u63d0\u4f9b\u4e86\u5206\u533a\u63a7\u5236\u3002",(0,r.kt)("strong",{parentName:"p"},"\u5176\u672c\u8d28\u4e0a\uff0c\u662f\u5c06\u4e0a\u6e38 Subtask \u5904\u7406\u540e\u7684\u6570\u636e\u901a\u8fc7\u6307\u5b9a\u7684\u5206\u533a\u7b56\u7565\u8f93\u51fa\u5230\u4e0b\u6e38\u7684 Subtask\u3002")),(0,r.kt)("h3",{id:"custom"},"Custom"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"DataStream -> DataStream")),(0,r.kt)("p",null,"Flink \u652f\u6301\u7528\u6237\u7f16\u5199\u81ea\u5b9a\u4e49\u7684 Partitioner \u8fdb\u884c\u5143\u7d20\u7684\u5206\u533a\u9009\u62e9\u3002Custom Partitoner \u53ea\u9700\u5b9e\u73b0 Partitioner \u63a5\u53e3\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'dataStream.partitionCustom(partitioner, "someKey");\ndataStream.partitionCustom(partitioner, 0);\n')),(0,r.kt)("h3",{id:"random"},"Random"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"DataStream -> DataStream")),(0,r.kt)("p",null,"Random Partitioner \u4f1a\u6839\u636e\u5747\u5300\u5206\u5e03\u5c06\u6570\u636e\u6d41\u4e2d\u7684\u5143\u7d20\u968f\u673a\u53d1\u5f80\u4e0b\u6e38\u4efb\u610f\u5206\u533a\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"dataStream.shuffle();\n")),(0,r.kt)("h3",{id:"rebalance"},"Rebalance"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"DataStream -> DataStream")),(0,r.kt)("p",null,"Rebalance Partioner \u4e3a ",(0,r.kt)("strong",{parentName:"p"},"\u9ed8\u8ba4\u5206\u533a\u5668"),"\uff0c\u4f1a\u901a\u8fc7\u8f6e\u8be2\u7684\u65b9\u5f0f\u5c06\u5143\u7d20\u53d1\u5f80\u4e0b\u6e38\u5206\u533a\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"dataStream.rebalance();\n")),(0,r.kt)("h3",{id:"rescale"},"Rescale"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"DataStream -> DataStream")),(0,r.kt)("p",null,"Rescale Partioner \u4e5f\u662f\u901a\u8fc7\u8f6e\u8be2\u7684\u65b9\u5f0f\u5c06\u5143\u7d20\u53d1\u5f80\u4e0b\u6e38\u5206\u533a\uff0c",(0,r.kt)("strong",{parentName:"p"},"\u4f46\u5176\u5728\u5206\u533a\u5206\u914d\u4e0a\u4e0e Rebalance \u6709\u7740\u975e\u5e38\u5927\u7684\u5dee\u5f02\u3002")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Rebalance \u4e0d\u7ba1\u4e0a\u4e0b\u6e38\u7b97\u5b50\u5e76\u884c\u5ea6\u4e3a\u591a\u5c11\uff0c\u6bcf\u4e2a\u4e0a\u6e38\u7b97\u5b50\u90fd\u4f1a\u88ab\u5206\u914d\u5230\u6240\u6709\u4e0b\u6e38\u7b97\u5b50\u3002\u800c\u5728 Rescale \u7b56\u7565\u4e2d\uff0c\u6bcf\u4e2a\u4e0a\u6e38\u7b97\u5b50\u53ea\u4f1a\u5206\u914d\u5230\u4e0b\u6e38\u7b97\u5b50\u4e2d\u7684\u67d0\u4e2a\u5b50\u96c6\u3002\u8be5\u5206\u914d\u673a\u5236\u662f\u7531 StreamingJobGraphGenerator \u5728\u5c06 StreamGraph \u8f6c\u6362\u4e3a JobGraph \u65f6\u5b9e\u73b0\u7684\u3002")),(0,r.kt)("p",null,"\u6211\u4eec\u4e3e\u4e2a\u4f8b\u5b50\u3002\u5047\u8bbe\uff0c\u4e0a\u6e38\u5e76\u884c\u5ea6\u662f 2\uff0c\u4e0b\u6e38\u662f 6\uff0c\u90a3\u4e48\u5728 Rescale \u7b56\u7565\u4e0b\uff0c\u4e0a\u6e38\u7684\u4e00\u4e2a\u7b97\u5b50\u4ee5\u5faa\u73af\u7684\u65b9\u5f0f\u5c06\u5143\u7d20\u8f93\u51fa\u5230\u4e0b\u6e38\u7684 3 \u4e2a\u7b97\u5b50\u4e0a\uff0c\u53e6\u4e00\u4e2a\u7b97\u5b50\u4ee5\u5faa\u73af\u7684\u65b9\u5f0f\u5c06\u5143\u7d20\u8f93\u51fa\u5230\u4e0b\u6e38\u5269\u4e0b\u7684 3 \u4e2a\u7b97\u5b50\u4e0a\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{src:a(4179).Z,width:"726",height:"442"})),(0,r.kt)("p",null,"\u82e5\u4e0a\u6e38\u5e76\u884c\u5ea6\u662f 6\uff0c\u4e0b\u6e38\u5e76\u884c\u5ea6\u662f 2\uff0c\u5219\u4e0a\u6e38 3 \u4e2a\u7b97\u5b50\u4f1a\u5c06\u5143\u7d20\u8f93\u51fa\u5230\u4e0b\u6e38\u7684\u4e00\u4e2a\u7b97\u5b50\u4e0a\uff0c\u4e0a\u6e38\u7684\u53e6\u5916 3 \u4e2a\u7b97\u5b50\u4f1a\u5c06\u5143\u7d20\u8f93\u51fa\u5230\u4e0b\u6e38\u7684\u53e6\u4e00\u4e2a\u7b97\u5b50\u4e0a\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"dataStream.rescale();\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"\u5728\u4e0a\u4e0b\u6e38\u7b97\u5b50\u5e76\u884c\u5ea6\u6210\u6bd4\u4f8b\u7684\u60c5\u51b5\u4e0b\uff0cRescale \u4f1a\u8868\u73b0\u5f97\u6bd4 Rebalance \u66f4\u597d\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u51cf\u5c11\u4e0a\u4e0b\u6e38\u7b97\u5b50\u95f4\u6570\u636e\u4f20\u8f93\u6240\u8017\u8d39\u7684\u7f51\u7edc\u5f00\u9500\u3002")),(0,r.kt)("h3",{id:"broadcast"},"Broadcast"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"DataStream -> DataStream")),(0,r.kt)("p",null,"Broadcast Partitioning \u7684\u4f5c\u7528\u6b63\u5982\u5e7f\u64ad\u4e00\u6837\uff0c\u4f1a\u5c06\u6570\u636e\u6d41\u4e2d\u7684\u5143\u7d20\u5206\u53d1\u5230\u4e0b\u6e38\u6bcf\u4e2a\u5206\u533a\u4e2d\uff08\u7c7b\u6bd4 Flume \u4e2d\u7684 Replicating Selector\uff0c\u5982\u679c\u4e0b\u6e38\u5206\u533a\u6570\u4e3a 8\uff0c\u5219\u6d41\u4e2d\u7684\u5143\u7d20\u590d\u5236 8 \u4efd\uff09\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"dataStream.broadcast();\n")),(0,r.kt)("h2",{id:"sink"},"Sink"),(0,r.kt)("p",null,"Sink \u5c42\u8d1f\u8d23\u8ba1\u7b97\u7ed3\u679c\u7684\u8f93\u51fa\u3002\u76f8\u8f83\u4e8e Source\uff0c\u5b98\u65b9\u5bf9 Sink \u7ec4\u4ef6\u7684\u652f\u6301\u66f4\u52a0\u4e30\u5bcc\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u4ee5\u4e0b\uff1aKafka\u3001ElasticSearch\u3001RabbitMQ\u3001HDFS\u3001JDBC\u3001Redis\u3002\u540c\u6837\u5730\uff0cFlink \u4e5f\u652f\u6301\u7528\u6237\u81ea\u5b9a\u4e49 sink\u3002"),(0,r.kt)("h3",{id:"print"},"Print"),(0,r.kt)("p",null,"Print Sink \u7531 PrintSinkFunction \u5b9e\u73b0\uff0c\u652f\u6301\u5c06\u6570\u636e\u8f93\u51fa\u5230\u63a7\u5236\u53f0\uff0c\u901a\u5e38\u7528\u4e8e\u8c03\u8bd5\u9636\u6bb5\u3002\u5b83\u672c\u8d28\u4e0a\u662f\u8c03\u7528\u4e86 PrintStream \u5bf9\u8c61\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"println()")," \u65b9\u6cd5\uff0c\u5373\u6211\u4eec\u5e38\u7528\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"System.out.println()"),"\u3002"),(0,r.kt)("p",null,"\u5176\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"dataStream.print();\n")),(0,r.kt)("p",null,"\u5728 Print Sink \u4e2d\uff0c\u5bf9\u8ba1\u7b97\u7ed3\u679c\u7684\u8f93\u51fa\u683c\u5f0f\u505a\u4e86\u4e00\u5b9a\u7684\u5904\u7406\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u82e5\u5e76\u884c\u5ea6\u4e3a 1\uff0c\u4e0d\u505a\u4efb\u4f55\u5904\u7406"),(0,r.kt)("li",{parentName:"ul"},"\u82e5\u5e76\u884c\u5ea6\u5927\u4e8e 1 \u4e14\u672a\u6307\u5b9a sink \u6807\u8bc6\uff0c\u5219\u6dfb\u52a0\u524d\u7f00 ",(0,r.kt)("inlineCode",{parentName:"li"},"1> ")),(0,r.kt)("li",{parentName:"ul"},"\u82e5\u5e76\u884c\u5ea6\u5927\u4e8e 1 \u4e14\u6307\u5b9a sink \u6807\u8bc6\u4e3a panda\uff0c\u5219\u6dfb\u52a0\u524d\u7f00 ",(0,r.kt)("inlineCode",{parentName:"li"},"panda:1> "))),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"\u4e0a\u8ff0\u524d\u7f00\u4e2d\u7684\u6570\u5b57\uff0c\u7531\u5f53\u524d subtask \u7684\u4e0b\u6807\u52a0\u4e0a\u6570\u5b57 1 \u83b7\u5f97\uff0c\u5373 subtaskIndex + 1\u3002")),(0,r.kt)("h3",{id:"printtoerr"},"PrintToErr"),(0,r.kt)("p",null,"PrintToErr \u4e5f\u662f\u7531 PrintSinkFunction \u5b9e\u73b0\uff0c\u5b83\u4e0e Print \u7684\u533a\u522b\u5728\u4e8e\u8f93\u51fa\u7684\u5b57\u4f53\u989c\u8272\u4e0d\u540c\u3002"),(0,r.kt)("h3",{id:"kafka-1"},"Kafka"),(0,r.kt)("p",null,"\u5b98\u65b9\u63d0\u4f9b\u4e86 Kafka Producer\uff0c\u7528\u4e8e\u5c06\u8ba1\u7b97\u7ed3\u679c\u5199\u5165\u5230 Kafka \u4e2d\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// \u5b9a\u4e49 kafka sink\nProperties produceProperties = new Properties();\nproduceProperties.setProperty(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, KAFKA_BROKER_SERVERS);\nFlinkKafkaProducer<String> kafkaProducer = new FlinkKafkaProducer<>(\n    "test",\n    new SimpleStringSchema(),\n    produceProperties);\n\ndataStream.addSink(kafkaProducer);\n')),(0,r.kt)("h3",{id:"redis"},"Redis"),(0,r.kt)("p",null,"\u5b98\u65b9\u5e76\u672a\u63d0\u4f9b Redis Sink\uff0c\u4f46 Apache Bahir \u63d0\u4f9b\u4e86\u5b9e\u73b0\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public static class RedisExampleMapper implements RedisMapper<Tuple2<String, String>>{\n\n    @Override\n    public RedisCommandDescription getCommandDescription() {\n        return new RedisCommandDescription(RedisCommand.HSET, "HASH_NAME");\n    }\n\n    @Override\n    public String getKeyFromData(Tuple2<String, String> data) {\n        return data.f0;\n    }\n\n    @Override\n    public String getValueFromData(Tuple2<String, String> data) {\n        return data.f1;\n    }\n}\nFlinkJedisPoolConfig conf = new FlinkJedisPoolConfig.Builder().setHost("127.0.0.1").build();\n\nDataStream<String> stream = ...;\nstream.addSink(new RedisSink<Tuple2<String, String>>(conf, new RedisExampleMapper());\n')),(0,r.kt)("p",null,"\u4e0d\u8fc7\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u5b58\u5728\u4e9b\u8bb8\u4e0d\u8db3\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5fc5\u987b\u6309\u7167\u5176\u63a5\u53e3\u89c4\u8303\u8fdb\u884c\u7f16\u7801\uff0c\u7f3a\u5c11\u7075\u6d3b\u6027"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"RedisMapper")," \u5e76\u672a\u7ee7\u627f ",(0,r.kt)("inlineCode",{parentName:"li"},"RichSinkFunction"),"\uff0c\u65e0\u6cd5\u83b7\u53d6\u8fd0\u884c\u73af\u5883\u4e0a\u4e0b\u6587\u7b49\u4fe1\u606f")),(0,r.kt)("p",null,"\u6240\u5e78\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0 Redis Sink\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class MyRedisSink extends RichSinkFunction<Tuple2<String, String>> {\n\n    private static final Logger LOGGER = LoggerFactory.getLogger(MyRedisSink.class);\n\n    private static final String HASH_KEY = "flink-test";\n\n    private Jedis jedis;\n\n    private String key;\n\n    public MyRedisSink() {\n\n    }\n\n    public MyRedisSink(String key) {\n        this.key = key;\n    }\n\n    @Override\n    public void open(Configuration parameters) {\n        this.jedis = new Jedis("192.168.117.128", 6379);\n    }\n\n    @Override\n    public void close() {\n        if (this.jedis != null) {\n            this.jedis.close();\n        }\n    }\n\n    @Override\n    public void invoke(Tuple2<String, String> value, Context context) {\n\n        LOGGER.info("redis sink invoked, key: {}, value: {}", value.f0, value.f1);\n\n        if (StringUtils.isEmpty(key)) {\n            key = HASH_KEY;\n        }\n\n        this.jedis.hset(key, value.f0, value.f1);\n\n    }\n}\n')))}c.isMDXComponent=!0},6552:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/api-2b4c4c19a9e3cfebe4e56ef5ac22a929.png"},4179:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/rescale-c51b2d8ed0f8da2597a6d2bb00716d4f.png"}}]);