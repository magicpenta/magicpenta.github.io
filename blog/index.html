<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Blog | Panda Home</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://magicpenta.github.io/blog"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Blog | Panda Home"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://magicpenta.github.io/blog"><link data-rh="true" rel="alternate" href="https://magicpenta.github.io/blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://magicpenta.github.io/blog" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Panda Home RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Panda Home Atom Feed"><link rel="stylesheet" href="/assets/css/styles.05fef033.css">
<link rel="preload" href="/assets/js/runtime~main.e2f7f3df.js" as="script">
<link rel="preload" href="/assets/js/main.4ed9c8f6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Panda Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Panda Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Panda Home</b></a><a class="navbar__item navbar__link" href="/docs">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about">About</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent Posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/02/15/docusaurus">基于 Docusaurus 搭建自建博客</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/10/08/scala-standard">Scala 代码规范</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/06/15/jenkins">Java 多模块持续集成（Maven 示例）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/07/01/sonarqube">基于 SonarQube 搭建自动化代码检测平台</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/01/my-way">什么都无法舍弃的人，什么也改变不了</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/02/15/docusaurus">基于 Docusaurus 搭建自建博客</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-02-15T00:00:00.000Z" itemprop="datePublished">February 15, 2022</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://magicpenta.github.io" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://magicpenta.github.io/img/logo.svg" alt="Panda"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://magicpenta.github.io" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Panda</span></a></div><small class="avatar__subtitle" itemprop="description">Tencent CSIG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一简介">一、简介<a class="hash-link" href="#一简介" title="Direct link to heading">​</a></h2><p><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer">Docusaurus</a> 是一款静态网站生成器，可以帮助我们快速搭建一个优美的文档网站。</p><p>Docusaurus 的基本特性主要有：</p><ul><li>支持 Markdown</li><li>支持侧边栏</li><li>支持目录导航</li><li>支持提示功能</li><li>支持自定义样式</li><li>……</li></ul><p>此外，Docusaurus 还有一些高级特性：</p><ul><li>支持夜间模式</li><li>支持站内搜索</li><li>支持 SEO 优化</li><li>支持插件扩展</li><li>支持多语言</li><li>支持多版本</li><li>……</li></ul><p>以下为 Docusaurus 的官网截图，我们可以先一睹为快： </p><p><img loading="lazy" src="/assets/images/docusaurus-f29a2376a31ac511ea13d4bbbce8aff4.png" width="2560" height="1302" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二核心组件">二、核心组件<a class="hash-link" href="#二核心组件" title="Direct link to heading">​</a></h2><p>Docusaurus 的核心组件有：Docs、Blog、Pages。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-docs">2.1 Docs<a class="hash-link" href="#21-docs" title="Direct link to heading">​</a></h3><p>Docs 为用户提供了按层级管理 Markdown 文档的功能，由官方插件 <code>@docusaurus/plugin-content-docs</code> 提供支持。</p><p>在 Docs 中，Markdown 文档具有清晰的层级关系，如下图所示：</p><p><img loading="lazy" src="/assets/images/docs-b7e6fea079c1077d590d4e421c75ca46.png" width="2560" height="1302" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-blog">2.2 Blog<a class="hash-link" href="#22-blog" title="Direct link to heading">​</a></h3><p>Blog 即为我们熟知的博客。</p><p>该功能由官方插件 <code>@docusaurus/plugin-content-blog</code> 提供，可以帮助我们快速搭建博客页面。</p><p>下图为 Blog 示例：</p><p><img loading="lazy" src="/assets/images/blog-df8b839d8e620ff01f7506ea56324b54.png" width="2560" height="1302" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-pages">2.3 Pages<a class="hash-link" href="#23-pages" title="Direct link to heading">​</a></h3><p>Pages 指独立的页面，页面之间没有父子关系，由官方插件 <code>@docusaurus/plugin-content-pages</code> 提供支持。</p><p>在 Docusaurus 中，用户可以添加一个 React 页面，也可以添加一个 Markdown 页面。</p><p>下图为 Pages 示例：</p><p><img loading="lazy" src="/assets/images/pages-8b1649537f392abdb0354cbc2922188d.png" width="2560" height="1302" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三使用指南">三、使用指南<a class="hash-link" href="#三使用指南" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-环境准备">3.1 环境准备<a class="hash-link" href="#31-环境准备" title="Direct link to heading">​</a></h3><p>Docusaurus 要求我们预先安装以下组件：</p><ul><li><a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">Node.js</a></li><li><a href="https://yarnpkg.com/" target="_blank" rel="noopener noreferrer">yarn</a></li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>yarn 指的是依赖管理工具，并不是 Hadoop 中的资源管理器 yarn。若本地安装了 Hadoop，注意在环境变量中去掉 yarn 脚本的地址，避免 <code>yarn</code> 命令冲突。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-创建站点">3.2 创建站点<a class="hash-link" href="#32-创建站点" title="Direct link to heading">​</a></h3><p>在任意路径执行以下命令：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx create-docusaurus@latest my-website classic</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>若创建成功，在当前路径下会出现 <code>my-website</code> 目录，且控制台输出如下信息：</p><p><img loading="lazy" src="/assets/images/create-a634e4122d9a9cc2f521fea036ab9428.png" width="2560" height="1390" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-配置说明">3.3 配置说明<a class="hash-link" href="#33-配置说明" title="Direct link to heading">​</a></h3><p><code>my-website</code> 目录下包含多个配置文件，这些配置文件的具体作用可参考下表：</p><table><thead><tr><th>配置文件</th><th>具体说明</th></tr></thead><tbody><tr><td><code>docusaurus.config.js</code></td><td>核心配置文件，包含基础信息配置、插件配置、主题配置等</td></tr><tr><td><code>src/css/custom.css</code></td><td>自定义样式设置</td></tr><tr><td><code>src/pages/index.js</code></td><td>主页标题栏配置</td></tr><tr><td><code>src/components/HomepageFeatures.js</code></td><td>主页特性栏配置</td></tr></tbody></table><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>具体配置项说明请参考官方文档：<a href="https://docusaurus.io/docs/api/docusaurus-config" target="_blank" rel="noopener noreferrer">https://docusaurus.io/docs/api/docusaurus-config</a>。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-快速启动">3.4 快速启动<a class="hash-link" href="#34-快速启动" title="Direct link to heading">​</a></h3><p>进入 <code>my-website</code> 目录，输入以下命令快速启动站点：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx docusaurus start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>若启动正常，则控制台会输出如下信息：</p><p><img loading="lazy" src="/assets/images/start-35bda6876b48a93fee581112d8fb31cc.png" width="1330" height="227" class="img_ev3q"></p><p>此时，我们便可以通过 <a href="http://localhost:3000/" target="_blank" rel="noopener noreferrer">http://localhost:3000/</a> 预览我们的本地站点。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-语法高亮">3.5 语法高亮<a class="hash-link" href="#35-语法高亮" title="Direct link to heading">​</a></h3><p>默认情况下，Docusaurus 未开启 Java、Scala 等语言的语法高亮，需要我们在 <code>docusaurus.config.js</code> 增加如下配置：</p><div class="language-javaScript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javaScript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module.exports = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  themeConfig: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prism: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      additionalLanguages: [&#x27;powershell&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Docusaurus 基于 <a href="https://prismjs.com/#supported-languages" target="_blank" rel="noopener noreferrer">Prism</a> 实现语法高亮。</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四编辑器">四、编辑器<a class="hash-link" href="#四编辑器" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-编辑器选择">4.1 编辑器选择<a class="hash-link" href="#41-编辑器选择" title="Direct link to heading">​</a></h3><p>对于自建博客来说，找到合适的 MD 编辑器是非常重要的一件事，这将会影响到我们的文档编写体验与发布效率。</p><p>若条件允许，我们希望编辑器可以满足以下功能：</p><ul><li>功能一：支持与博客站点相同的文档层级结构</li><li>功能二：支持自定义 CSS，以实现本地的实时预览</li><li>功能三：支持与站点相同的提示功能与语法（Admonition），以实现本地的实时预览</li><li>功能四：支持源文件快速同步</li></ul><p>基于这些功能需求，笔者类比了几款知名 MD 编辑器，得出如下结论：</p><table><thead><tr><th>编辑器</th><th>功能一</th><th>功能二</th><th>功能三</th><th>功能四</th></tr></thead><tbody><tr><td>Mark Text</td><td>✅</td><td>❌</td><td>❌</td><td>❌</td></tr><tr><td>Joplin</td><td>❌</td><td>✅</td><td>✅</td><td>✅</td></tr><tr><td>Obsidian</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr></tbody></table><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Typero 目前已收费，因此不列入比较清单。此外，Obsidian 实际上是支持功能四的，但是需要付费。</p></div></div><p>综合以上，笔者最终选择 Obsidian 作为本地的编辑器，其编辑界面如下图所示：</p><p><img loading="lazy" src="/assets/images/obsidian-73999ce60113ac43a7886eea3080f4c6.png" width="2560" height="1390" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-自定义设置">4.2 自定义设置<a class="hash-link" href="#42-自定义设置" title="Direct link to heading">​</a></h3><p>使用 Obsidian，我们有两个自定义项需要设置。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="421-自定义-css">4.2.1 自定义 CSS<a class="hash-link" href="#421-自定义-css" title="Direct link to heading">​</a></h4><p>自定义 CSS 可以帮助我们复制博客站点的 CSS，使编辑器的预览样式与站点一致。为实现该功能，需要以下步骤：</p><ol><li>在 <code>.obsidian/snippets</code> 目录下创建 <code>custom.css</code> 文件，将博客站点的全部 CSS 复制到该文件中</li><li>通过路径 Settings → Appearance → CSS snippets 进入设置页面，点击按钮启用自定义样式</li></ol><p><img loading="lazy" src="/assets/images/css-1411c7c2ccc93f15bbfdc5646496b08d.png" width="2560" height="1390" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="422-admonition">4.2.2 Admonition<a class="hash-link" href="#422-admonition" title="Direct link to heading">​</a></h4><p>默认情况下，Obsidian 不支持 Admonition。</p><p>为了使 Obsidian 支持 Admonition，我们需要下载 Admonition 插件，然后安装到目录 <code>.obsidian/plugins</code>。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Admonition 的下载地址为：<a href="https://github.com/valentine195/obsidian-admonition" target="_blank" rel="noopener noreferrer">https://github.com/valentine195/obsidian-admonition</a>。</p></div></div><p>安装完成后，进入设置页面，并启用 <code>Enable Non-codeblock Admonitions</code>：</p><p><img loading="lazy" src="/assets/images/admonition-9d0903ad9fbb2d59f75a378bda22d9f7.png" width="2560" height="1390" class="img_ev3q"></p><p>插件支持的提示语法为 <code>!!!</code> 或 <code>???</code>，与博客站点的 <code>:::</code> 不同，因此我们还需要做一些修改。</p><p>打开目录 <code>.obsidian/plugins/obsidian-admonition</code> 下的 <code>main.js</code> 文件，找到其中的 <code>enableMarkdownProcessor</code> 方法，将 <code>TYPE_REGEX</code> 和 <code>END_REGEX</code> 修改为图中所示值：</p><p><img loading="lazy" src="/assets/images/admonition_1-49badb0a64e519f108c124cada86e337.png" width="1284" height="545" class="img_ev3q"></p><p>重启 Obsidian，此时，我们便可以正常使用 Admonition 功能了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="五部署">五、部署<a class="hash-link" href="#五部署" title="Direct link to heading">​</a></h2><p>我们已经完成了 Docusaurus 的本地启动和编辑，现在，我们还需要将它发布到 GitHub Pages。</p><p>发布时，只需在 <code>my-website</code> 目录下输入以下命令：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;GIT_USER=xxx&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;GIT_PASS=xxx&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">yarn</span><span class="token plain"> deploy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中，各参数的说明为：</p><ul><li><code>GIT_USER</code>：用户的 GitHub 账号</li><li><code>GIT_PASS</code>：用户的 GitHub 私有凭证</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p><code>GIT_PASS</code> 并非指密码，而是私有凭证，其生成方式请参考：<a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token" target="_blank" rel="noopener noreferrer">https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token</a>。</p></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/practice">Practice</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/10/08/scala-standard">Scala 代码规范</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-10-08T00:00:00.000Z" itemprop="datePublished">October 8, 2021</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://magicpenta.github.io" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://magicpenta.github.io/img/logo.svg" alt="Panda"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://magicpenta.github.io" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Panda</span></a></div><small class="avatar__subtitle" itemprop="description">Tencent CSIG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一前言">一、前言<a class="hash-link" href="#一前言" title="Direct link to heading">​</a></h2><p>与 Java 不同，Scala 比较小众，没有放之四海而皆准的规范。</p><p>为了使团队在 Scala 项目上的代码尽可能地保持一致，笔者在借鉴 <strong>官方文档</strong>、<strong>开源项目</strong> 的基础上，整理了适用于自身团队的 Scala 代码规范。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二项目创建规约">二、项目创建规约<a class="hash-link" href="#二项目创建规约" title="Direct link to heading">​</a></h2><p>本规约展示了一个在 IDEA 上创建 Scala 项目的流程，以供参考。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-依赖管理">2.1 依赖管理<a class="hash-link" href="#21-依赖管理" title="Direct link to heading">​</a></h3><p>Scala 支持通过 Maven 或 sbt 来管理项目。基于以下因素，我们选择 Maven：</p><ul><li>Scala 开源项目大部分都是通过 Maven 进行管理</li><li>团队成员对 Maven 比较熟悉，学习成本低</li><li>主流持续集成产品对 Maven 支持度比较高</li></ul><p>使用 Maven 创建 Scala 项目时，与  Java 无太大区别，可以通过 archetype 快速创建：</p><p><img loading="lazy" src="/assets/images/new_project-d0d6ebbeccdd44f5c4b360e1098ba579.png" width="1475" height="1062" class="img_ev3q"></p><p>此时，项目仅能创建 Java 类，还无法创建 Scala 类。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-scala-sdk">2.2 Scala SDK<a class="hash-link" href="#22-scala-sdk" title="Direct link to heading">​</a></h3><p>Scala SDK 是 Scala 项目中不可缺少的部分，我们可以在 Project Structure 完成 Scala SDK 的添加。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>若本地没有 Scala SDK，可以点击 <code>+</code> 号，在弹出的对话框中选择对应的 Scala 版本进行下载。</p></div></div><p><img loading="lazy" src="/assets/images/scala_sdk-eaa5767824ebcd02968963a938ee3d04.png" width="1297" height="1062" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-框架支持">2.3 框架支持<a class="hash-link" href="#23-框架支持" title="Direct link to heading">​</a></h3><p>此时，距离完整创建 Scala 项目还差最后一步，即框架支持。</p><p>我们可以右键项目根目录，点击 <code>Add Framework Support</code>，然后会弹出如下对话框：</p><p><img loading="lazy" src="/assets/images/framework_support-4d802d2e241b26f39a289609de685020.png" width="1051" height="438" class="img_ev3q"></p><p>勾选 Scala，点击 OK。此时，Scala 项目创建完毕，可以在项目中新建 Scala 类并进行编码。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三代码风格规约">三、代码风格规约<a class="hash-link" href="#三代码风格规约" title="Direct link to heading">​</a></h2><p>Scala 官方提供了代码风格参考：</p><p><a href="https://docs.scala-lang.org/style/index.html#" target="_blank" rel="noopener noreferrer">https://docs.scala-lang.org/style/index.html</a></p><p>但是，基于文档的规约常常是不安全的，团队中总会有“糊涂蛋”一不小心犯了“错”。为避免这个问题，我们可以引入 <strong>Scalafmt 插件</strong>，以强制的手段保证项目代码风格的一致性。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-scalafmt-安装">3.1 Scalafmt 安装<a class="hash-link" href="#31-scalafmt-安装" title="Direct link to heading">​</a></h3><p>Scalafmt 可以直接在 IDEA 的插件商场中安装。</p><p>安装完成后，需重启 IDEA。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-scalafmt-配置">3.2 Scalafmt 配置<a class="hash-link" href="#32-scalafmt-配置" title="Direct link to heading">​</a></h3><p>Scalafmt 基于 <code>.scalafmt.conf</code> 文件实现配置。</p><p>首先，打开 Settings，进入 <strong>Editor &gt; Code Style &gt; Scala</strong> 界面，将 Formatter 设置为 Scalafmt，如下图所示：</p><p><img loading="lazy" src="/assets/images/scalafmt-bc1f1ad4019a8b47adccbf9d2c62c14a.png" width="1245" height="887" class="img_ev3q"></p><p>然后，在项目根目录下创建 <code>.scalafmt.conf</code> 文件，输入如下内容：</p><div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key attr-name" style="color:#00a4db">maxColumn</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">=</span><span class="token plain"> </span><span class="token value attr-value" style="color:#e3116c">150</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>若配置成功，可在 <strong>Editor &gt; Code Style &gt; Scala</strong> 界面看到如下结果：</p><p><img loading="lazy" src="/assets/images/scalafmt_config-065bd6769f26806114d0cc02c94dc7f0.png" width="1245" height="887" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-变量类型补全">3.3 变量类型补全<a class="hash-link" href="#33-变量类型补全" title="Direct link to heading">​</a></h3><p>在 Scala 中，变量的实际类型可以是不显式指定的。例如，我们可以这样定义字符串类型的变量：</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;panda&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>实际上，它的完整表达式是：</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;panda&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>为了提高代码阅读性，使其他开发人员能快速知晓变量的实际类型，我们规定 <strong>变量类型要完全补全</strong>。</p><p>在 Java 开发中，我们常常使用 <code>.var</code> 实现变量类型自动补全。但是，在 Scala 项目里，<code>.var</code> 补全的内容默认情况下是不显示实际类型的，如下图所示：</p><p><img loading="lazy" src="/assets/images/auto_complete-38a3e72fc3db54cf9bfb00f044bc3fdf.png" width="1002" height="301" class="img_ev3q"></p><p>若想要显示实际类型，需要在 Type Annotations 选项卡中勾选 <code>Local definition</code> 选项，并取消勾选 <code>Type is stable*</code> 选项：</p><p><img loading="lazy" src="/assets/images/type_annotation-e7aa05c314a232929846e67917281d68.png" width="1239" height="856" class="img_ev3q"></p><p>此时，再次使用 <code>.var</code> 进行补全时，会发现变量的实际类型已经自动补上了。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/practice">Practice</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/06/15/jenkins">Java 多模块持续集成（Maven 示例）</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-06-15T00:00:00.000Z" itemprop="datePublished">June 15, 2021</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://magicpenta.github.io" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://magicpenta.github.io/img/logo.svg" alt="Panda"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://magicpenta.github.io" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Panda</span></a></div><small class="avatar__subtitle" itemprop="description">Tencent CSIG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一为什么要用-jenkins">一、为什么要用 Jenkins？<a class="hash-link" href="#一为什么要用-jenkins" title="Direct link to heading">​</a></h2><p>目前，我们在持续集成上使用的是 GitLab 自带的 gitlab-ci。它支持自动化完成代码编译、镜像构建与镜像推送，减少开发人员在项目构建上的时间开销。</p><p>但是，gitlab-ci 有一个明显的缺陷：在遇到多模块项目时（如基于 SpringBoot 搭建的微服务项目），它显得有些无力。具体表现为，<strong>gitlab-ci 不支持多管道，每当项目中某个模块的代码有新的提交，gitlab-ci 都会触发全项目的自动构建，而无法仅针对产生变动的子模块进行构建</strong>。当项目规模较大时，这种构建方式会导致自动构建的代价非常大。</p><p>而在这种场景下，Jenkins 可以很好地实现我们的需求。当代码提交触发构建事件时，Jenkins 可以筛选出产生变动的子模块，并对这些子模块进行构建与打包，使我们的自动化构建变得精准而优雅。</p><p>下图为 Jenkins 持续集成的工作流示意图：</p><p><img loading="lazy" src="data:image/svg+xml;base64,PHN2ZyBpZD0ic3ZnIiB3aWR0aD0iODUwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iNDc5IiB2aWV3Qm94PSItNTAgLTEwIDg1MCA0NzkiPjxzdHlsZT4jc3Zne2ZvbnQtZmFtaWx5OiJ0cmVidWNoZXQgbXMiLHZlcmRhbmEsYXJpYWwsc2Fucy1zZXJpZjtmb250LXNpemU6MTZweDtmaWxsOiMzMzM7fSNzdmcgLmVycm9yLWljb257ZmlsbDojNTUyMjIyO30jc3ZnIC5lcnJvci10ZXh0e2ZpbGw6IzU1MjIyMjtzdHJva2U6IzU1MjIyMjt9I3N2ZyAuZWRnZS10aGlja25lc3Mtbm9ybWFse3N0cm9rZS13aWR0aDoycHg7fSNzdmcgLmVkZ2UtdGhpY2tuZXNzLXRoaWNre3N0cm9rZS13aWR0aDozLjVweDt9I3N2ZyAuZWRnZS1wYXR0ZXJuLXNvbGlke3N0cm9rZS1kYXNoYXJyYXk6MDt9I3N2ZyAuZWRnZS1wYXR0ZXJuLWRhc2hlZHtzdHJva2UtZGFzaGFycmF5OjM7fSNzdmcgLmVkZ2UtcGF0dGVybi1kb3R0ZWR7c3Ryb2tlLWRhc2hhcnJheToyO30jc3ZnIC5tYXJrZXJ7ZmlsbDojMzMzMzMzO3N0cm9rZTojMzMzMzMzO30jc3ZnIC5tYXJrZXIuY3Jvc3N7c3Ryb2tlOiMzMzMzMzM7fSNzdmcgc3Zne2ZvbnQtZmFtaWx5OiJ0cmVidWNoZXQgbXMiLHZlcmRhbmEsYXJpYWwsc2Fucy1zZXJpZjtmb250LXNpemU6MTZweDt9I3N2ZyAuYWN0b3J7c3Ryb2tlOmhzbCgyNTkuNjI2MTY4MjI0Myw1OS43NzY1MzYzMTI4JSw4Ny45MDE5NjA3ODQzJSk7ZmlsbDojRUNFQ0ZGO30jc3ZnIHRleHQuYWN0b3IgJmd0OyB0c3BhbntmaWxsOmJsYWNrO3N0cm9rZTpub25lO30jc3ZnIC5hY3Rvci1saW5le3N0cm9rZTpncmV5O30jc3ZnIC5tZXNzYWdlTGluZTB7c3Ryb2tlLXdpZHRoOjEuNTtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlOiMzMzM7fSNzdmcgLm1lc3NhZ2VMaW5lMXtzdHJva2Utd2lkdGg6MS41O3N0cm9rZS1kYXNoYXJyYXk6MiwyO3N0cm9rZTojMzMzO30jc3ZnICNhcnJvd2hlYWQgcGF0aHtmaWxsOiMzMzM7c3Ryb2tlOiMzMzM7fSNzdmcgLnNlcXVlbmNlTnVtYmVye2ZpbGw6d2hpdGU7fSNzdmcgI3NlcXVlbmNlbnVtYmVye2ZpbGw6IzMzMzt9I3N2ZyAjY3Jvc3NoZWFkIHBhdGh7ZmlsbDojMzMzO3N0cm9rZTojMzMzO30jc3ZnIC5tZXNzYWdlVGV4dHtmaWxsOiMzMzM7c3Ryb2tlOiMzMzM7fSNzdmcgLmxhYmVsQm94e3N0cm9rZTpoc2woMjU5LjYyNjE2ODIyNDMsNTkuNzc2NTM2MzEyOCUsODcuOTAxOTYwNzg0MyUpO2ZpbGw6I0VDRUNGRjt9I3N2ZyAubGFiZWxUZXh0LCNzdmcgLmxhYmVsVGV4dCAmZ3Q7IHRzcGFue2ZpbGw6YmxhY2s7c3Ryb2tlOm5vbmU7fSNzdmcgLmxvb3BUZXh0LCNzdmcgLmxvb3BUZXh0ICZndDsgdHNwYW57ZmlsbDpibGFjaztzdHJva2U6bm9uZTt9I3N2ZyAubG9vcExpbmV7c3Ryb2tlLXdpZHRoOjJweDtzdHJva2UtZGFzaGFycmF5OjIsMjtzdHJva2U6aHNsKDI1OS42MjYxNjgyMjQzLDU5Ljc3NjUzNjMxMjglLDg3LjkwMTk2MDc4NDMlKTtmaWxsOmhzbCgyNTkuNjI2MTY4MjI0Myw1OS43NzY1MzYzMTI4JSw4Ny45MDE5NjA3ODQzJSk7fSNzdmcgLm5vdGV7c3Ryb2tlOiNhYWFhMzM7ZmlsbDojZmZmNWFkO30jc3ZnIC5ub3RlVGV4dCwjc3ZnIC5ub3RlVGV4dCAmZ3Q7IHRzcGFue2ZpbGw6YmxhY2s7c3Ryb2tlOm5vbmU7fSNzdmcgLmFjdGl2YXRpb24we2ZpbGw6I2Y0ZjRmNDtzdHJva2U6IzY2Njt9I3N2ZyAuYWN0aXZhdGlvbjF7ZmlsbDojZjRmNGY0O3N0cm9rZTojNjY2O30jc3ZnIC5hY3RpdmF0aW9uMntmaWxsOiNmNGY0ZjQ7c3Ryb2tlOiM2NjY7fSNzdmcgLnRvZGF5e2Rpc3BsYXk6bm9uZTt9I3N2ZyAubGFiZWwgZm9yZWlnbk9iamVjdHtvdmVyZmxvdzp2aXNpYmxlO30jc3ZnOnJvb3R7LS1tZXJtYWlkLWZvbnQtZmFtaWx5OiJ0cmVidWNoZXQgbXMiLHZlcmRhbmEsYXJpYWwsc2Fucy1zZXJpZjt9I3N2ZyBzZXF1ZW5jZXtmaWxsOmFwYTt9PC9zdHlsZT48Zz48L2c+PGc+PGxpbmUgaWQ9ImFjdG9yMCIgeDE9Ijc1IiB5MT0iNSIgeDI9Ijc1IiB5Mj0iNDY4IiBjbGFzcz0iYWN0b3ItbGluZSIgc3Ryb2tlLXdpZHRoPSIwLjVweCIgc3Ryb2tlPSIjOTk5Ij48L2xpbmU+PHJlY3QgeD0iMCIgeT0iMCIgZmlsbD0iI2VhZWFlYSIgc3Ryb2tlPSIjNjY2IiB3aWR0aD0iMTUwIiBoZWlnaHQ9IjY1IiByeD0iMyIgcnk9IjMiIGNsYXNzPSJhY3RvciI+PC9yZWN0Pjx0ZXh0IHg9Ijc1IiB5PSIzMi41IiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgYWxpZ25tZW50LWJhc2VsaW5lPSJjZW50cmFsIiBjbGFzcz0iYWN0b3IiIHN0eWxlPSJ0ZXh0LWFuY2hvcjogbWlkZGxlOyBmb250LXNpemU6IDE0cHg7IGZvbnQtd2VpZ2h0OiA0MDA7IGZvbnQtZmFtaWx5OiBPcGVuLVNhbnMsIHNhbnMtc2VyaWY7Ij48dHNwYW4geD0iNzUiIGR5PSIwIj7lupTnlKjnqIvluo88L3RzcGFuPjwvdGV4dD48L2c+PGc+PGxpbmUgaWQ9ImFjdG9yMSIgeDE9IjI3NSIgeTE9IjUiIHgyPSIyNzUiIHkyPSI0NjgiIGNsYXNzPSJhY3Rvci1saW5lIiBzdHJva2Utd2lkdGg9IjAuNXB4IiBzdHJva2U9IiM5OTkiPjwvbGluZT48cmVjdCB4PSIyMDAiIHk9IjAiIGZpbGw9IiNlYWVhZWEiIHN0cm9rZT0iIzY2NiIgd2lkdGg9IjE1MCIgaGVpZ2h0PSI2NSIgcng9IjMiIHJ5PSIzIiBjbGFzcz0iYWN0b3IiPjwvcmVjdD48dGV4dCB4PSIyNzUiIHk9IjMyLjUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIiBhbGlnbm1lbnQtYmFzZWxpbmU9ImNlbnRyYWwiIGNsYXNzPSJhY3RvciIgc3R5bGU9InRleHQtYW5jaG9yOiBtaWRkbGU7IGZvbnQtc2l6ZTogMTRweDsgZm9udC13ZWlnaHQ6IDQwMDsgZm9udC1mYW1pbHk6IE9wZW4tU2Fucywgc2Fucy1zZXJpZjsiPjx0c3BhbiB4PSIyNzUiIGR5PSIwIj5HaXRMYWI8L3RzcGFuPjwvdGV4dD48L2c+PGc+PGxpbmUgaWQ9ImFjdG9yMiIgeDE9IjQ3NSIgeTE9IjUiIHgyPSI0NzUiIHkyPSI0NjgiIGNsYXNzPSJhY3Rvci1saW5lIiBzdHJva2Utd2lkdGg9IjAuNXB4IiBzdHJva2U9IiM5OTkiPjwvbGluZT48cmVjdCB4PSI0MDAiIHk9IjAiIGZpbGw9IiNlYWVhZWEiIHN0cm9rZT0iIzY2NiIgd2lkdGg9IjE1MCIgaGVpZ2h0PSI2NSIgcng9IjMiIHJ5PSIzIiBjbGFzcz0iYWN0b3IiPjwvcmVjdD48dGV4dCB4PSI0NzUiIHk9IjMyLjUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIiBhbGlnbm1lbnQtYmFzZWxpbmU9ImNlbnRyYWwiIGNsYXNzPSJhY3RvciIgc3R5bGU9InRleHQtYW5jaG9yOiBtaWRkbGU7IGZvbnQtc2l6ZTogMTRweDsgZm9udC13ZWlnaHQ6IDQwMDsgZm9udC1mYW1pbHk6IE9wZW4tU2Fucywgc2Fucy1zZXJpZjsiPjx0c3BhbiB4PSI0NzUiIGR5PSIwIj5KZW5raW5zPC90c3Bhbj48L3RleHQ+PC9nPjxnPjxsaW5lIGlkPSJhY3RvcjMiIHgxPSI2NzUiIHkxPSI1IiB4Mj0iNjc1IiB5Mj0iNDY4IiBjbGFzcz0iYWN0b3ItbGluZSIgc3Ryb2tlLXdpZHRoPSIwLjVweCIgc3Ryb2tlPSIjOTk5Ij48L2xpbmU+PHJlY3QgeD0iNjAwIiB5PSIwIiBmaWxsPSIjZWFlYWVhIiBzdHJva2U9IiM2NjYiIHdpZHRoPSIxNTAiIGhlaWdodD0iNjUiIHJ4PSIzIiByeT0iMyIgY2xhc3M9ImFjdG9yIj48L3JlY3Q+PHRleHQgeD0iNjc1IiB5PSIzMi41IiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgYWxpZ25tZW50LWJhc2VsaW5lPSJjZW50cmFsIiBjbGFzcz0iYWN0b3IiIHN0eWxlPSJ0ZXh0LWFuY2hvcjogbWlkZGxlOyBmb250LXNpemU6IDE0cHg7IGZvbnQtd2VpZ2h0OiA0MDA7IGZvbnQtZmFtaWx5OiBPcGVuLVNhbnMsIHNhbnMtc2VyaWY7Ij48dHNwYW4geD0iNjc1IiBkeT0iMCI+RG9ja2VyIEh1YjwvdHNwYW4+PC90ZXh0PjwvZz48ZGVmcz48bWFya2VyIGlkPSJhcnJvd2hlYWQiIHJlZlg9IjkiIHJlZlk9IjUiIG1hcmtlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgbWFya2VyV2lkdGg9IjEyIiBtYXJrZXJIZWlnaHQ9IjEyIiBvcmllbnQ9ImF1dG8iPjxwYXRoIGQ9Ik0gMCAwIEwgMTAgNSBMIDAgMTAgeiI+PC9wYXRoPjwvbWFya2VyPjwvZGVmcz48ZGVmcz48bWFya2VyIGlkPSJjcm9zc2hlYWQiIG1hcmtlcldpZHRoPSIxNSIgbWFya2VySGVpZ2h0PSI4IiBvcmllbnQ9ImF1dG8iIHJlZlg9IjE2IiByZWZZPSI0Ij48cGF0aCBmaWxsPSJibGFjayIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjFweCIgZD0iTSA5LDIgViA2IEwxNiw0IFoiIHN0eWxlPSJzdHJva2UtZGFzaGFycmF5OiAwLCAwOyI+PC9wYXRoPjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSIxcHgiIGQ9Ik0gMCwxIEwgNiw3IE0gNiwxIEwgMCw3IiBzdHlsZT0ic3Ryb2tlLWRhc2hhcnJheTogMCwgMDsiPjwvcGF0aD48L21hcmtlcj48L2RlZnM+PGRlZnM+PG1hcmtlciBpZD0iZmlsbGVkLWhlYWQiIHJlZlg9IjE4IiByZWZZPSI3IiBtYXJrZXJXaWR0aD0iMjAiIG1hcmtlckhlaWdodD0iMjgiIG9yaWVudD0iYXV0byI+PHBhdGggZD0iTSAxOCw3IEw5LDEzIEwxNCw3IEw5LDEgWiI+PC9wYXRoPjwvbWFya2VyPjwvZGVmcz48ZGVmcz48bWFya2VyIGlkPSJzZXF1ZW5jZW51bWJlciIgcmVmWD0iMTUiIHJlZlk9IjE1IiBtYXJrZXJXaWR0aD0iNjAiIG1hcmtlckhlaWdodD0iNDAiIG9yaWVudD0iYXV0byI+PGNpcmNsZSBjeD0iMTUiIGN5PSIxNSIgcj0iNiI+PC9jaXJjbGU+PC9tYXJrZXI+PC9kZWZzPjx0ZXh0IHg9IjE3NSIgeT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGFsaWdubWVudC1iYXNlbGluZT0ibWlkZGxlIiBjbGFzcz0ibWVzc2FnZVRleHQiIGR5PSIxZW0iIHN0eWxlPSJmb250LWZhbWlseTogJnF1b3Q7dHJlYnVjaGV0IG1zJnF1b3Q7LCB2ZXJkYW5hLCBhcmlhbCwgc2Fucy1zZXJpZjsgZm9udC1zaXplOiAxNnB4OyBmb250LXdlaWdodDogNDAwOyI+5Luj56CB5o+Q5LqkPC90ZXh0PjxsaW5lIHgxPSI3NSIgeTE9IjExMyIgeDI9IjI3NSIgeTI9IjExMyIgY2xhc3M9Im1lc3NhZ2VMaW5lMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2U9Im5vbmUiIG1hcmtlci1lbmQ9InVybCgjYXJyb3doZWFkKSIgbWFya2VyLXN0YXJ0PSJ1cmwoI3NlcXVlbmNlbnVtYmVyKSIgc3R5bGU9ImZpbGw6IG5vbmU7Ij48L2xpbmU+PHRleHQgeD0iNzUiIHk9IjExNyIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgdGV4dExlbmd0aD0iMTZweCIgY2xhc3M9InNlcXVlbmNlTnVtYmVyIj4xPC90ZXh0Pjx0ZXh0IHg9IjM3NSIgeT0iMTI4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBhbGlnbm1lbnQtYmFzZWxpbmU9Im1pZGRsZSIgY2xhc3M9Im1lc3NhZ2VUZXh0IiBkeT0iMWVtIiBzdHlsZT0iZm9udC1mYW1pbHk6ICZxdW90O3RyZWJ1Y2hldCBtcyZxdW90OywgdmVyZGFuYSwgYXJpYWwsIHNhbnMtc2VyaWY7IGZvbnQtc2l6ZTogMTZweDsgZm9udC13ZWlnaHQ6IDQwMDsiPuaOqOmAgeinpuWPkeS6i+S7tjwvdGV4dD48bGluZSB4MT0iMjc1IiB5MT0iMTYxIiB4Mj0iNDc1IiB5Mj0iMTYxIiBjbGFzcz0ibWVzc2FnZUxpbmUwIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZT0ibm9uZSIgbWFya2VyLWVuZD0idXJsKCNhcnJvd2hlYWQpIiBtYXJrZXItc3RhcnQ9InVybCgjc2VxdWVuY2VudW1iZXIpIiBzdHlsZT0iZmlsbDogbm9uZTsiPjwvbGluZT48dGV4dCB4PSIyNzUiIHk9IjE2NSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgdGV4dExlbmd0aD0iMTZweCIgY2xhc3M9InNlcXVlbmNlTnVtYmVyIj4yPC90ZXh0Pjx0ZXh0IHg9IjM3NSIgeT0iMTc2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBhbGlnbm1lbnQtYmFzZWxpbmU9Im1pZGRsZSIgY2xhc3M9Im1lc3NhZ2VUZXh0IiBkeT0iMWVtIiBzdHlsZT0iZm9udC1mYW1pbHk6ICZxdW90O3RyZWJ1Y2hldCBtcyZxdW90OywgdmVyZGFuYSwgYXJpYWwsIHNhbnMtc2VyaWY7IGZvbnQtc2l6ZTogMTZweDsgZm9udC13ZWlnaHQ6IDQwMDsiPuWPkei1t+S7o+eggeaLieWPluivt+axgjwvdGV4dD48bGluZSB4MT0iNDc1IiB5MT0iMjA5IiB4Mj0iMjc1IiB5Mj0iMjA5IiBjbGFzcz0ibWVzc2FnZUxpbmUwIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZT0ibm9uZSIgbWFya2VyLWVuZD0idXJsKCNhcnJvd2hlYWQpIiBtYXJrZXItc3RhcnQ9InVybCgjc2VxdWVuY2VudW1iZXIpIiBzdHlsZT0iZmlsbDogbm9uZTsiPjwvbGluZT48dGV4dCB4PSI0NzUiIHk9IjIxMyIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgdGV4dExlbmd0aD0iMTZweCIgY2xhc3M9InNlcXVlbmNlTnVtYmVyIj4zPC90ZXh0Pjx0ZXh0IHg9IjM3NSIgeT0iMjI0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBhbGlnbm1lbnQtYmFzZWxpbmU9Im1pZGRsZSIgY2xhc3M9Im1lc3NhZ2VUZXh0IiBkeT0iMWVtIiBzdHlsZT0iZm9udC1mYW1pbHk6ICZxdW90O3RyZWJ1Y2hldCBtcyZxdW90OywgdmVyZGFuYSwgYXJpYWwsIHNhbnMtc2VyaWY7IGZvbnQtc2l6ZTogMTZweDsgZm9udC13ZWlnaHQ6IDQwMDsiPuaOqOmAgeS7o+eggTwvdGV4dD48bGluZSB4MT0iMjc1IiB5MT0iMjU3IiB4Mj0iNDc1IiB5Mj0iMjU3IiBjbGFzcz0ibWVzc2FnZUxpbmUwIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZT0ibm9uZSIgbWFya2VyLWVuZD0idXJsKCNhcnJvd2hlYWQpIiBtYXJrZXItc3RhcnQ9InVybCgjc2VxdWVuY2VudW1iZXIpIiBzdHlsZT0iZmlsbDogbm9uZTsiPjwvbGluZT48dGV4dCB4PSIyNzUiIHk9IjI2MSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTJweCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgdGV4dExlbmd0aD0iMTZweCIgY2xhc3M9InNlcXVlbmNlTnVtYmVyIj40PC90ZXh0Pjx0ZXh0IHg9IjQ3NSIgeT0iMjcyIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiBhbGlnbm1lbnQtYmFzZWxpbmU9Im1pZGRsZSIgY2xhc3M9Im1lc3NhZ2VUZXh0IiBkeT0iMWVtIiBzdHlsZT0iZm9udC1mYW1pbHk6ICZxdW90O3RyZWJ1Y2hldCBtcyZxdW90OywgdmVyZGFuYSwgYXJpYWwsIHNhbnMtc2VyaWY7IGZvbnQtc2l6ZTogMTZweDsgZm9udC13ZWlnaHQ6IDQwMDsiPue8luivkeS7o+eggeW5tuaehOW7uumVnOWDjzwvdGV4dD48cGF0aCBkPSJNIDQ3NSwzMDUgQyA1MzUsMjk1IDUzNSwzMzUgNDc1LDMyNSIgY2xhc3M9Im1lc3NhZ2VMaW5lMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2U9Im5vbmUiIG1hcmtlci1lbmQ9InVybCgjYXJyb3doZWFkKSIgbWFya2VyLXN0YXJ0PSJ1cmwoI3NlcXVlbmNlbnVtYmVyKSIgc3R5bGU9ImZpbGw6IG5vbmU7Ij48L3BhdGg+PHRleHQgeD0iNDc1IiB5PSIzMDkiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIHRleHRMZW5ndGg9IjE2cHgiIGNsYXNzPSJzZXF1ZW5jZU51bWJlciI+NTwvdGV4dD48dGV4dCB4PSI1NzUiIHk9IjM1MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGNsYXNzPSJtZXNzYWdlVGV4dCIgZHk9IjFlbSIgc3R5bGU9ImZvbnQtZmFtaWx5OiAmcXVvdDt0cmVidWNoZXQgbXMmcXVvdDssIHZlcmRhbmEsIGFyaWFsLCBzYW5zLXNlcmlmOyBmb250LXNpemU6IDE2cHg7IGZvbnQtd2VpZ2h0OiA0MDA7Ij7mjqjpgIHplZzlg488L3RleHQ+PGxpbmUgeDE9IjQ3NSIgeTE9IjM4MyIgeDI9IjY3NSIgeTI9IjM4MyIgY2xhc3M9Im1lc3NhZ2VMaW5lMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2U9Im5vbmUiIG1hcmtlci1lbmQ9InVybCgjYXJyb3doZWFkKSIgbWFya2VyLXN0YXJ0PSJ1cmwoI3NlcXVlbmNlbnVtYmVyKSIgc3R5bGU9ImZpbGw6IG5vbmU7Ij48L2xpbmU+PHRleHQgeD0iNDc1IiB5PSIzODciIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEycHgiIHRleHQtYW5jaG9yPSJtaWRkbGUiIHRleHRMZW5ndGg9IjE2cHgiIGNsYXNzPSJzZXF1ZW5jZU51bWJlciI+NjwvdGV4dD48Zz48cmVjdCB4PSIwIiB5PSI0MDMiIGZpbGw9IiNlYWVhZWEiIHN0cm9rZT0iIzY2NiIgd2lkdGg9IjE1MCIgaGVpZ2h0PSI2NSIgcng9IjMiIHJ5PSIzIiBjbGFzcz0iYWN0b3IiPjwvcmVjdD48dGV4dCB4PSI3NSIgeT0iNDM1LjUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIiBhbGlnbm1lbnQtYmFzZWxpbmU9ImNlbnRyYWwiIGNsYXNzPSJhY3RvciIgc3R5bGU9InRleHQtYW5jaG9yOiBtaWRkbGU7IGZvbnQtc2l6ZTogMTRweDsgZm9udC13ZWlnaHQ6IDQwMDsgZm9udC1mYW1pbHk6IE9wZW4tU2Fucywgc2Fucy1zZXJpZjsiPjx0c3BhbiB4PSI3NSIgZHk9IjAiPuW6lOeUqOeoi+W6jzwvdHNwYW4+PC90ZXh0PjwvZz48Zz48cmVjdCB4PSIyMDAiIHk9IjQwMyIgZmlsbD0iI2VhZWFlYSIgc3Ryb2tlPSIjNjY2IiB3aWR0aD0iMTUwIiBoZWlnaHQ9IjY1IiByeD0iMyIgcnk9IjMiIGNsYXNzPSJhY3RvciI+PC9yZWN0Pjx0ZXh0IHg9IjI3NSIgeT0iNDM1LjUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIiBhbGlnbm1lbnQtYmFzZWxpbmU9ImNlbnRyYWwiIGNsYXNzPSJhY3RvciIgc3R5bGU9InRleHQtYW5jaG9yOiBtaWRkbGU7IGZvbnQtc2l6ZTogMTRweDsgZm9udC13ZWlnaHQ6IDQwMDsgZm9udC1mYW1pbHk6IE9wZW4tU2Fucywgc2Fucy1zZXJpZjsiPjx0c3BhbiB4PSIyNzUiIGR5PSIwIj5HaXRMYWI8L3RzcGFuPjwvdGV4dD48L2c+PGc+PHJlY3QgeD0iNDAwIiB5PSI0MDMiIGZpbGw9IiNlYWVhZWEiIHN0cm9rZT0iIzY2NiIgd2lkdGg9IjE1MCIgaGVpZ2h0PSI2NSIgcng9IjMiIHJ5PSIzIiBjbGFzcz0iYWN0b3IiPjwvcmVjdD48dGV4dCB4PSI0NzUiIHk9IjQzNS41IiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgYWxpZ25tZW50LWJhc2VsaW5lPSJjZW50cmFsIiBjbGFzcz0iYWN0b3IiIHN0eWxlPSJ0ZXh0LWFuY2hvcjogbWlkZGxlOyBmb250LXNpemU6IDE0cHg7IGZvbnQtd2VpZ2h0OiA0MDA7IGZvbnQtZmFtaWx5OiBPcGVuLVNhbnMsIHNhbnMtc2VyaWY7Ij48dHNwYW4geD0iNDc1IiBkeT0iMCI+SmVua2luczwvdHNwYW4+PC90ZXh0PjwvZz48Zz48cmVjdCB4PSI2MDAiIHk9IjQwMyIgZmlsbD0iI2VhZWFlYSIgc3Ryb2tlPSIjNjY2IiB3aWR0aD0iMTUwIiBoZWlnaHQ9IjY1IiByeD0iMyIgcnk9IjMiIGNsYXNzPSJhY3RvciI+PC9yZWN0Pjx0ZXh0IHg9IjY3NSIgeT0iNDM1LjUiIGRvbWluYW50LWJhc2VsaW5lPSJjZW50cmFsIiBhbGlnbm1lbnQtYmFzZWxpbmU9ImNlbnRyYWwiIGNsYXNzPSJhY3RvciIgc3R5bGU9InRleHQtYW5jaG9yOiBtaWRkbGU7IGZvbnQtc2l6ZTogMTRweDsgZm9udC13ZWlnaHQ6IDQwMDsgZm9udC1mYW1pbHk6IE9wZW4tU2Fucywgc2Fucy1zZXJpZjsiPjx0c3BhbiB4PSI2NzUiIGR5PSIwIj5Eb2NrZXIgSHViPC90c3Bhbj48L3RleHQ+PC9nPjwvc3ZnPg==" width="850" height="479" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二jenkins-安装与部署">二、Jenkins 安装与部署<a class="hash-link" href="#二jenkins-安装与部署" title="Direct link to heading">​</a></h2><p>本节将介绍 Jenkins 的安装与部署。若只想了解流水线的构建，可以直接跳过本节内容。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-环境准备">2.1 环境准备<a class="hash-link" href="#21-环境准备" title="Direct link to heading">​</a></h3><p>我们将采用 Docker 的方式部署 Jenkins，因此，部署前需在宿主机完成 Docker 环境的搭建。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Docker 环境搭建不作为本文分享内容，请自行实现。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-基础镜像">2.2 基础镜像<a class="hash-link" href="#22-基础镜像" title="Direct link to heading">​</a></h3><p>Jenkins 官方已提供现成的 Docker 镜像 <code>jenkinsci/blueocean</code>，该镜像内已包含以下组件：</p><ul><li>Docker</li><li>Java</li><li>Git</li></ul><p>但是我们不能直接使用它，因为它并未安装常用的构建工具（如 Maven、Gradle 等）。</p><p>为解决这个问题，我们可以参考以下 Dockerfile 文件，构建符合我们自身需求的 Jenkins 镜像：</p><div class="language-docker codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-docker codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token instruction keyword" style="color:#00009f">FROM</span><span class="token instruction"> jenkinsci/blueocean:1.24.7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">MAINTAINER</span><span class="token instruction"> pentaxie@qq.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ARG</span><span class="token instruction"> BASE_DIR=/opt/maven</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">USER</span><span class="token instruction"> root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ADD</span><span class="token instruction"> apache-maven-3.6.3-bin.tar.gz </span><span class="token instruction variable" style="color:#36acaa">${BASE_DIR}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ADD</span><span class="token instruction"> settings.xml </span><span class="token instruction variable" style="color:#36acaa">${BASE_DIR}</span><span class="token instruction">/apache-maven-3.6.3/conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> [</span><span class="token instruction string" style="color:#e3116c">&quot;cp&quot;</span><span class="token instruction">,</span><span class="token instruction string" style="color:#e3116c">&quot;/usr/share/zoneinfo/Asia/Shanghai&quot;</span><span class="token instruction">,</span><span class="token instruction string" style="color:#e3116c">&quot;/etc/localtime&quot;</span><span class="token instruction">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENV</span><span class="token instruction"> M2_HOME=</span><span class="token instruction variable" style="color:#36acaa">${BASE_DIR}</span><span class="token instruction">/apache-maven-3.6.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENV</span><span class="token instruction"> PATH=</span><span class="token instruction variable" style="color:#36acaa">$PATH</span><span class="token instruction">:</span><span class="token instruction variable" style="color:#36acaa">$M2_HOME</span><span class="token instruction">/bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>该镜像在官方镜像的基础上，安装了 Maven，并相应地修改了 Maven 配置文件。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-启动-jenkins">2.3 启动 Jenkins<a class="hash-link" href="#23-启动-jenkins" title="Direct link to heading">​</a></h3><p>完成 Jenkins 基础镜像的构建后，我们可以直接使用 Docker 命令启动容器：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-u</span><span class="token plain"> root </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">38080</span><span class="token plain">:8080 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /data/test/jenkins-data:/var/jenkins_home </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-v</span><span class="token plain"> /var/run/docker.sock:/var/run/docker.sock </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hub.panda.com/dc-jenkins:2.289</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中，两个 <code>-v</code> 需要了解其作用：</p><ul><li>第一个 <code>-v</code> 表示将 Jenkins 的安装及数据存储目录挂载到宿主机，下次我们重启 Jenkins 的 Docker 容器时，Jenkins 中的数据才得以保留</li><li>第二个 <code>-v</code> 表示支持容器内的 Docker 客户端直接使用宿主机的 Docker 服务，这样我们在容器内执行构建命令时，实际上是在宿主机构建镜像</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-插件安装">2.4 插件安装<a class="hash-link" href="#24-插件安装" title="Direct link to heading">​</a></h3><p>Jenkins 启动后，首先需要安装社区推荐的插件。</p><p>除此之外，我们还需要在 <strong>插件管理</strong> 界面自行安装以下插件：</p><ul><li>GitLab</li><li>Maven Integration</li><li>Pathignore</li></ul><p>上述插件的主要功能为：</p><table><thead><tr><th><strong>插件名称</strong></th><th><strong>主要功能</strong></th></tr></thead><tbody><tr><td>GitLab</td><td>支持 GitLab Token 的配置</td></tr><tr><td>Maven Integration</td><td>Maven 集成插件，支持在流水线中创建 Maven Project</td></tr><tr><td>Pathignore</td><td>路径过滤插件，支持子模块过滤（实现多模块持续集成的关键）</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-必要配置">2.5 必要配置<a class="hash-link" href="#25-必要配置" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="251-gitlab-token-设置">2.5.1 GitLab Token 设置<a class="hash-link" href="#251-gitlab-token-设置" title="Direct link to heading">​</a></h4><p>安装完 GitLab 插件后，需要在 <strong>系统管理 - 系统设置</strong> 页面添加 GitLab Token。</p><p>GitLab Token 是 GitLab 提供的身份验证的令牌，其生成方式可参考下图：</p><p><img loading="lazy" src="/assets/images/gitlab_token_1-67f6e9360d5db41ec0c3fbad3267c3db.jpg" width="2529" height="1078" class="img_ev3q"></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>该 Token 尽可能赋予足够的权限，避免后续 Jenkins 集成出现权限不足的情况。</p></div></div><p><img loading="lazy" src="/assets/images/gitlab_token_add-d2d76bd6ad6e1634970ce5b4ebbf98ea.jpg" width="1902" height="754" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/gitlab_token-c8ea1b277f8ea397a9af5390efea5108.jpg" width="2106" height="741" class="img_ev3q"></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>添加后，需点击图中的 <strong>Test Connection</strong> 按钮进行校验，确保 Token 可以正常运作。</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="252-maven-设置">2.5.2 Maven 设置<a class="hash-link" href="#252-maven-设置" title="Direct link to heading">​</a></h4><p>基础镜像部分介绍到，我们在官方 Jenkins 镜像的基础上安装了 Maven，并设置了环境变量与配置文件。</p><p>但这些还不够，使用 Jenkins 时，我们还需要在 <strong>系统管理 - 全局工具配置</strong> 页面中配置 Maven 的具体位置，使 Jenkins 能准确找到 Maven 的地址。</p><p><img loading="lazy" src="/assets/images/maven-a514c03656a80b6165d252497c65f96c.jpg" width="2095" height="472" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="253-时区设置">2.5.3 时区设置<a class="hash-link" href="#253-时区设置" title="Direct link to heading">​</a></h4><p>在基础镜像部分，我们已经将镜像的时区设置为东八区。</p><p>但是在 Jenkins 的界面中，每个用户的初始时区都是伦敦时间，需要我们手动设置为东八区：</p><p><img loading="lazy" src="/assets/images/timezone-6dda44d5afb6ea21aacb4dcc7337d382.jpg" width="2102" height="210" class="img_ev3q"></p><p>完成此步骤后，Jenkins 的整个初始化配置过程便完成了，接下来可开始创建流水线进行深入体验。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三构建流水线">三、构建流水线<a class="hash-link" href="#三构建流水线" title="Direct link to heading">​</a></h2><p>本节将以 <strong>多模块集成流水线</strong> 为例，展示具体的流水线构建流程。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-创建任务">3.1 创建任务<a class="hash-link" href="#31-创建任务" title="Direct link to heading">​</a></h3><p>集成了 Maven Integration 插件后，我们就可以在 <strong>新建任务</strong> 界面中创建一个 Maven Project：</p><p><img loading="lazy" src="/assets/images/new_project-b8d957c0afec3c595baa6a88a738017c.jpg" width="2540" height="1294" class="img_ev3q"></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>通过 Maven Project，我们可以很便捷地在 Jenkins 上实现代码的编译与打包。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-配置流水线">3.2 配置流水线<a class="hash-link" href="#32-配置流水线" title="Direct link to heading">​</a></h3><p>流水线任务创建后，需要经过一系列配置。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="321-代码源">3.2.1 代码源<a class="hash-link" href="#321-代码源" title="Direct link to heading">​</a></h4><p>Jenkins 支持从 GitLab 上拉取代码。</p><p><img loading="lazy" src="/assets/images/gitlab_source_1-f92823bd121f302436a8fbb3c7570c8d.jpg" width="2529" height="1297" class="img_ev3q"></p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>仓库地址记得使用 HTTPS，如果要使用 SSH 方式，需在容器中创建私钥（本文不介绍此种方式）。</p></div></div><p>如果我们的 GitLab 项目是 Private 级别，那么我们还需要创建一个 GitLab 凭据<strong>（Username with password）</strong>，该凭据需要填写具有项目对应权限的 <strong>GitLab 用户名与密码</strong>，如下所示：</p><p><img loading="lazy" src="/assets/images/gitlab_source_2-62ae7da09c2a3959919868583e7f3be5.jpg" width="2538" height="1292" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="322-构建器">3.2.2 构建器<a class="hash-link" href="#322-构建器" title="Direct link to heading">​</a></h4><p>构建器用于设置流水线任务触发的条件。</p><p>在本例中，我们勾选 <code>Build when a change is pushed to GitLab</code>。</p><p><img loading="lazy" src="/assets/images/pipeline_builder-4c6b1008582b9737204a04e8cb10e042.jpg" width="2530" height="1295" class="img_ev3q"></p><p>该选项实现了当 GitLab 上有代码提交等行为时，触发 Jenkins 作业。</p><p>需要注意的是，要实现 GitLab 主动向 Jenkins 推送触发事件，需在 GitLab 上配置 Webhooks：</p><p><img loading="lazy" src="/assets/images/webhooks-9e151db888507c8cb34eb54be40f11d3.jpg" width="2533" height="1297" class="img_ev3q"></p><p>Webhooks 中，有两个配置项需要格外注意：</p><ul><li>URL 为 Jenkins 对应构建项目的地址，如本例为：<a href="http://192.168.5.98:38080/project/demo" target="_blank" rel="noopener noreferrer">http://192.168.5.98:38080/project/demo</a></li><li>Secret token 为 Jenkins 对应构建项目的令牌，通过点击 <strong>高级</strong> 按钮进行生成，具体示例可见下图</li></ul><p><img loading="lazy" src="/assets/images/jenkins_secret_token-050a87474d6c8f061b4259bed7710b5b.jpg" width="2536" height="1296" class="img_ev3q"></p><p>此外，图例中的 <code>Allowed Branched</code> 需要指定触发构建的分支。默认情况下，任意分支的提交都会触发构建任务。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>在本例中，我们设置为只有 master 分支发生变更才会触发构建任务。</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="323-构建环境">3.2.3 构建环境<a class="hash-link" href="#323-构建环境" title="Direct link to heading">​</a></h4><p>构建环境设定了构建过程中的一些条件与行为。</p><p>由于本节主要介绍多模块的持续集成，因此关键点在于 <code>Do not build if only specified paths have changed</code> 选项。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>该选项由 Pathignore 插件提供，可支持子模块的单独构建。</p></div></div><p><img loading="lazy" src="/assets/images/pipeline_builder_2-16c3e0e149a53503b0c8d6a0d3a290a6.jpg" width="2529" height="617" class="img_ev3q"></p><p>图例中的配置表示，只有子模块 <code>dim-service</code> 产生了变更项，才会触发构建任务。<strong>这是实现多模块持续集成的根基</strong>，在此基础上，我们可以很轻松地过滤掉其他子模块的构建流程。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="324-pre-steps">3.2.4 Pre Steps<a class="hash-link" href="#324-pre-steps" title="Direct link to heading">​</a></h4><p>顾名思义，Pre Steps 可以完成构建前的一些准备工作。</p><p>例如，我们想要在构建时推送 Docker 镜像，那么就需要提前登录对应的 Docker 仓库：</p><p><img loading="lazy" src="/assets/images/pre_steps-8245dcc6b5041afb3361b522495527ce.jpg" width="1792" height="436" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="325-build">3.2.5 Build<a class="hash-link" href="#325-build" title="Direct link to heading">​</a></h4><p>该步骤指明了我们整个流水线想要完成的构建指令。</p><p>在本例中，我们通过 <code>-pl</code> 参数指定构建的模块为 <code>dim-service</code>，配合上述 Pathignore 插件的过滤功能，我们可以实现当 <code>dim-serivce</code> 子模块发生变更项时自动触发该模块的 Docker 镜像创建与推送：</p><p><img loading="lazy" src="/assets/images/build-08f2020be5977e8a0d5845b81041fc3a.jpg" width="1792" height="326" class="img_ev3q"></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p> <code>docker:build</code> 与 <code>docker:push</code> 依赖 <code>docker-maven-plugin</code> 插件，可自行研究，或等待后续教程。</p></div></div><p>完成上述所有步骤后，点击 <strong>应用</strong> 与 <strong>保存</strong>，便完成了流水线的配置。如果项目有多个模块，创建多个对应的流水线任务即可。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-构建与验收">3.3 构建与验收<a class="hash-link" href="#33-构建与验收" title="Direct link to heading">​</a></h3><p>现在，我们可以提交一次代码，验证一下流水线任务执行情况。若无异常，在我们提交代码后，流水线会自动开启构建任务，完成我们预设的构建工作。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>代码提交时，各子模块对应的流水线任务都会被触发，但是由于 Pathignore 插件的作用，流水线任务检测自身对应的子模块无变更项时，当前被触发的构建任务不会执行任何构建操作。</p></div></div><p>在构建任务明细中，可以通过点击 <strong>控制台输出</strong> 按钮，查看具体的构建日志：</p><p><img loading="lazy" src="/assets/images/console_output-c00ff1a5fdea623f8bf74539e061e0f5.jpg" width="2536" height="1292" class="img_ev3q"></p><p>如果一切顺利，即可在我们的 Docker 私仓里看到本次构建的镜像了！</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/practice">Practice</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2020/07/01/sonarqube">基于 SonarQube 搭建自动化代码检测平台</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2020-07-01T00:00:00.000Z" itemprop="datePublished">July 1, 2020</time> · <!-- -->16 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://magicpenta.github.io" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://magicpenta.github.io/img/logo.svg" alt="Panda"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://magicpenta.github.io" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Panda</span></a></div><small class="avatar__subtitle" itemprop="description">Tencent CSIG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一背景介绍">一、背景介绍<a class="hash-link" href="#一背景介绍" title="Direct link to heading">​</a></h2><p>目前，成熟的代码检测工具有很多，如 SpotBugs（前身为 FindBugs）、PMD、Checkstyle 等，我们可以在本地开发环境，非常便捷地利用这些工具实现代码的扫描与检测。这看上去好像很不错，但实际上，采用这种代码检测方式，我们面临着两个问题：</p><ul><li>代码提交前需要手动运行检测工具</li><li>检测结果仅对自己可见</li></ul><p>那么，有没有什么方案可以规避这些问题呢？答案当然是有的。</p><p>我们可以基于 GitLab 和 SonarQube 搭建自动化代码检测平台，并通过该平台实现以下功能：</p><ul><li>每次提交时，自动触发 SonarQube 代码检测，产生检测报告（包含坏味道、BUG 数、覆盖率等）</li><li>上述检测报告，若来源于主分支提交或合并，则发送至 SonarQube，若来源于其他分支提交，则以评论形式直接反馈至 GitLab</li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>如果不知道 SonarQube 是什么，可以参考 <a href="https://www.sonarqube.org/" target="_blank" rel="noopener noreferrer">SonarQube 官方网站</a>。</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二环境要求">二、环境要求<a class="hash-link" href="#二环境要求" title="Direct link to heading">​</a></h2><p>本次搭建使用的操作系统为 <code>CentOS 7</code>，需要安装的组件如下表所示：</p><table><thead><tr><th>组件名</th><th>版本号</th></tr></thead><tbody><tr><td>SonarQube</td><td>6.7</td></tr><tr><td>GitLab</td><td>11.1.4</td></tr><tr><td>GitLab-Runner</td><td>13.0.1</td></tr><tr><td>Maven</td><td>3.6.3</td></tr></tbody></table><p>实际版本号需严格遵循表格中的版本号，避免出现兼容性问题。目前，笔者已知的兼容性问题有以下几点：</p><ul><li>SonarQube 在 7.6 版本后不支持插件 <code>sonar-gitlab-plugin</code>，若使用 7.6 之后的版本，将无法实现 SonarQube 与 GitLab 协作（除非使用付费版）</li><li>GitLab 与 GitLab-Runner 的版本要考虑兼容性，否则会出现 GitLab-Runner 无法连接至 GitLab 的问题</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三安装与配置">三、安装与配置<a class="hash-link" href="#三安装与配置" title="Direct link to heading">​</a></h2><p>本节将描述上述组件安装与配置的详细步骤。其中，安装方式主要有本地安装和基于 Docker 安装，因此在安装前需确保宿主机已经具备 Docker 和 Docker Compose 的环境。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-sonarqube">3.1 SonarQube<a class="hash-link" href="#31-sonarqube" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="311-sonarqube-安装">3.1.1 SonarQube 安装<a class="hash-link" href="#311-sonarqube-安装" title="Direct link to heading">​</a></h4><p>使用 Docker Compose 安装 SonarQube 很简单，只需以下几个步骤：</p><ul><li>在任意位置创建安装目录 <code>sonar</code>，如 <code>/usr/local/sonar</code></li><li>在安装目录下创建 <code>docker-compose.yml</code> 文件，文件内容如下：</li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2.1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 使用 PostgreSQL 作为 SonarQube 的持久化方案</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 注：由于 SonarQube 7.9 及之后的版本不支持 MySQL，因此 MySQL 不作为考虑对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">postgres</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> postgres</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonarqube_postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;5432:5432&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> sonarnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 将 PostgreSQL 数据文件存放至宿主机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./postgres</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/lib/postgresql/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRES_DB</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRES_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sonarqube</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonarqube</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">6.7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonarqube</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;9000:9000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> sonarnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 将 SonarQube 日志文件、数据文件、配置文件、扩展插件存放至宿主机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/opt/sonarqube/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./extensions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/opt/sonarqube/extensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./logs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/opt/sonarqube/logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./conf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/opt/sonarqube/conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 配置 SonarQube 的数据源，本例为 PostgreSQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SONARQUBE_JDBC_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SONARQUBE_JDBC_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sonar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">SONARQUBE_JDBC_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">postgresql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//postgres</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">5432/sonar</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">useUnicode=true</span><span class="token important">&amp;characterEncoding=utf8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 由于 SonarQube 内部会启动 ElasticSearch，因此需要此配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ulimits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nproc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">65535</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nofile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">soft</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">65536</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hard</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">65536</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">networks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sonarnet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bridge</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在安装目录下分别创建 <code>data</code>、<code>extensions</code>、<code>logs</code>、<code>conf</code> 文件夹，并使用 <code>chmod -R 777 &lt;dir&gt;</code> 赋予所有权限，避免出现权限问题</li><li>若宿主机有开启防护墙，需开放上述配置的端口：</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5432</span><span class="token plain">/tcp </span><span class="token parameter variable" style="color:#36acaa">--permanent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">9000</span><span class="token plain">/tcp </span><span class="token parameter variable" style="color:#36acaa">--permanent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd </span><span class="token parameter variable" style="color:#36acaa">--reload</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在安装目录下，使用 <code>docker-compose up -d</code> 命令启动 SonarQube，若启动成功，控制台输出如下日志：</li></ul><div class="language-纯文本 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-纯文本 codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Creating network &quot;sonar_sonarnet&quot; with driver &quot;bridge&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating sonarqube_postgres ... done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating sonarqube          ... done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>打开浏览器，输入地址 <code>http://sonar.example.com:9000</code> 访问 SonarQube，若访问成功，则出现如下页面：</li></ul><p><img loading="lazy" src="/assets/images/sonar_home-58c76791885a44edbf81c0272cce51a9.jpg" width="1920" height="969" class="img_ev3q"></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>安装完成后，SonarQube 会自动生成管理员账号 <code>admin:admin</code>。</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="312-sonarqube-插件">3.1.2 SonarQube 插件<a class="hash-link" href="#312-sonarqube-插件" title="Direct link to heading">​</a></h4><p>SonarQube 安装完成后，还需要安装部分插件以支持某些功能，具体插件清单如下：</p><table><thead><tr><th>插件名</th><th>版本号</th><th>插件用途</th></tr></thead><tbody><tr><td>sonar-gitlab-plugin</td><td>3.0.2</td><td>为每个 GitLab 提交提供代码注释和评论的功能</td></tr><tr><td>sonar-l10n-zh-plugin</td><td>1.19</td><td>支持 SonarQube 汉化</td></tr></tbody></table><p>插件安装非常简单，只需要将插件 <code>jar</code> 包放至扩展目录 <code>${sonarqube_home}/extensions/plugins</code> 下，重启 SonarQube 即可。</p><p>关于 SonarQube 与 <code>sonar-gitlab-plugin</code> 的版本对照，可以参考：</p><p><a href="https://github.com/gabrie-allaigre/sonar-gitlab-plugin" target="_blank" rel="noopener noreferrer">https://github.com/gabrie-allaigre/sonar-gitlab-plugin</a></p><p>关于 SonarQube 与 <code>sonar-l10n-zh-plugin</code> 的版本对照，可以参考：</p><p><a href="https://github.com/SonarQubeCommunity/sonar-l10n-zh%20" target="_blank" rel="noopener noreferrer">https://github.com/SonarQubeCommunity/sonar-l10n-zh%20</a></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>上述插件不支持在 SonarQube 的应用中心直接下载，因为官方已经不再提供这两款插件的在线安装了，我们可以直接在上述的 GitHub 地址中下载指定版本的 jar 包。</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="313-sonar-gitlab-plugin-配置">3.1.3 Sonar GitLab Plugin 配置<a class="hash-link" href="#313-sonar-gitlab-plugin-配置" title="Direct link to heading">​</a></h4><p>若 <code>sonar-gitlab-plugin</code> 成功安装，则在 SonarQube 的配置页面可以见到如下页面：</p><p><img loading="lazy" src="/assets/images/sonar_gitlab_1-7b8dcd96cea43ef0416f3d8b52485c05.jpg" width="1920" height="969" class="img_ev3q"></p><p>具体路径为：登录 admin 账号 -&gt; 点击顶部导航栏【配置】按钮 -&gt; 点击【通用设置】中的【GitLab】选项卡</p><p>在该页面中，需要修改以下参数的值：</p><table><thead><tr><th>参数名称</th><th>参数标识</th><th>目标值</th></tr></thead><tbody><tr><td>GitLab url</td><td>sonar.gitlab.url</td><td><a href="http://gitlab.example.com" target="_blank" rel="noopener noreferrer">http://gitlab.example.com</a></td></tr><tr><td>GitLab User Token</td><td>sonar.gitlab.user_token</td><td>GitLab 的用户令牌，获取方式参考 <code>3.2.2</code></td></tr><tr><td>GitLab API version</td><td>sonar.gitlab.api_version</td><td>v4</td></tr></tbody></table><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>上述参数中，GitLab User Token 是核心，设置错误的 token，将直接影响到 SonarQube 与 GitLab 的协作。特别要注意的是，生成该 token 的用户 <strong>一定要具备管理员权限</strong>，否则 SonarQube 无法对 GitLab 上的所有项目进行评论。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-gitlab">3.2 GitLab<a class="hash-link" href="#32-gitlab" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="321-gitlab-安装">3.2.1 GitLab 安装<a class="hash-link" href="#321-gitlab-安装" title="Direct link to heading">​</a></h4><p>与 SonarQube 相似，我们采用 Docker Compose 的方式安装 GitLab，具体步骤如下：</p><ul><li>在任意位置创建安装目录 <code>gitlab</code>，如 <code>/usr/local/gitlab</code></li><li>在安装目录下创建 <code>docker-compose.yml</code> 文件，文件内容如下：</li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">gitlab</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 使用 gitlab 中文镜像，直接安装 gitlab 中文版</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;twang2218/gitlab-ce-zh:11.1.4&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 若没有域名，建议直接写ip，否则页面上克隆的复制链接串将显示该值，无法直接使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;192.168.117.128&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 设置时区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">TZ</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Asia/Shanghai&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">GITLAB_OMNIBUS_CONFIG</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          external_url &#x27;http://192.168.117.128&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          gitlab_rails[&#x27;time_zone&#x27;] = &#x27;Asia/Shanghai&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;80:80&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;443:443&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;22:22&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 将 gitlab 日志文件、数据文件、配置文件存放至宿主机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/opt/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> logs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/log/gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logs</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>若宿主机 <code>ssh</code> 端口为默认值 <code>22</code>，则需要将其修改为其他值后，才能继续执行后续步骤，具体修改方式本文略</li><li>若宿主机有开启防护墙，需开放上述配置的端口（<code>22</code> 端口默认开启，无需配置）：</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">80</span><span class="token plain">/tcp </span><span class="token parameter variable" style="color:#36acaa">--permanent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">443</span><span class="token plain">/tcp </span><span class="token parameter variable" style="color:#36acaa">--permanent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd </span><span class="token parameter variable" style="color:#36acaa">--reload</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在安装目录下，使用 <code>docker-compose up -d</code> 命令启动 GitLab，若启动成功，控制台输出如下日志：</li></ul><div class="language-纯文本 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-纯文本 codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Creating network &quot;gitlab_default&quot; with the default driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating gitlab ... done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>打开浏览器，输入地址 <code>http://gitlab.example.com</code> 访问 GitLab，若访问成功，则出现如下页面：</li></ul><p><img loading="lazy" src="/assets/images/gitlab_home-0fc0f73c6a658a92f2781fb5f5664fc1.jpg" width="1920" height="969" class="img_ev3q"></p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>安装完成后，GitLab会自动生成管理员账号 <code>root</code>，首次登录前需要修改密码。</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="322-gitlab-用户令牌生成">3.2.2 GitLab 用户令牌生成<a class="hash-link" href="#322-gitlab-用户令牌生成" title="Direct link to heading">​</a></h4><p>GitLab 安装完成后，我们需要需要根据 <code>3.1.3</code> 中的要求，生成用户令牌。</p><p>具体步骤如下：</p><ul><li>登录具有管理员权限的账号（一定要是管理员身份）</li><li>访问地址 <code>http://gitlab.example.com/profile/personal_access_tokens</code> 进入令牌生成页面</li><li>输入令牌名称，勾选 <code>api</code> 、<code>read_user</code>、<code>sudo</code> 权限，点击【创建】按钮，即可生成用户令牌</li></ul><p><img loading="lazy" src="/assets/images/gitlab_token-a68dcd9da4b52a909d13161f0dea3cc1.jpg" width="1920" height="969" class="img_ev3q"></p><p><strong>生成的令牌需要马上保存，后续不再显示</strong>，具体令牌信息在如下位置：</p><p><img loading="lazy" src="/assets/images/gitlab_token_2-ba699e11a3b351e5ba8008dc40ea4ee2.jpg" width="1920" height="969" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-gitlab-runner">3.3 GitLab Runner<a class="hash-link" href="#33-gitlab-runner" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="331-gitlab-runner-安装">3.3.1 GitLab Runner 安装<a class="hash-link" href="#331-gitlab-runner-安装" title="Direct link to heading">​</a></h4><p>GitLab Runner 是一个处理构建的应用程序，我们需要通过它执行我们在 GitLab CI 中定义的 Job。</p><p>在本例中，由于后续编写的 Job 依赖于 Maven 环境，因此选择直接在宿主机上安装 GitLab
Runner。</p><p>（当然，我们也可以自己构建包含 GitLab Runner 和 Maven 的镜像，然后使用 Docker 安装，具体实现方式本例略。）</p><p>在宿主机上安装 GitLab Runner 的步骤如下：</p><ul><li>下载 GitLab 官方源：</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-L</span><span class="token plain"> https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.rpm.sh </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>使用 yum 下载 GitLab Runner：</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> gitlab-runner</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="332-注册与启动-runner">3.3.2 注册与启动 Runner<a class="hash-link" href="#332-注册与启动-runner" title="Direct link to heading">​</a></h4><p>注册 Runner 前，我们需要先获取 GitLab 的注册令牌。</p><p>登录管理员账号，访问地址 <code>http://gitlab.example.com/admin/runners</code>，即可看到我们想要的注册令牌：</p><p><img loading="lazy" src="/assets/images/gitlab_runner_1-4c85c293d9f7c137b40fc8cdc431c682.jpg" width="821" height="166" class="img_ev3q"></p><p>接下来，即可开始注册流程。</p><p>首先，执行注册命令：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gitlab-runner register</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后，根据控制台上的提示，我们需要依次输入以下信息：</p><ul><li>GitLab 地址：<code>http://gitlab.example.com</code></li><li>注册令牌</li><li>Runner 描述，如 test</li><li>Runner 标签（与后续编写的 <code>.gitlab-ci.yml</code> 中的 <code>tags</code> 要一致，因此需要慎重填写，当然，写错了也无妨，后续在 UI 界面上可以修改）</li><li>选择执行者（ssh, docker+machine, docker-ssh+machine, kubernetes, docker, parallels, virtualbox, docker-ssh, shell）</li><li>若执行者选择 shell，则注册流程结束，若执行者选择 docker，则需要选择默认的镜像，如 <code>docker:stable</code></li></ul><p>完成注册后，即可在刚刚的地址中看见该 Runner 的信息：</p><p><img loading="lazy" src="/assets/images/gitlab_runner_2-2fa89759a2da8169ae364c66bd4d1c33.jpg" width="1920" height="969" class="img_ev3q"></p><p>现在，我们可以使用命令 <code>gitlab-ci-multi-runner run</code> 启动所有 Runner。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-maven">3.4 Maven<a class="hash-link" href="#34-maven" title="Direct link to heading">​</a></h3><p>Maven 用于执行 SonarQube 的代码检测命令（同样的工具有 Sonar Scanner、Gradle 等）。</p><p>由于没有找到已配置好阿里源的 Maven 镜像，所以我们也选择使用本地安装的方式安装 Maven，具体步骤如下：</p><ul><li>在任意目录下（如 <code>/usr/local</code>）下载 Maven 二进制包：</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://mirror.bit.edu.cn/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>解压压缩包，并将目录重命名为 <code>maven</code>：</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-xzvf</span><span class="token plain"> apache-maven-3.6.3-bin.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> apache-maven-3.6.3/ maven</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在 <code>/etc/profile</code> 文件追加以下内容：</li></ul><div class="language-纯文本 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-纯文本 codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export M2_HOME=/usr/local//maven</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH=$PATH:$M2_HOME/bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>重置环境变量</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">source</span><span class="token plain"> /etc/profile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>至此，环境要求的所有组件已全部安装完毕。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四结果验证">四、结果验证<a class="hash-link" href="#四结果验证" title="Direct link to heading">​</a></h2><p>现在，我们通过一次完整的代码提交，来验证自动化代码检测平台是否生效，即：</p><ul><li>代码提交时，是否触发 SonarQube 检测作业</li><li>SonarQube 的检测结果，是否可以反馈至 GitLab</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-新建-maven-工程">4.1 新建 Maven 工程<a class="hash-link" href="#41-新建-maven-工程" title="Direct link to heading">​</a></h3><p>首先，我们创建满足要求的 Maven 工程。该工程的 <code>pom.xml</code>  文件要求具备以下内容：</p><ul><li>加入 <code>sonar-maven-plugin</code> 和 <code>jacoco-maven-plugin</code> 插件：</li></ul><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">pluginManagement</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.apache.maven.plugins</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">maven-compiler-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.8.1</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.sonarsource.scanner.maven</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">sonar-maven-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">3.6.0.1398</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.jacoco</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jacoco-maven-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">0.8.4</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">pluginManagement</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>添加 <code>jacoco-maven-plugin</code> 插件的配置信息：</li></ul><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">profiles</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">profile</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">coverage</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">activation</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">activeByDefault</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">activeByDefault</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">activation</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.jacoco</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">jacoco-maven-plugin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">prepare-agent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">prepare-agent</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">report</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">id</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">report</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goal</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">goals</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">execution</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">executions</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugin</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">plugins</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">profile</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">profiles</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可能有人会有疑问，为什么需要加入 <code>jacoco-maven-plugin</code> 插件呢？这是因为，SonarQube 本身并不支持覆盖率计算，我们需要借助 jacoco 来计算出项目单元测试的覆盖率。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-集成-gitlab-ci">4.2 集成 GitLab-CI<a class="hash-link" href="#42-集成-gitlab-ci" title="Direct link to heading">​</a></h3><p><code>3.3.2</code> 中，我们演示了如何创建 GitLab Runner。</p><p>在这里，我们首先创建执行者为 docker 的 Runner，并将其命名为 <code>docker_runner</code>。</p><p>然后，我们编写如下 <code>.gitlab-ci.yml</code> 文件：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> maven</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3.6.3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">jdk</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">variables</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">SONAR_TOKEN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;${sonar_token}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">SONAR_HOST_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://sonar.example.com:9000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">GIT_DEPTH</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">stages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build_push</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> feedback_to_gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 执行 SonarQube 分析，并将检测结果推送至 SonarQube</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">sonarqube_analysis</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build_push</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">only</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> merge_requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mvn </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mode verify sonar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">sonar </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dsonar.host.url=$SONAR_HOST_URL </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dsonar.login=$SONAR_TOKEN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker_runner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 执行 SonarQube 分析，并将检测结果反馈至 GitLab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">sonarqube_gitlab_comment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> feedback_to_gitlab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">except</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mvn </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mode verify sonar</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">sonar </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dsonar.host.url=$SONAR_HOST_URL </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dsonar.login=$SONAR_TOKEN </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dsonar.analysis.mode=preview </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dsonar.gitlab.commit_sha=$CI_COMMIT_SHA </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dsonar.gitlab.ref_name=$CI_COMMIT_REF_NAME </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dsonar.gitlab.project_id=$CI_PROJECT_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> docker_runner</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中，参数 <code>SONAR_TOKEN</code> 为 SonarQube 的令牌，在 SonarQube 首次创建项目时即可创建。与 GitLab 的令牌一样，此 token 一旦创建，就需要马上保存，否则后续不再显示。</p><p>引入该 <code>.gitlab-ci.yml</code> 文件后，当我们提交代码时，上述 Runner 便会根据提交所来源的分支选择相应的执行脚本，具体描述如下：</p><ul><li>若提交为主分支提交（或合并至主分支），则执行器 <code>docker_runner</code> 会执行 SonarQube 的分析指令，并将分析结果报送至 SonarQube 平台</li><li>若提交为非主分支提交，则执行器 <code>docker_runner</code> 会执行 SonarQube 的分析指令，并将分析结果反馈至 GitLab 中对应的分支下</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-提交验证">4.3 提交验证<a class="hash-link" href="#43-提交验证" title="Direct link to heading">​</a></h3><p>现在，我们分别在其他分支和主分支提交代码，查看提交结果。</p><p>在提交其他分支代码时，由于我们的代码中有严重 BUG，SonarQube 会在此分支下标记出 BUG 的具体信息，并标记该流水线的状态为失败，如下图所示：</p><p><img loading="lazy" src="/assets/images/sonar_feedback-245cdcc6a543249ff618d7aeef3d4437.jpg" width="970" height="812" class="img_ev3q"></p><p>在提交主分支代码时，我们发现执行器自动触发 SonarQube 分析作业，并将检测结果推送至 SonarQube 平台，如下图所示：</p><p><img loading="lazy" src="/assets/images/sonar_result-ce38e900ebbc4cdaf6fd8a304756d1f9.jpg" width="1298" height="745" class="img_ev3q"></p><p>综上，我们发现结果符合预期，说明自动化代码检测平台搭建成功，enjoy it！</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/practice">Practice</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/10/01/my-way">什么都无法舍弃的人，什么也改变不了</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-10-01T00:00:00.000Z" itemprop="datePublished">October 1, 2016</time> · <!-- -->19 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://magicpenta.github.io" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://magicpenta.github.io/img/logo.svg" alt="Panda"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://magicpenta.github.io" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Panda</span></a></div><small class="avatar__subtitle" itemprop="description">Tencent CSIG</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="My Way" src="/assets/images/banner-cb63530738683bbac5d1f854c3210c04.jpg" width="2027" height="988" class="img_ev3q"></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>写于 2016 年国庆，彼时 23 周岁，大学刚毕业。</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="为什么选择编程">为什么选择编程<a class="hash-link" href="#为什么选择编程" title="Direct link to heading">​</a></h2><p>曾经有人问我，为什么要学编程，去国企或者考公多好啊。我记得当时的自己，本想张口反驳，最后却又闭上嘴巴保持沉默。因为那时候，我不知道怎么回答，如果我像世人那样很装逼地用梦想两个字来解释，那么也许我从未明白自己想要的是什么。因为，嘴巴里说出来的梦想，就像空中楼阁，永远也触摸不到。</p><p>直到今天。当我在浏览器的地址栏上输入自己在花生壳申请的域名然后看着页面跳转到我自己的网页作品时，我知道这两个月孤单的学习生活值得，我知道曾经的放弃是正确的答案，我知道心中梦想究竟是什么模样，我也知道未来的路该往哪儿走。</p><p>什么都无法舍弃的人，什么也改变不了。我庆幸自己自己做出了选择，我自豪自己做出的改变，哪怕这条不同领域的道路对于新生的自己来说可能是荆棘遍地，但只要脚下的路是自己的，走得再怎么磕脚也是幸福的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="人生第二篇章钥匙在自己手里">人生第二篇章，钥匙在自己手里<a class="hash-link" href="#人生第二篇章钥匙在自己手里" title="Direct link to heading">​</a></h2><p>在中国，如果有人问你，如何评价一个大学生是否优秀，你会如何回答？我想，对于很多大学生来说，评判标准很可能就在以下几种。是不是学生干部？是不是学霸学神？演讲出不出色？PPT牛不牛？是不是多才多艺？<br>
<!-- -->早在很小的时候，我们就明白了社会对学生评判的标准，我们知道学习怎样的技能，达到怎样的成绩，可以获取周边同学艳羡的目光，可以收获大人们毫不吝啬的赞赏。也因此，从小我们不会去考虑自己内心想要的是什么，不会去思考自己适合的是什么，因为优秀的标准已经很明确的摆在那里，我们还费那么多功夫想这些做什么呢？我们只要按部就班，考取个年段前列的优异成绩，就足以在过年过节的时候赢得满桌大人的喝彩。</p><p>所以，我们也就顺着这个惯性，把小时候的思维，一并带入到大学生活中。我们知道，学生干部可以为综测加分、可以为自己的简历点缀、可以向家里的大人炫耀，所以就在大一一开学时一个班长的位置竞争是那样的激烈；我们知道，就算没有学生工作，只要 GPA 够高，仍然是自己炫耀的资本，所以我们会不分昼夜泡在图书馆，更有甚者会为了绩点去台湾交流，只因那边的老师打分比较高。不知道从何时开始，我们前进的动力，竟然是建立在家长、学校、社会所给予的标尺上。他们说好，我们奋不顾身地去追求，他们说不好，我们连一秒钟的时间也懒得花费。</p><p>因此在大学的尾巴，在临近毕业时，我们可以看见一大批人手握着家长的评判标尺，义无反顾地投入到考公的大军中，好像未来的道路已经明朗，好像人生的目标就已经在前方。</p><p>当然，我想表达的意思，并不是说这种评判标尺不好。我想说的其实是，从小我们在标尺下成长，我们很轻松地就知道何为优秀。但当我们从学校的象牙塔走出，面对纷杂的社会，如果此时我们继续接受家长的标尺，去考公、去国企、去银行、去一切一切看起来可以稳定终老的单位，那么一切都还是那样美好。但假如，我不呢？假如我拒绝一眼看到头的生活，假如我拒绝不存在挑战的安逸日子呢？那么，失去这个评判标尺的我，在拥有这么多行业的社会中，该往哪走？社会舆论教会了我优秀的定义，可它不曾告诉我兴趣的含义。</p><p>所以我说，人生第二篇章的钥匙，在我们自己手里。当我们从学校走出，当我们不再循规蹈矩，那么没有人能告诉你什么是好的，因为也没有人知道真正的答案。在日新月异的今天，只有你自己可以做出选择。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="改变是二次学习">改变，是二次学习<a class="hash-link" href="#改变是二次学习" title="Direct link to heading">​</a></h2><p>高谈阔论了半天，其实上面所提及的大学生现状就是我自己的真实写照，当然，学霸那一点不算。记得当初高考填报志愿的时候，我遵循父上大人的建议，报了厦大经院的财政系，立志未来进入财政局成为一名有头有脸的大人物。可惜天不遂人愿，那一年厦大经院的录取分普遍比往年高，导致我连吃两次级差，最后录取了第五个志愿，电子商务。然后更好笑的是，当时我不曾想自己会沦落到录取第五个志愿的下场，因此从第五个志愿开始是瞎填的，结果我就在一脸懵逼中，到了厦大管院电子商务专业开始我的大学生活。</p><p>现在想来，在电子商务这个专业，有好有坏吧。先说说好的方面吧。厦大电子商务，号称全能专业，文能学宏经、微经、会计学等高大上的经济类课程，理能学高数 A、概统、可以碾压专业理科生的运筹学等烧脑的理科类课程。甚至还开设了一系列软件相关课程，学 Java，学 C，学数构，学数据库。我至今记得，在尚未学会编程规范、尚未把面向对象理解透，就被强行布置了一个题库软件的日子。嗯，说完好的，再来谈谈不好的地方。那就是，多而不精！每个人的精力是有限的，如果学得太多太泛，那么就无法在某个垂直领域学得深。因此电子商务专业的同学，在毕业季找工作的时候，通常都会遇到一个窘况，那就是在写简历的时候，内容可以比其他同学来得丰富，但是在面试深入交谈的的时候，全部露了马脚。当然我并不是想质疑系里的开课水平，毕竟这种教育方式从长远来看说不定也有可取的地方，因为据说现在的市场上对跨界人才的呼声是越来越高。但至少，电子商务专业，给本来就按部就班的自己，下了一剂更强的迷幻药。</p><p>有人说过，兴趣是可以培养的。比如一个同学，他对财务从来不了解，但假如有一天他置身于财务的环境中，那么日积月累下，有可能他就会发现财务给自己带来的强烈荣誉感，从而使他能有更强烈的欲望在财务的天地里闯荡。但是，这个前提，是专业性，是心无旁骛，是只有唯一的选择。如果他所接触的课程和领域，浸入的面实在太广，那么此时也许他就无法往某个单一领域深入地发展，自然无法获得深入研究所带来的成就感。这就像在高速路上，如果我们前行的方向只有一条，我们永远不会走错，除非你衰到撞坏护栏掉落悬崖。但假如我们行驶到高速枢纽，当前方的分岔口太多，我们走错的几率也就大大提高。</p><p>所以，大学四年下来，我依旧只会做好我的学生工作，保证我的课业不挂科，却从来不曾想我的兴趣是什么，我未来的职业道路要怎么走。直到大四上的时候，当看到同样在做校园自媒体平台的数院宣传巨头因为对设计的强烈热爱而斩获阿里交互设计师 offer 时，当看到同样在做学生工作的某同学因为对数据分析的热爱而斩获阿里的数据运营 offer 时，我隐藏在内心的焦虑和恐慌才越来越明显。</p><p>此时，我正在联想做着与本专业相关的运营工作。我开始觉得，我的大学，好像缺失了什么。我好像，从来不知道自己奋斗的动力来自何方。我仿佛机械一般，做着眼前的运营工作，仿佛为了证明自己很努力，拼了命地阅读鸟哥笔记里的干货。但其实，我很明白，我不喜欢运营，我不喜欢拉新不喜欢搞活动不喜欢促留存。不是运营不好，只是不喜欢而已，也许 10W+ 能给爱好运营的人带来王冠般的荣耀，但是对我来说却是没有丝毫吸引力，当然，我自己也写不了 10W+ 的文案。纯粹就是兴趣问题而已，仅此而已。</p><p>也就在那一阵，在那个即将面临毕业的关口，我彻底地陷入了迷茫。我终于发现自己所缺失的东西，我终于知道自己很奋斗却从未收获的原因在于自己不曾问问自己想要的是什么。我终于明白，奋斗从来不难，无休止的加班、无休止的工作都能证明你的奋斗，但是冷静下来的思考和专研，才是真正重要真正决定成败的因素。也恰好就在此时，我一直感激着的卢同学，一位在欧莱雅闯荡的女强人，对我说了一句话，让我整个人恍若醍醐灌顶。她说，在她的眼中，虽然我是学院 5 大学生干部之一，但她从来不觉得我是 leader，她觉得我更像是技术帝，更像那种默默在背后付出的人。那一瞬间，我仿佛记起了自己做的运动会视频在运动会庆功宴上，引起全场运动员尖叫而自己默默在台下吃饭的场景；我仿佛记起了院里的同学在微信公众平台上为了毕马威大赛而疯狂抢票时，作为幕后始作俑者的自己当时的满足感；我仿佛记起了在 Java 大作业提交前夕，一群人打开自己写的应用时那种无与伦比的成就感。原来世人所言不假，人可以从他人的眼睛中看到最真实的自己。原来我一直是这样的人，喜欢在幕后默默学习默默做事而从不想要舞台从不渴望聚光灯的人。原来其实我一直被外人打上了技术型男生的标签。难怪我不喜欢需要哗众取宠、需要吸引广大用户关注的运营。兴趣不同，何必强融呢？</p><p>但是，让人深感绝望的是，当我终于认清自己，认清自己与世界的关系时，我已经站在了毕业的尾巴。在这个关键的阶段，我怯弱了，害怕了，因为改变，意味着二次学习，意味着一切从头开始，意味着我以前的实习经历全部只能成为简历上的寥寥几笔。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么都无法舍弃的人什么也改变不了">什么都无法舍弃的人，什么也改变不了<a class="hash-link" href="#什么都无法舍弃的人什么也改变不了" title="Direct link to heading">​</a></h2><p>心中埋下了梦想的种子，却从来不敢触碰它。我想，有很多人和我一样吧。当发现了自己想要的东西，却错过了合适的年纪。维稳的我们从来不敢去冒险，因为代价实在太大。改变不难，难的是需要舍弃从前的改变。</p><p>所以在浑浑噩噩中，我靠着自己勉强能入眼的文案水平，靠着自己拙劣的活动策划能力，勉强地在运营岗位上坚持着。但我一直明白，这并不是自己所追求的。</p><p>如果不曾遇见他，也许我这辈子真的会在运营岗位上慢慢熬，然后凭借多年的经验慢慢的混个小主管。是他告诉我改变未晚，是他告诉我成功需要勇气。</p><p>16 年的 6 月，已经临近毕业典礼，走出校门的日子已近在眼前。这时，阴差阳错的，我从朋友圈点入了一篇文章，文章的具体标题我已经忘记了，讲的是作者自己如何在 28 岁的高龄从体制内走出，去香港读自己向往已久的金融硕士，然后彻底颠覆了自己的生活。说实话，文章有点鸡汤的嫌疑，但对当时的自己，真的需要鸡汤来为自己加持。恰好此时，我发现了作者著有一本书籍《优秀的人都敢对自己下狠手》，本着我不喝鸡汤谁喝鸡汤的悲壮信念，我毅然地买下了这本书。在之前，我从来不曾想过天涯彼岸的一个人能对另一个人产生这么大的影响，但是他的书确确实实唤醒了我内心最原始的激情。他的书与其说是鸡汤，倒不如说是跌宕起伏的人生中的鸡血。整本书，满满是他突破体制与桎梏，实现第二人生的干货。</p><p>就在那时，我终于坚定了信念，我终于决定重整行装，向着梦里的技术帝出发。我知道自己不是科班出身，我知道自己已经错过了 4 年，但这些都无妨。只要我自己信念坚定，我可以在别人休息的时候付出更多的精力和心血来弥补。也许我不一定会有天资，也许我不一定会学得快，但只要能看到每天有一点改变的自己，我相信那会是最好的报答。</p><p>什么都无法舍弃的人，什么也改变不了。我庆幸我舍弃了从前，选择了自己所热爱的技术道路。我知道未来还很远，但自从感受到按下运行按钮弹出自己的作品时内心溢出的那种骑士般的荣耀感时，我体会到了多年不曾体会到的满足感。我相信，在未来的日子，编程于我而言，是信仰，是执着，是荣耀，是生命不可割舍的部分。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/essay">Essay</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Recommend</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Spark</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/flink">Flink</a></li></ul></div><div class="col footer__col"><div class="footer__title">Other</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/clickhouse">ClickHouse</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/flume">Flume</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/spider">Spider</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/magicpenta" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.fb.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/bottom.png" alt="Panda Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/bottom.png" alt="Panda Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2023 Panda's Home</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e2f7f3df.js"></script>
<script src="/assets/js/main.4ed9c8f6.js"></script>
</body>
</html>